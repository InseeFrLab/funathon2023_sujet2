<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="keywords" content="productions végétales, agronomie, climat, ERA5, France">

<title>ERA5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 1em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./app2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.2.1/leaflet.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./app3.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Évolution de la date théorique de récolte</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Funathon 2023 - Sujet 2</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/InseeFrLab/funathon2023_sujet2/tree/main/website/" title="Code source" class="quarto-navigation-tool px-1" aria-label="Code source"><i class="bi bi-github"></i></a>
    <a href="./Funathon-2023---Sujet-2.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Recherche"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contexte et description du sujet</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Utilisation de PostgreSQL</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Première manipulation du RPG</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Cultures et prévisions climatiques</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Évolution de la date théorique de récolte</span></span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Références</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table des matières</h2>
   
  <ul>
  <li><a href="#proposition" id="toc-proposition" class="nav-link active" data-scroll-target="#proposition"><span class="header-section-number">4.1</span> Proposition</a>
  <ul class="collapse">
  <li><a href="#compétences-mises-en-œuvre" id="toc-compétences-mises-en-œuvre" class="nav-link" data-scroll-target="#compétences-mises-en-œuvre"><span class="header-section-number">4.1.1</span> Compétences mises en œuvre</a></li>
  <li><a href="#données-utilisées" id="toc-données-utilisées" class="nav-link" data-scroll-target="#données-utilisées"><span class="header-section-number">4.1.2</span> Données utilisées</a></li>
  <li><a href="#scénario" id="toc-scénario" class="nav-link" data-scroll-target="#scénario"><span class="header-section-number">4.1.3</span> Scénario</a></li>
  </ul></li>
  <li><a href="#préparation" id="toc-préparation" class="nav-link" data-scroll-target="#préparation"><span class="header-section-number">4.2</span> Préparation</a></li>
  <li><a href="#définition-des-bassins-de-production-du-maïs-grain" id="toc-définition-des-bassins-de-production-du-maïs-grain" class="nav-link" data-scroll-target="#définition-des-bassins-de-production-du-maïs-grain"><span class="header-section-number">4.3</span> Définition des bassins de production du maïs grain</a>
  <ul class="collapse">
  <li><a href="#récupération-des-données" id="toc-récupération-des-données" class="nav-link" data-scroll-target="#récupération-des-données"><span class="header-section-number">4.3.1</span> Récupération des données</a></li>
  <li><a href="#lissage" id="toc-lissage" class="nav-link" data-scroll-target="#lissage"><span class="header-section-number">4.3.2</span> Lissage</a></li>
  </ul></li>
  <li><a href="#extraction-des-températures-à-chaque-point" id="toc-extraction-des-températures-à-chaque-point" class="nav-link" data-scroll-target="#extraction-des-températures-à-chaque-point"><span class="header-section-number">4.4</span> Extraction des températures à chaque point</a></li>
  <li><a href="#calcul-des-degrés-jour-et-des-dates-de-récolte" id="toc-calcul-des-degrés-jour-et-des-dates-de-récolte" class="nav-link" data-scroll-target="#calcul-des-degrés-jour-et-des-dates-de-récolte"><span class="header-section-number">4.5</span> Calcul des degrés jour et des dates de récolte</a></li>
  <li><a href="#tendances" id="toc-tendances" class="nav-link" data-scroll-target="#tendances"><span class="header-section-number">4.6</span> Tendances</a>
  <ul class="collapse">
  <li><a href="#visualisation-des-tendances" id="toc-visualisation-des-tendances" class="nav-link" data-scroll-target="#visualisation-des-tendances"><span class="header-section-number">4.6.1</span> Visualisation des tendances</a></li>
  <li><a href="#paramètres-des-tendances" id="toc-paramètres-des-tendances" class="nav-link" data-scroll-target="#paramètres-des-tendances"><span class="header-section-number">4.6.2</span> Paramètres des tendances</a></li>
  <li><a href="#validation" id="toc-validation" class="nav-link" data-scroll-target="#validation"><span class="header-section-number">4.6.3</span> Validation</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Évolution de la date théorique de récolte</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Montrer tout le code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Cacher tout le code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Voir les sources</a></li></ul></div></div>
<p class="subtitle lead">Agronomie et données climatiques rétrospectives avec ERA5</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Mots clés</div>
    <p>productions végétales, agronomie, climat, ERA5, France</p>
  </div>
</div>

</header>


<p>Les organismes vivants, dont les plantes, ont besoin d’une certaine quantité de chaleur pour se développer. La notion de <em>degrés jours</em> a été introduite par les biologistes pour quantifier ce besoin physiologique. Il s’exprime par la somme des différences entre la température moyenne journalière et une température de base<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="no-row-height column-margin column-container"><p><sup>1</sup>&nbsp;<a href="https://fr.wikipedia.org/wiki/Degr%C3%A9_jour_de_croissance">Degré jour de croissance</a> sur <em>Wikipedia</em></p></div><p><em>Peut-on voir comment a évolué la date de récolte théorique d’une culture au cours des 40&nbsp;dernières années</em>, compte tenu des changements climatiques en cours&nbsp;?</p>
<p>Des données anciennes existent pour certaines cultures, par exemple pour la vigne et <a href="https://fr.wikipedia.org/wiki/Vendange#%C3%89chelles_d%C3%A9cennales">les dates de vendanges</a>, mais pour la plupart il n’y a pas de jeu de données rétrospectif consolidé. Nous allons essayer de combler cette lacune…</p>
<div id="fig-vendanges" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vendanges-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/evol_dates_vendanges.png" class="img-fluid figure-img"></p>
<figcaption>Delorme, CC BY-SA 4.0, via <a href="https://commons.wikimedia.org/wiki/File:%C3%89volution_des_dates_de_vendanges_en_France_(1892-2014).svg">Wikimedia Commons</a></figcaption>
</figure>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vendanges-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1&nbsp;–&nbsp; Évolution des dates de vendanges en France (1892-2014)
</figcaption>
</figure>
</div>
<section id="proposition" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="proposition"><span class="header-section-number">4.1</span> Proposition</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Votre mission si vous l'acceptez...">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Votre mission si vous l’acceptez…
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Estimer les tendances de la date potentielle de récolte du maïs grain dans les différents bassins de productions français depuis 1980.</strong></p>
</div>
</div>
<section id="compétences-mises-en-œuvre" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="compétences-mises-en-œuvre"><span class="header-section-number">4.1.1</span> Compétences mises en œuvre</h3>
<ul>
<li>Utiliser le <strong>langage R</strong>.</li>
<li>Manipuler des <strong>données géographiques</strong>&nbsp;: vecteurs et rasters avec les packages {sf}, {terra}, {stars}.</li>
<li>Requêter en <strong>SQL sur PostgreSQL/PostGIS</strong> avec {RPostgres} et {sf}.</li>
<li>Utiliser le <strong>lissage spatial</strong> pour synthétiser les données géographiques avec {btb}.</li>
<li>Créer une <strong>carte web interactive</strong> avec {leaflet}.</li>
<li>Estimer et visualiser des <strong>tendances</strong>&nbsp;: modèle linéaire simple et {ggplot2}.</li>
</ul>
</section>
<section id="données-utilisées" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="données-utilisées"><span class="header-section-number">4.1.2</span> Données utilisées</h3>
<ul>
<li><p>Le <a href="https://geoservices.ign.fr/rpg">RPG</a> recense les parcelles déclarées à la PAC (Politique agricole commune) par les agricuteurs&nbsp;: données graphiques et leur culture principale.</p>
<p>Les données&nbsp;2021 (environ 10&nbsp;millions de parcelles) sont disponibles dans une base <a href="https://www.postgresql.org/">PostgreSQL</a>/<a href="http://postgis.net/">PostGIS</a>.</p></li>
<li><p><a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/sis-agrometeorological-indicators">ERA5 agrometeorological indicators</a> est un jeu de données issu d’un projet de réanalyse météorologique qui vise à uniformiser et corriger les données historiques (<a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-land">ERA5</a>). Il fournit des paramètres agro-météorologiques de surface quotidiens sur les quarante dernières années à une résolution spatiale de 0,1&nbsp;° (soit environ 8×11&nbsp;km en France métropolitaine).</p>
<p>Les données de température moyenne journalière 1979-2022 (87&nbsp;Go à l’origine) ont été préchargées sur Minio et limitées à l’emprise de la métropole, représentant au final 16&nbsp;000&nbsp;fichiers de 76&nbsp;ko&nbsp;=&nbsp;1,1&nbsp;Go).</p>
<p>Elles sont au format <a href="https://fr.wikipedia.org/wiki/NetCDF">NetCDF</a>. Un package R existe pour importer et requêter ce jeu de données particulier&nbsp;: <a href="https://github.com/AgrDataSci/ag5Tools">{ag5Tools}</a>. Les données peuvent aussi être traitées avec les packages de manipulation de rasters tels que <a href="https://rspatial.org/spatial/index.html">{terra}</a> (ou {raster}) et <a href="https://r-spatial.github.io/stars/">{stars}</a>.</p></li>
<li><p><a href="https://geoservices.ign.fr/adminexpress">Admin Express</a> est le référentiel des limites administratives de l’IGN. Des tables simplifiées des communes et des régions 2023 ont été intégrées dans la base PostgreSQL/PostGIS.</p></li>
</ul>
</section>
<section id="scénario" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="scénario"><span class="header-section-number">4.1.3</span> Scénario</h3>
<ol type="1">
<li>Définir les principaux bassins de production du maïs grain à partir du RPG&nbsp;;</li>
<li>extraire les températures journalières sur un point central de chaque bassin&nbsp;;</li>
<li>calculer les dates de récolte théoriques pour chaque bassin et chaque année&nbsp;;</li>
<li>estimer les tendances par bassin.</li>
</ol>
</section>
</section>
<section id="préparation" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="préparation"><span class="header-section-number">4.2</span> Préparation</h2>
<p>Le pas-à-pas détaillé est décrit sur <a href="app0.html">la page de démarrage</a>:</p>
<ul>
<li>Si ce n’est pas déjà fait, il faut avoir préalablement copié les données depuis le stockage MinIO. Pour cela commencez par exécuter la commande “MC client” de cette page dans votre Terminal, puis les commandes suivantes :</li>
</ul>
<pre><code>mc cp minio/projet-funathon/2023/sujet2/diffusion/era5.zip ~/work/funathon_sujet2/data/era5.zip
unzip ~/work/funathon_sujet2/data/era5.zip -d ~/work/funathon_sujet2/data/
rm ~/work/funathon_sujet2/data/era5.zip</code></pre>
<p>A noter qu’avec ces commandes on copie dans un projet qui se trouve dans un répertoire <code>funathon_sujet2</code>, si votre projet se trouve dans un répertoire <code>funathon2023_sujet2</code> (ce qui est probablement le cas si vous avez cloné le dépôt Github plutôt que Gitlab), il faut modifier ces commandes légèrement en fonction de ça;</p>
<ul>
<li>Pour se connecter à la base PostgreSQL, il faudra avoir défini les bonnes variables d’environnements par exemple en ajoutant <code>PASS_POSTGRESQL = "xxxx"</code>, etc. dans le fichier <em>~/.Renviron</em>&nbsp;: <code>file.edit("~/.Renviron")</code> et en ayant relancé la session (ctrl+maj+F10).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)     <span class="co"># manipulation de rasters</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)     <span class="co"># manipulation de rasters</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># manipulation des données</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)      <span class="co"># interpolation de chaine de caractères</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs)        <span class="co"># gestion du système de fichier</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgres) <span class="co"># connexion PostgreSQL</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)        <span class="co"># manipulation de données spatiales vecteur</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)   <span class="co"># carto web</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)        <span class="co"># mise en forme tableaux</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary) <span class="co"># tableaux de modèles stat</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)   <span class="co"># étiquettage graphiques</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># D'autres packages sont à installer et seront appelés directement avec leur</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># namespace : btb, raster, fasterize, rlang, memoise</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># localisation des données dans le stockage "local"</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>rep_era5 <span class="ot">&lt;-</span> <span class="st">"data/era5"</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># pour avoir les noms de dates en français</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">Sys.setlocale</span>(<span class="st">"LC_ALL"</span>, <span class="st">"fr_FR.UTF-8"</span>))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">OutDec =</span> <span class="st">","</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Connexion à la base PostgreSQL</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>cnx <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">Postgres</span>(),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">user =</span> <span class="fu">Sys.getenv</span>(<span class="st">"USER_POSTGRESQL"</span>),</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">password =</span> <span class="fu">Sys.getenv</span>(<span class="st">"PASS_POSTGRESQL"</span>),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">host =</span> <span class="fu">Sys.getenv</span>(<span class="st">"HOST_POSTGRESQL"</span>),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dbname =</span> <span class="st">"defaultdb"</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                 <span class="at">port =</span> <span class="dv">5432</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">check_interrupts =</span> <span class="cn">TRUE</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vous pouvez vous contenter de la description succinte du scénario ci-dessus pour vous lancer ou poursuivre la lecture pour être plus guidé. Vous pouvez aussi bien sûr afficher le code si vous êtes bloqués, si vous voulez des pistes de démarrage ou si vous souhaitez comparer nos approches.</p>
</section>
<section id="définition-des-bassins-de-production-du-maïs-grain" class="level2 page-columns page-full" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="définition-des-bassins-de-production-du-maïs-grain"><span class="header-section-number">4.3</span> Définition des bassins de production du maïs grain</h2>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>surf_mais <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(cnx, <span class="st">"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">    code_cultu,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">    SUM(surf_parc) AS surf_ha</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM rpg.parcelles</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE code_cultu IN ('MIS', 'MIE', 'MID')</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY code_cultu"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>surf_tot_pac <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(cnx, <span class="st">"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">    SUM(surf_parc) AS surf_ha</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM rpg.parcelles"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>surf <span class="ot">&lt;-</span> <span class="cf">function</span>(code){</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  surf_mais <span class="sc">%&gt;%</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(code_cultu <span class="sc">==</span> code) <span class="sc">%&gt;%</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(surf_ha)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Le maïs grain (code culture&nbsp;: <code>MIS</code>) représente, avec une surface de 1,5·10<sup>6</sup>&nbsp;ha, la moitié du maïs cultivé<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> en France en 2021, soit environ 5&nbsp;% des surfaces déclarées à la PAC. Il est utilisé pour l’alimentation animale (essentiellement) et humaine, la transformation en amidon, les agrocarburants…</p>
<div class="no-row-height column-margin column-container"><p><sup>2</sup>&nbsp;Les autres cultures étant le maïs ensilage (<code>MIE</code>, 1,28·10<sup>6</sup>&nbsp;ha, broyé et fermenté) destiné à nourrir le bétail et le maïs doux (<code>MID</code>, environ 23 000&nbsp;ha) pour l’alimentation humaine.</p></div><p>→ Pouvez-vous confirmer ces chiffres ? La table <code>rpg.parcelles</code> liste chaque parcelle avec son <code>code_cultu</code> et sa <code>surf_parc</code> en hectare.</p>
<p>Pour déterminer les aires principales de culture on peut, par exemple, extraire les principales zones où la densité de culture du maïs grain est la plus forte. Cela peut se faire par commune, par clustering ou avec un lissage<span class="citation" data-cites="loonisManuelAnalyseSpatiale2018"> (voir chapitre 8 <a href="references.html#ref-loonisManuelAnalyseSpatiale2018" role="doc-biblioref">Loonis et de Bellefon, 2018</a>)</span>.</p>
<p>On présente ici un exemple avec un lissage filtré mais vous êtes libre d’utiliser une autre méthode pour déterminer ces aires principales, l’objectif étant d’obtenir une dizaine de points représentatifs sur le territoire à partir desquels nous extrairons les données de température.</p>
<section id="récupération-des-données" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="récupération-des-données"><span class="header-section-number">4.3.1</span> Récupération des données</h3>
<ul>
<li>La table <code>rpg.parcelles</code> contient les polygones des parcelles&nbsp;; le lissage attend un point par parcelle. Il faut donc récupérer une table de points.</li>
<li>La table <code>adminexpress.region</code> contient les polygones des régions. Le lissage nécessitera le contour de la France (métropolitaine) pour “fermer” la zone d’étude. Il faudra donc fusionner les régions.</li>
<li>La table <code>adminexpress.commune</code> contient les polygones des limites de communes et pourra nous permettre de nommer nos zones en identifiant la commune la plus peuplée de la zone.</li>
</ul>
<p>NB&nbsp;: pour le lissage, il est recommandé d’utiliser une projection dite “équivalente” (conservant les surfaces), par exemple en France la <a href="https://fr.wikipedia.org/wiki/Projection_azimutale_%C3%A9quivalente_de_Lambert">LAEA</a> Europe, connue sous le code <a href="https://epsg.io/3035">EPSG:3035</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># contour de la métropole (pour limiter le lissage à l'intérieur des frontières)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>fr <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(cnx, <span class="at">query =</span> <span class="st">"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">    st_union(st_transform(geom, 3035)) as geom</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM adminexpress.region</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE insee_reg &gt; '06'"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># communes (pour donner ultérieurement un nom à nos bassins de production)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(cnx, <span class="at">query =</span> <span class="st">"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="st">    nom,</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="st">    insee_dep,</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="st">    population,</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="st">    st_transform(geom, 3035) as geom</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM adminexpress.commune</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE insee_reg &gt; '06'"</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># un point par parcelle de maïs avec sa surface qui servira de poids au lissage</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>mais <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(cnx, <span class="at">query =</span> <span class="st">"</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="st">    st_transform(st_pointonsurface(geom), 3035) as geom,</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="st">    surf_parc</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM rpg.parcelles</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE code_cultu = 'MIS'"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="lissage" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="lissage"><span class="header-section-number">4.3.2</span> Lissage</h3>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>seuil_lissage  <span class="ot">&lt;-</span> <span class="dv">8</span>     <span class="co"># seuil de densité à prendre en compte (ha/km²)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nb_bassins     <span class="ot">&lt;-</span> <span class="dv">10</span>    <span class="co"># combien de bassins on conserve</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>bande_passante <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co"># "étalement" du lissage en m</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>pixel          <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># taille du pixel en sortie en m</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Pour un rendu à la fois synthétique et esthétique on peut faire un lissage à 10 km de “bande passante” avec un pixel de 1 km.</p>
<p>La fonction <a href="https://cran.r-project.org/package=btb"><code>btb::btb_smooth()</code></a> attend une table (data.frame) de coordonnées et contenant la variable à lisser, une valeur de bande passante (dans la projection utilisée, donc en mètres dans notre cas)&nbsp;; on peut optionnellement fournir une grille régulière (data.frame) pour faciliter les comparaisons de jeux de données (en s’assurant qu’ils ont les mêmes emprises et résolutions) et border la zone d’étude.</p>
<p>En retour nous obtiendrons un data.frame&nbsp;; il peut être plus intéressant de rasteriser le résultat.</p>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lissage : fonctions simplifiant la création de rasters lissés à partir de </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># points avec {btb}</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># michael.delorme - 2021-08-26</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># utils -------------------------------------------------------------------</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' rounding</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' from plyr</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param accuracy</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param f</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>round_any <span class="ot">&lt;-</span> <span class="cf">function</span>(x, accuracy, <span class="at">f =</span> round) {</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(x <span class="sc">/</span> accuracy) <span class="sc">*</span> accuracy</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#' Generate a grid of coordinates from a spatial layer</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">#' Memoised to get a faster result when used multiple times on the same extent</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param zone sf object (polygons) : spatial extent</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param margin number : buffer of bounding box</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param resolution number : distance between nodes</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return dataframe of coordinates (x, y)</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>generate_grid <span class="ot">&lt;-</span> memoise<span class="sc">::</span><span class="fu">memoise</span>(<span class="cf">function</span>(zone, margin, resolution) {</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  zone_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(zone)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  zone <span class="sc">%&gt;%</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_make_grid</span>(<span class="at">cellsize =</span> resolution,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">offset =</span> <span class="fu">c</span>(<span class="fu">round_any</span>(zone_bbox[<span class="dv">1</span>] <span class="sc">-</span> margin, resolution, floor),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">round_any</span>(zone_bbox[<span class="dv">2</span>] <span class="sc">-</span> margin, resolution, floor)),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">what =</span> <span class="st">"centers"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_join</span>(zone, <span class="at">join =</span> st_intersects, <span class="at">left =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co"># main function -----------------------------------------------------------</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co">#' Kernel weighted smoothing with arbitrary bounding area</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param df sf object (points) : features to smooth</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param field expression : weight field in df (unquoted) ; the values must not have NAs</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param bandwidth numeric : kernel bandwidth (output map units)</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param resolution numeric : output grid resolution (output map units)</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param zone sf objet (polygons) : study zone boundary. If null will use df extent</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param out_crs integer : EPSG code projection for output raster (should be an equal-area projection)</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param ... other arguments passed to btb::kernelSmoothing</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return a raster object</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co">#' @import btb, raster, fasterize, dplyr, sf, rlang, memoise</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>lissage <span class="ot">&lt;-</span> <span class="cf">function</span>(df, field, bandwidth, resolution, <span class="at">zone =</span> <span class="cn">NULL</span>, <span class="at">out_crs =</span> <span class="dv">3035</span>, ...) {</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  field_name <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">as_name</span>(rlang<span class="sc">::</span><span class="fu">enquo</span>(field))</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"sf"</span> <span class="sc">%in%</span> <span class="fu">class</span>(df)</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>      <span class="sc">|</span> sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(df, <span class="cn">FALSE</span>) <span class="sc">!=</span> <span class="st">"POINT"</span>) {</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"« df » should be a point sf object."</span>)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(bandwidth)) <span class="fu">stop</span>(<span class="st">"bandwidth sould be numeric."</span>)</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(resolution)) <span class="fu">stop</span>(<span class="st">"resolution sould be numeric."</span>)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  nb_na <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(dplyr<span class="sc">::</span><span class="fu">pull</span>(df, {{field}})))</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (nb_na <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"removing"</span>, nb_na, <span class="st">"NA"</span>,</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">paste0</span>(<span class="st">"value"</span>, <span class="fu">ifelse</span>(nb_na <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="st">"s"</span>, <span class="st">""</span>)),</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"in «"</span>, field_name, <span class="st">"»..."</span>))</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(df, {{field}}) <span class="sc">%&gt;%</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check projections</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(df))) {</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"missing projection in sf object « df »."</span>)</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sf<span class="sc">::</span><span class="fu">st_crs</span>(df)<span class="sc">$</span>epsg <span class="sc">!=</span> out_crs) {</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"reprojecting data..."</span>)</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(df, out_crs)</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(zone)) {</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"sf"</span> <span class="sc">%in%</span> <span class="fu">class</span>(zone)</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>        <span class="sc">|!</span>sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(zone, <span class="cn">FALSE</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"POLYGON"</span>, <span class="st">"MULTIPOLYGON"</span>)) {</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"« zone » should be a polygon/multiploygon sf object."</span>)</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check projections</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(zone))) {</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"missing projection in sf object « zone »."</span>)</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sf<span class="sc">::</span><span class="fu">st_crs</span>(zone)<span class="sc">$</span>epsg <span class="sc">!=</span> out_crs) {</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"reprojecting study zone..."</span>)</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>      zone <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(zone, out_crs)</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid generation</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (memoise<span class="sc">::</span><span class="fu">has_cache</span>(generate_grid)(zone, bandwidth, resolution)) {</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"retrieving reference grid from cache..."</span>)</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"generating reference grid..."</span>)</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>    zone_xy <span class="ot">&lt;-</span> <span class="fu">generate_grid</span>(zone, bandwidth, resolution)</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>    zone_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(zone)</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"using default reference grid..."</span>)</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>    zone_xy <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>    zone_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(df)</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># kernel</span></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">"computing kernel on « "</span>, field_name, <span class="st">" »..."</span>))</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>  kernel <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(., sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) <span class="sc">%&gt;%</span> <span class="co"># si pas de données renvoie vecteur non nommé</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span>     <span class="co"># donc on le modifie</span></span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>                <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(x, y, {{ field }}) <span class="sc">%&gt;%</span></span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>    btb<span class="sc">::</span><span class="fu">btb_smooth</span>(<span class="at">sEPSG =</span> out_crs,</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>                    <span class="at">iCellSize =</span> resolution,</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>                    <span class="at">iBandwidth =</span> bandwidth,</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dfCentroids =</span> zone_xy, ...)</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rasterization</span></span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">rasterizing..."</span>)</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">raster</span>(<span class="at">xmn =</span> <span class="fu">round_any</span>(zone_bbox[<span class="dv">1</span>] <span class="sc">-</span> bandwidth, resolution, floor),</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymn =</span> <span class="fu">round_any</span>(zone_bbox[<span class="dv">2</span>] <span class="sc">-</span> bandwidth, resolution, floor),</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xmx =</span> <span class="fu">round_any</span>(zone_bbox[<span class="dv">3</span>] <span class="sc">+</span> bandwidth, resolution, ceiling),</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymx =</span> <span class="fu">round_any</span>(zone_bbox[<span class="dv">4</span>] <span class="sc">+</span> bandwidth, resolution, ceiling),</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>                 <span class="at">resolution =</span> resolution,</span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>                 <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(out_crs)<span class="sc">$</span>input</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>    fasterize<span class="sc">::</span><span class="fu">fasterize</span>(kernel, ., <span class="at">field =</span> field_name)</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- 
NB : le lissage ne peut pas être mis en cache par Quarto car les objets 
{terra} ne sont pas cachables.
-->
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mais_liss <span class="ot">&lt;-</span> mais <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lissage</span>(surf_parc, <span class="at">bandwidth =</span> bande_passante, <span class="at">resolution =</span> pixel, <span class="at">zone =</span> fr) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mais_liss, <span class="at">main =</span> <span class="st">"Densité de culture de maïs grain 2021 (ha/km²)"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lissage-carte" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lissage-carte-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="app3_files/figure-html/fig-lissage-carte-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lissage-carte-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2&nbsp;–&nbsp; Lissage
</figcaption>
</figure>
</div>
</div>
</div>
<p>On peut garder par exemple les densités supérieures à 8&nbsp;ha/km² et on conservera les 10&nbsp;plus grandes zones, que nous nommerons avec le nom de la plus grande ville de la zone.</p>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mais_liss <span class="sc">&gt;</span> seuil_lissage, <span class="at">main =</span> <span class="fu">glue</span>(<span class="st">"Zones de culture de maïs grain 2021 (&gt; {seuil_lissage} ha/km²)"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-lissage-carte-filtree" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lissage-carte-filtree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="app3_files/figure-html/fig-lissage-carte-filtree-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lissage-carte-filtree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3&nbsp;–&nbsp; Lissage filtré
</figcaption>
</figure>
</div>
</div>
</div>
<p>Suggestions&nbsp;:</p>
<ul>
<li>filtrer le raster&nbsp;;</li>
<li>vectoriser le raster en polygones&nbsp;;</li>
<li>calculer les surfaces&nbsp;;</li>
<li>conserver les plus grands polygones&nbsp;;</li>
<li>faire une jointure spatiale avec les points des communes&nbsp;;</li>
<li>déterminer la plus grande commune de chaque polygone et le nommer.</li>
</ul>
<p>NB&nbsp;: Le centroïde d’un polygone tarabiscoté peut se trouver en dehors du polygone&nbsp;; on utilise <code>st_point_on_surface()</code> plutôt que <code>st_centroid()</code> pour garantir qu’il est bien dans le polygone.</p>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vectorisation et conservation des nb_bassins + grandes zones</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cluster_liss <span class="ot">&lt;-</span> (mais_liss <span class="sc">&gt;</span> seuil_lissage) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.polygons</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(layer <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">surf =</span> <span class="fu">st_area</span>(geometry)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(surf, <span class="at">n =</span> nb_bassins) <span class="sc">%&gt;%</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>())</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># nommage des clusters avec le nom de la plus grosse ville de la zone</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>noms <span class="ot">&lt;-</span> cluster_liss <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(<span class="fu">st_point_on_surface</span>(com), <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(population, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, nom, insee_dep)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>La couche résultante peut-être affichée sur une carte interactive avec <a href="https://rstudio.github.io/leaflet/">{leaflet}</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cluster_liss <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(noms, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:4326"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolygons</span>(<span class="at">popup =</span> <span class="sc">~</span> <span class="fu">glue</span>(<span class="st">"{id}. bassin de {nom}"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-clusters-carto" class="cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-clusters-carto-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-68bcd69379d0626360fa" style="width:100%;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-68bcd69379d0626360fa">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addPolygons","args":[[[[{"lng":[-0.08176988845699591,-0.01993878240059191,-0.01836767502004524,-0.006001937298305097,-0.004433355091566007,0.007930967838730931,0.009497026436306103,0.02185993420642223,0.02342347075899052,0.03578496300124417,0.03890635249999808,0.0512645525732713,0.05282240819183529,0.06517919245848949,0.06828923114000683,0.08064272461136375,0.08994626740496185,0.07760400610648457,0.08225278222470102,0.06991658304787143,0.07146676867981451,0.08380110092374628,0.08689583048187711,0.09922688624411609,0.100771432820051,0.1131010779369558,0.1146431257123587,0.1393000469679667,0.1408377331056878,0.1654927347486514,0.1670260614197311,0.1793523747590567,0.1824134132175808,0.1947364495652975,0.2038933391498348,0.1915814671990775,0.1946324742142105,0.182324765394777,0.183851187353296,0.1715457827304579,0.1730734345193178,0.1607703333186069,0.1622992135465472,0.1499984149934477,0.1515285222704324,0.1269319779298206,0.1284651629458743,0.116169416620799,0.117703824897734,0.1054103791328258,0.119208452356384,0.1314852738349938,0.1360678275405404,0.1483395668010095,0.1513877998424988,0.1636563016627094,0.1666983645176524,0.1789636301689248,0.1819995308797946,0.1942615616345875,0.198805254001716,0.2110622142032338,0.2140845807250212,0.2263383097475539,0.2293545410231728,0.2416050401421754,0.2446151441677503,0.2568624146597923,0.2598663994211076,0.2721104425638641,0.2736096848851331,0.2858523330457424,0.2873491331086137,0.3118320740563769,0.3103389369864177,0.3348272810157871,0.3333372004573198,0.345583856895426,0.3440950023159898,0.3685932845515404,0.365621093974497,0.377874556429071,0.3763893880276232,0.3886451206585509,0.3871611837340745,0.4116776234029626,0.4101967584628026,0.4960307609096881,0.4974987443910003,0.5220229283058535,0.5234866309281256,0.5480088420075653,0.5494682659444695,0.5617281700020369,0.5631851578679768,0.5754436468113925,0.5768982001284052,0.5891552736373314,0.5920589215010899,0.6043127404652785,0.6072103433967064,0.6194609091453398,0.6223524750825119,0.6345997889457807,0.638927211766027,0.6511694405657402,0.6583608969840588,0.6461278298897176,0.6490039712108867,0.6367749817635175,0.6396524370204308,0.6274275218047605,0.6288671975896415,0.6166445274009998,0.6180854429540222,0.605865017060718,0.6073071710129935,0.5950889886832509,0.5965323796670629,0.584316440169019,0.5857610668178469,0.5735473694195463,0.576438503351357,0.5642288682214518,0.5656753737542962,0.553467978282963,0.5563628633165661,0.5441595250048019,0.5470556920539196,0.5348564075054819,0.5449871791501849,0.5328010085822474,0.5385843478710122,0.5264058329859826,0.5278520096269149,0.5156757200578861,0.517123116900954,0.4927754055049471,0.4942258265006247,0.4333729129565954,0.4319134693806821,0.4197423448441354,0.4182805051790614,0.4061079985278565,0.4017135053157099,0.4138914287328384,0.4094970091528958,0.4216807796027877,0.4187518132071457,0.4065644232670383,0.4036294560117131,0.391438868700613,0.3899686792623998,0.3777767057105874,0.3763041068103042,0.3641107473400285,0.3626357374880531,0.338246675119262,0.3367674397921485,0.324571737986847,0.3230900882834535,0.2621089614385457,0.2635996745165209,0.227021610954088,0.2285171515512706,0.1797597049616244,0.1812618755810038,0.1690754082064196,0.1705787772490322,0.1462107629464648,0.1477171356825164,0.1355355882355748,0.1370431557337725,0.1005065464877449,0.1020189159169816,0.06549165213641592,0.06397387198021622,-0.1064595218468576,-0.1080031448291487,-0.1566896147037509,-0.1582410640339408,-0.2190980646766156,-0.2206591409283931,-0.2693438262537361,-0.2709127314255604,-0.2830845700991313,-0.2846559101474244,-0.2968290939245246,-0.2999772846437334,-0.3121536130653209,-0.3153079588030314,-0.327487433045711,-0.3322291575041294,-0.3444135815801959,-0.3571008790043846,-0.369299290867706,-0.3724811769461207,-0.3846827460006912,-0.3862764685719401,-0.4106818400123279,-0.4122798306780586,-0.5098972250556946,-0.5082847637162252,-0.532680834223848,-0.531065414101008,-0.5432609413115429,-0.5400284571755419,-0.5522199063444712,-0.5457555910287665,-0.533571353060828,-0.5255146880634307,-0.537689927771652,-0.5360787555889108,-0.5482517324871117,-0.5466394163734151,-0.6196567065312261,-0.6212797959963703,-0.6334495023447957,-0.6350750445661082,-0.6472460766757343,-0.648874073120863,-0.6610464306139878,-0.662676882751002,-0.6748505652489359,-0.6764834745463136,-0.6886584816693782,-0.6902938495960171,-0.7024701809635536,-0.7041080089887669,-0.7162856642191058,-0.717925953812626,-0.7301049325231258,-0.731747685155088,-0.7439279869621088,-0.7455732041030759,-0.7577548286219787,-0.7594025117429143,-0.7715854585880713,-0.7732356091603587,-0.7854198779451511,-0.7870724974405778,-0.8236278321135886,-0.8252865212638529,-0.8862114734412657,-0.8878798317973582,-0.9122500360878293,-0.9139226689590163,-0.9382945353596492,-0.9399714447089581,-0.9521584493499253,-0.953837838164578,-0.9782139874557365,-0.979897656574626,-1.004275455697472,-1.005963407077616,-1.018153373614159,-1.019843809661315,-1.044225873799936,-1.045920595926677,-1.058112692330159,-1.059809902459462,-1.07200330772964,-1.073703007333555,-1.085897721064927,-1.087599911615903,-1.099795933401972,-1.103205991340409,-1.115405122670079,-1.118821556026557,-1.131023797968355,-1.13787221296301,-1.150081176820263,-1.156947958402671,-1.169163652391197,-1.172604849834287,-1.184823661987839,-1.186547120033917,-1.198767241281675,-1.200493210405231,-1.21271464033004,-1.214443122013744,-1.226665860197409,-1.228396855924311,-1.252844444403032,-1.2545797666439,-1.266804615710081,-1.268542455348801,-1.305219403575292,-1.30696338467515,-1.331415772280438,-1.333164085719959,-1.357618062876069,-1.359370710591765,-1.371598746447599,-1.373353919036523,-1.385583256135299,-1.387340955081199,-1.399571592993365,-1.401331819780357,-1.413563758075332,-1.422384718923449,-1.410143709601183,-1.413673492455404,-1.401428335534662,-1.404957358976646,-1.392708050860852,-1.394471821781947,-1.38222017966253,-1.385746237054993,-1.373490438267544,-1.375252723109792,-1.362994587598938,-1.364755767836275,-1.352495294754695,-1.35425536905689,-1.341992557557238,-1.343751524592822,-1.331486373827719,-1.333244232263997,-1.320976741386035,-1.324490955817852,-1.312219295285524,-1.31749051132398,-1.305212846372225,-1.306969522653267,-1.294689511951682,-1.296445073368109,-1.284162716067489,-1.285917161278447,-1.249061508478814,-1.247312566961339,-1.235028159874711,-1.23153608930309,-1.219254839939246,-1.217511708258951,-1.205231782556444,-1.203491196097331,-1.191212594484321,-1.187737218995785,-1.175461774097482,-1.173726982447026,-1.149178235309566,-1.147447814648771,-1.135174513654443,-1.133446630673636,-1.072081718916613,-1.073800442129043,-1.04924729188753,-1.05096304995963,-1.038683887988614,-1.040398512469591,-1.02811701385298,-1.029830503394858,-1.017546667297556,-1.019259020551133,-1.006972846138031,-1.008684061752857,-0.9963955481888492,-0.9981056248132423,-0.9858147712632012,-0.9875237075442457,-0.9752305131730352,-0.9769383077565815,-0.9646427717290645,-0.9663494232597127,-0.9540515447407344,-0.9557570518618556,-0.9311561085500331,-0.9328586253626074,-0.9205555599329097,-0.9222569285854755,-0.8976456094182288,-0.8993439816288565,-0.874726974884944,-0.8764223469104356,-0.8641112484728637,-0.8658054661817456,-0.8534920208447099,-0.8551850828712216,-0.8428692898011975,-0.8479470871058976,-0.8356252399218113,-0.8390102029194628,-0.8143575983900816,-0.8160474103865067,-0.7913891054717234,-0.7930758969780445,-0.7560791458761472,-0.7543979281110845,-0.729734669245893,-0.728057857542229,-0.7033963415024,-0.7017239337910788,-0.6277387430335198,-0.626078171892311,-0.6014162447097037,-0.5997600729501703,-0.587430237195902,-0.5857766038471997,-0.5734481403271725,-0.5701466249695466,-0.5578213918132855,-0.5561735071503593,-0.5438496465983588,-0.5422042946129971,-0.5298818070611361,-0.5282389862150209,-0.4296565993223634,-0.4312845600881823,-0.4066304488742631,-0.4082553585628794,-0.3959257256937643,-0.3975494417851874,-0.3852174700365314,-0.3868399911441889,-0.3621708910551005,-0.3637903524955372,-0.3514532235646665,-0.3530714862105416,-0.3283920699192929,-0.3300072667164152,-0.2929789769067709,-0.294589236798394,-0.2452040717096583,-0.2468075187425341,-0.209758070794138,-0.2113565658342497,-0.161943218740652,-0.16353488227944,-0.1264643195576109,-0.1280510160173529,-0.1033312155522993,-0.1049148142351152,-0.08018939132624793,-0.08176988845699591],"lat":[44.04910622771357,44.05514460905339,44.04621618482185,44.04741921342922,44.03849047505561,44.03969181001986,44.0307627579082,44.03196239974206,44.02303303429594,44.02423098351208,44.0063715299772,44.00756757133979,43.99863748371028,43.99983183382605,43.98197093772497,43.98316338214016,43.92957708313656,43.92838592660934,43.90159211273613,43.90040012604481,43.89146887500769,43.89266064738671,43.87479742538959,43.87598729729137,43.86705532678549,43.86824351294136,43.85931123188796,43.86168276184825,43.85274995779685,43.85511517495881,43.84618184924564,43.8473620380429,43.82949467257122,43.83067296642596,43.77706727954049,43.77589025321737,43.75802133816759,43.75684326445042,43.7479088724201,43.74672954086617,43.73779526286439,43.73661467397418,43.7276805100389,43.72649866431257,43.71756461448153,43.7151969425999,43.70626321883023,43.70507739351166,43.69614378408301,43.69495670376394,43.61455171766858,43.61573689100984,43.58893282725229,43.59011590246097,43.57224561345449,43.57342680324094,43.55555570022181,43.55673500585408,43.53886308974145,43.54004051248652,43.51323127272874,43.51440660463214,43.49653286869154,43.49770632066289,43.47983177440106,43.48100334770326,43.46312799202835,43.46429768792313,43.44642152374072,43.44758934348867,43.43865090667207,43.43981705863436,43.43087831656234,43.4332058256509,43.44214498118043,43.44446706133372,43.45340653160563,43.45456558652178,43.46350516514117,43.46581930291652,43.48369899065885,43.484854278147,43.49379418157145,43.49494821225977,43.50388822387267,43.50619230790057,43.5151326326272,43.52315227069622,43.51421051821131,43.51648826593188,43.50754601164332,43.50981750053844,43.5008747457505,43.50200809320695,43.49306504068099,43.49419672335575,43.48525337347385,43.48638339187079,43.46849600226972,43.4696241561884,43.45173598172554,43.45286227242248,43.43497331396856,43.43609774269915,43.40926298650023,43.41038535515204,43.36565784660164,43.36453647352869,43.34664519569367,43.34552276103296,43.32763149618177,43.32650800067444,43.31756242274705,43.31643766793942,43.30749219271772,43.30636617910297,43.29742080663009,43.29629353470109,43.28734826501994,43.28621973526925,43.27727456842244,43.27614478134237,43.25825455630597,43.25712371240382,43.24817865413473,43.24704655405045,43.2291565458131,43.22802339029656,43.21013339266267,43.2089991824474,43.14638251513669,43.14524825178616,43.10946594468803,43.10833102840218,43.09938540614922,43.09824923792004,43.08930371737472,43.08702742663901,43.07808220823832,43.0723670909662,43.0813113037064,43.0801637261457,43.08910763794422,43.08795840738328,43.11478894161213,43.11593877926914,43.14276903027638,43.14391802326922,43.16180476832277,43.16065537016035,43.17854131509725,43.17739005792217,43.18633267925171,43.18517976528008,43.19412208444179,43.19296751317781,43.20190952979276,43.19959561777135,43.2085371270929,43.20737778567512,43.21631899135912,43.2104994487329,43.20155927023493,43.19805071724924,43.18911105830215,43.18441347004437,43.17547453978029,43.17429671831948,43.16535789555888,43.1629983114175,43.1540598042338,43.15287804236782,43.14393964291598,43.14038627352993,43.13144839928675,43.12788259708287,43.13681984332864,43.12000387588315,43.1289380600693,43.12408044129217,43.13301366804622,43.12690795319192,43.13584000248363,43.13092847505352,43.13985955669432,43.13862783439364,43.14755859581506,43.14632520687673,43.16418598502133,43.16295071143641,43.18081064048842,43.17957348100714,43.20636194428751,43.2051226791991,43.27655228077922,43.2753098116298,43.29316573946349,43.29192137767019,43.30084896667007,43.29835544229362,43.30728248711173,43.29724848439581,43.28832321266854,43.28580062577953,43.27687569530386,43.27561244605755,43.25776271756238,43.25649846252808,43.22079864120592,43.22206200441418,43.17743375493058,43.17617150441659,43.16724576204012,43.16598228453685,43.15705665948727,43.14944670474644,43.15837099023648,43.15709737047052,43.16602132602458,43.16474603327679,43.17366965849892,43.17239269228071,43.18131598677448,43.18003734659719,43.18896030996586,43.18767999534078,43.19660262718713,43.19532063762544,43.20424293755191,43.20295927256473,43.21188124017331,43.21059589927171,43.21951753416403,43.21823051685901,43.22715181863623,43.2258631244387,43.23478409270164,43.23349372112245,43.24241435547152,43.24112230602144,43.25004260605661,43.24615707162391,43.25507657973186,43.24857053931701,43.25748879294468,43.25487576557338,43.26379345103843,43.26117416160782,43.27009127758804,43.26877922626263,43.27769600321371,43.27506708615786,43.28398329155799,43.28134810838116,43.29026374090531,43.28894374080939,43.29785903241279,43.29521421402315,43.30412893067949,43.302804111748,43.31171848633246,43.31039198249792,43.31930601460399,43.31797782537762,43.32689151459846,43.32556163949148,43.34338822296932,43.34205642617136,43.35988210531947,43.35854838556202,43.39419749945628,43.39286138277469,43.42850781630793,43.42716929927531,43.44499139151955,43.44365094595129,43.4525615919165,43.4512194544555,43.46012975405594,43.45878592421125,43.46769587703479,43.46635035431549,43.47525995994948,43.47256407311387,43.48147309195438,43.48012272719938,43.48903139768038,43.48497085543194,43.49387869665236,43.49116391350582,43.50007116389762,43.49735007922692,43.5062567374431,43.5048937711177,43.51380007793852,43.5124354145667,43.52134136957575,43.51997500866666,43.52888061144715,43.5275125525099,43.57203770547797,43.5734069800251,43.59121676017637,43.59258506451722,43.61039489344169,43.61176222690797,43.62066722065192,43.62203333937241,43.63984348568849,43.64120863223642,43.65011378492638,43.65147771561362,43.66038300237508,43.66174571671517,43.67065113753508,43.67201263504123,43.68091818990631,43.68227847009139,43.69118415898817,43.69254322136472,43.71035475890127,43.71171284527881,43.73843006717598,43.73978741923449,43.74869318613423,43.75004931848552,43.75895521975259,43.7603101319073,43.76921616752723,43.77327285298051,43.76436609233916,43.76571515348004,43.74790082788417,43.74924794446456,43.74034038000129,43.74168579359727,43.73277788155632,43.73412159266503,43.71630496711214,43.71764673664259,43.70873802361965,43.71141669863299,43.70250740046318,43.70384430659294,43.69493466293429,43.70159607710023,43.71050690979774,43.71316171647956,43.72207291692108,43.7233983634227,43.73230969452259,43.73363391483291,43.74254537657279,43.74386837020071,43.75277996256193,43.7541017290161,43.76301345197977,43.76433399076844,43.77324584431553,43.77456515494663,43.78347713905789,43.78479522103904,43.79370733569502,43.7950241885335,43.8039364337145,43.80525205691727,43.81416443260342,43.81679175294414,43.82570449429922,43.82701619059942,43.83592906226929,43.83854852535759,43.84746176195618,43.85007582682538,43.85898942778136,43.86029449356217,43.86920822446854,43.87051205661488,43.87942591744989,43.88072851546605,43.90747017648574,43.90877200723398,43.92659973052986,43.9291999189259,43.93811409257002,43.9407088684879,43.94962340532756,43.95350524082316,43.94459000612788,43.94717007929282,43.93825427800579,43.94082800596379,43.931911639448,43.93959614554148,43.93067829539196,43.93322757321019,43.92430916295108,43.92558136700789,43.91666262636511,43.91793313142365,43.9000948885573,43.90136346720001,43.89244396545165,43.89371084645477,43.88479101562046,43.88605619948949,43.87713603997953,43.88720278430894,43.89612475184763,43.89862718695866,43.90754950349683,43.90879873956601,43.91772118020175,43.9189691695708,43.92789173427462,43.93038374691795,43.93930665965232,43.94055068208238,43.94947371866748,43.95195779396386,43.96088117779324,43.96459691504736,43.97352086828106,43.97845544947961,43.98738019228131,43.99106631862217,43.99999162680154,44.00488670449003,44.01381279661436,44.01746927860839,44.02639593206369,44.02882664846577,44.03775364264055,44.04017889343169,44.04910622771357]}]],[[{"lng":[7.921255271533928,7.962264149218186,7.962635281826395,7.976302674408364,7.976671151163868,7.990336183415352,7.989970192076179,8.003637833987653,8.004001339823306,8.017666619546079,8.018027473939306,8.059016590715649,8.059722904907138,8.073381218518801,8.073731651019965,8.114699857006142,8.115042687433318,8.183312940965036,8.183643216093117,8.224599278904552,8.224921966160341,8.211272313571417,8.211597330476994,8.197950265661472,8.198277609966457,8.184633132472124,8.184962801927897,8.171320911301676,8.171984743817502,8.158347912467873,8.158682072250622,8.145047825649245,8.145720625818765,8.132091432820408,8.132768551963917,8.119144408564146,8.120166319249705,8.106549684956555,8.107577577102045,8.093968442129945,8.094657836971262,8.081053734947176,8.081400652597603,8.026995248751353,8.028064500600641,7.973690466826638,7.97442209575204,7.960833795145551,7.961937330453274,7.94835649760747,7.948726452713957,7.935148190008605,7.935892481879292,7.922319232148979,7.922693565707889,7.9091228839833,7.909499487857463,7.89593137367034,7.896310245661106,7.882744698542382,7.883125836452833,7.856000004235906,7.85638584317519,7.842825558333301,7.843213657605108,7.829655939145437,7.830436476212892,7.776226394456212,7.776626126331148,7.749526751581143,7.749931163672478,7.736384110386475,7.736790768276739,7.723246281155027,7.725696902552023,7.739226834364714,7.740037380697449,7.753562605111253,7.754367576421139,7.767888096642769,7.769885251015022,7.75637680901002,7.757580161961321,7.744079087599435,7.744885230681172,7.731389107668406,7.734221685748373,7.747700984527603,7.74850384752865,7.735029345905411,7.735432901930176,7.708489096335187,7.708897261278303,7.695427957536014,7.696248521710374,7.682784142328283,7.684432608998747,7.670977929004126,7.672219485574388,7.658772103243442,7.659187966306577,7.645743106541707,7.646579035329873,7.633139079846027,7.633979015667916,7.620543960580101,7.620966023267291,7.607533486981182,7.607957737070857,7.594527719109357,7.596232307897226,7.582811930719376,7.584095470964704,7.570682348624281,7.574115581697376,7.587509782705288,7.58836144273527,7.601751064543989,7.602174249173779,7.615561652265379,7.617662949531364,7.604287322946477,7.604709368675209,7.591336233310266,7.59176044063497,7.578389796018523,7.580519718900615,7.567160953027088,7.567588709308977,7.554232428652717,7.555521574729894,7.5688708284837,7.569297818725244,7.555950905179068,7.556808989447965,7.543466894094507,7.544759588559631,7.53142464239528,7.533586939521328,7.546910227333984,7.548627280359909,7.535313300527828,7.535744408927203,7.522432894682637,7.522866133857246,7.509557084730531,7.509992452636303,7.523299179623108,7.525029431051638,7.538327021174818,7.53875678466233,7.552052198223473,7.552906519143842,7.566197441023807,7.568741969114781,7.555464916854292,7.555890651999584,7.542616046648988,7.543043899154661,7.529771740250129,7.530201708092253,7.50366242320733,7.504531001368285,7.517795965242593,7.518227662042076,7.504965000677963,7.505398806969808,7.492138588419809,7.492574502187311,7.479316725985398,7.479754745213422,7.439989173117236,7.439544256709021,7.426287055883178,7.427181287658278,7.440433891776093,7.441322736344743,7.401579138584448,7.402030148819486,7.388784870009189,7.388331565280994,7.348589733644901,7.348129341546836,7.321630944686759,7.321165755822259,7.281412410258572,7.280940124111694,7.267687018732399,7.268161601502333,7.228410104958428,7.227928632951732,7.201423825182315,7.200937544802887,7.161174631495961,7.160681241162783,7.14742495930513,7.146929050849583,7.133670631877165,7.133172203232314,7.119911647092719,7.119410696190371,7.092885473534131,7.092379696976148,7.07911503126854,7.078606727404503,7.065339925239313,7.064829091997328,7.038291382046996,7.037775713414137,7.02450480644588,7.023986603379894,7.010713560680123,7.010192821105424,6.996917642631446,6.996394364471195,6.983117050181415,6.981012368698911,6.994298919417811,6.993249795375368,7.006541142011325,7.005495710761176,7.018791857139035,7.017750125960488,7.031051075908326,7.030013052094398,7.043318809443539,7.042801770317993,7.056110017381301,7.055079890386024,7.068392950340246,7.067366551185684,7.080684427869375,7.08017321014299,7.093493580357435,7.092984461154221,7.106307325404477,7.105293061397397,7.118620749530991,7.118115607665847,7.131445791995149,7.130942755682107,7.144275436710465,7.143774507998516,7.157109686228597,7.156610867168349,7.169948543102134,7.169451835745828,7.182792009884606,7.182297416286104,7.195640089130481,7.19317549293643,7.20653002508171,7.204563745121932,7.217927816128473,7.216948047654063,7.230316975068483,7.229341026365029,7.242714814060574,7.241742692640414,7.255121344493579,7.253668588282382,7.267054463974137,7.265606822058015,7.278999930970868,7.278038472540739,7.29143646170927,7.290478863883601,7.303881737202424,7.303404979682935,7.316810375287123,7.315385915117431,7.32879856843374,7.327379293182878,7.313959529496062,7.311577931268454,7.325009566891756,7.323585164558472,7.337024093811246,7.33607818345742,7.349522032679191,7.349051140352896,7.362497529133075,7.362028808499561,7.375477737337716,7.375011190515647,7.388462659910612,7.387533708293561,7.400990106633731,7.398676006328535,7.412144514472913,7.410760727174437,7.424236575675482,7.422858105032393,7.436341303469102,7.43451003818748,7.448003000689972,7.445721284595531,7.459226438686175,7.453301117492864,7.439764532805856,7.437464085609346,7.423915517331959,7.422061656229303,7.408503513799897,7.408037085402843,7.394476664522643,7.393538296490067,7.379973159958151,7.377611290821257,7.391188629631253,7.390247261246126,7.40382964723279,7.402892312450183,7.416479749686938,7.415546456523156,7.429138949086881,7.428209705573656,7.441807257544683,7.440419161508676,7.454024232466796,7.453102691062139,7.466712831948377,7.465795366075477,7.479410580983267,7.478497198740964,7.492117491767201,7.491662950616387,7.505285860949921,7.504833576514985,7.518459104665468,7.518009079169982,7.545265523471711,7.544820226625776,7.612976295868049,7.612543139564532,7.626177265360307,7.626607952426734,7.708400920794388,7.711306679100694,7.724922079565082,7.72574566654655,7.739356285203367,7.739765337398379,7.753373635273306,7.753780042657914,7.767386019853211,7.767789784696786,7.794997233256282,7.795395902033943,7.877006712415693,7.876622780346931,7.903832341130799,7.903453148665952,7.917060579028943,7.91668367195,7.93029368840389,7.929919068932727,7.943531671949593,7.942414171592761,7.915174317847488,7.914796547310453,7.887552275028849,7.887169400328009,7.846296567996087,7.845906118494993,7.805027074900981,7.804629044548243,7.763743810453175,7.763338193208583,7.736077118759066,7.735666377500952,7.722033579249896,7.721620179666338,7.735255447954143,7.734844329995227,7.748482208606921,7.748073374507744,7.761713863934104,7.761307315931536,7.774950416662519,7.774546156995219,7.788191869519961,7.787789900428373,7.81508668540427,7.814689486537902,7.828340558733641,7.827945656158795,7.841599340866686,7.841206736829491,7.854863034534212,7.854472731282581,7.868131642467973,7.867743642251616,7.881405167400684,7.881019472471096,7.89468361206601,7.894300224676477,7.921633863016514,7.921255271533928],"lat":[49.04085097889307,49.04160507815724,49.03261457268476,49.03286254912884,49.02387195907443,49.02411821519485,49.03310885690964,49.03335349600261,49.0243628029768,49.02460572239593,49.01561494587898,49.01633354300149,48.99835159093931,48.99858768811617,48.98959661370763,48.99029475421985,48.98130350090867,48.9824334882512,48.97344196563947,48.97409981738534,48.96510812444244,48.96489055270115,48.95589887273003,48.95567968061725,48.94668801386756,48.94646720207972,48.93747554880068,48.93725311803387,48.91926980603214,48.91904580383204,48.91005414528018,48.90982852581741,48.89184520389672,48.89161801534358,48.87363465571931,48.87340589939639,48.84643075341884,48.84620047870283,48.81922517554151,48.81899338432748,48.80100977729438,48.80077642286111,48.79178461729859,48.79083479970937,48.7638597727315,48.76288401507296,48.74490089919162,48.74465291735865,48.71767814054153,48.71742865686679,48.70843704746477,48.70818595951535,48.69020274114813,48.68995010209149,48.68095849328558,48.68070425164606,48.67171266079732,48.6714568172608,48.66246524460723,48.66220779985919,48.65321624563835,48.65269650117904,48.64370501969695,48.64344272103817,48.63445125877924,48.63418736133099,48.61620444040756,48.61513276372992,48.60614147224627,48.60559583269264,48.59660461867664,48.59632937795099,48.5873381852772,48.5870613502819,48.53311378545664,48.53339027704218,48.51540735309954,48.51568208189616,48.49769889982237,48.49797186726941,48.45301299526414,48.45274030932726,48.42576471719585,48.42549055467855,48.4075067561839,48.40723106213679,48.34428700140518,48.34456229864076,48.32657783387317,48.32630264977379,48.31731041797084,48.31675523964599,48.30776308445789,48.30748309126773,48.2894987832595,48.28921726502831,48.25324842776639,48.25296550182378,48.22598865013894,48.22570426051313,48.21671195877838,48.2164259901793,48.19844138925064,48.19815390120795,48.18016926472519,48.179880258493,48.17088794173849,48.17059735915096,48.16160506329738,48.16131290502163,48.12534357379226,48.12505002049969,48.09807279413712,48.0977777878772,48.02583727666777,48.02613180215603,48.00814616050164,48.00843893667131,47.99944599691025,47.99973708439407,47.95477149446641,47.95448070283845,47.94548752458802,47.94519516492884,47.93620200612991,47.93590807909884,47.89094198187191,47.8906467279404,47.88165344762879,47.88135662884774,47.85437672573279,47.85467336404388,47.84567992178338,47.84538334357326,47.82739645724451,47.82709837641641,47.80011792203142,47.79981840042891,47.75485045933367,47.75514967827252,47.71917434152608,47.71887536421519,47.70988148689116,47.70958095148378,47.70058709326781,47.70028500041512,47.69129116152208,47.6915931934422,47.65561717695101,47.65591734896724,47.64692317980669,47.64722167519816,47.62923309089162,47.62952985054517,47.57556273009047,47.57526632843604,47.5662717202287,47.56597376487621,47.55697917416132,47.55667966575719,47.54768509274808,47.54708135858883,47.52909232731942,47.5293948791368,47.52040023875007,47.52009774765685,47.51110312523625,47.51079908361785,47.50180447937525,47.50149888787613,47.492504302023,47.49157804836379,47.50057244842975,47.50026041372516,47.48227169564746,47.48258360523434,47.46459458956691,47.4636544075133,47.45466002320563,47.45434347380007,47.46333779468507,47.46237830017254,47.47137238543007,47.47072454622585,47.4797184582498,47.47873443082665,47.48772810218077,47.48739680706461,47.47840320211652,47.47739985770108,47.4863932615012,47.48571618125156,47.4947094057415,47.49368150510637,47.50267447988609,47.50232855667329,47.51132141846733,47.51097381511561,47.51996656359223,47.51961727945726,47.52860991428425,47.52790637186701,47.5368988219309,47.53654456271379,47.54553689810719,47.54518095588248,47.55417317627146,47.5534563123872,47.56244834526814,47.56208742267336,47.57107933952454,47.57071673169597,47.57970853218168,47.57934423847343,47.58833592225744,47.58796994202334,47.62393594867931,47.62430222349588,47.64228511453032,47.64264992161282,47.66063278714765,47.66099612530214,47.67897896539029,47.67934083342126,47.69732364811431,47.6976840448246,47.70667546080305,47.70703431258245,47.72501716162345,47.72537453994165,47.74335736345182,47.74371326710737,47.75270468723976,47.75305904342865,47.76205049292282,47.76240330099353,47.78038621622822,47.78073754654341,47.7897290121643,47.79007879276357,47.79907028721362,47.79941851744409,47.80841004051594,47.8087567197244,47.81774827121025,47.81809339874314,47.82708497843478,47.82742855363819,47.836420161327,47.83676218354664,47.88171994741514,47.88206069212584,47.91802643812989,47.91836583390605,47.93634859890183,47.93668650626746,47.95466924538515,47.95500566311927,47.97298837638748,47.9733233032674,48.00029727383855,48.00063077648701,48.02760458785149,48.02793666453887,48.04591914001311,48.0462497216322,48.06423217191622,48.06456125723664,48.07355248967774,48.0738800106628,48.10085367010708,48.10117975913244,48.12815326220662,48.12782697339095,48.17278169137489,48.17310831379518,48.20008087501479,48.20040606181075,48.21838770765114,48.2187113907665,48.22770222175234,48.22802433394516,48.23701519220845,48.23733573281023,48.24632661813231,48.24664558647414,48.2646273723317,48.26494483283032,48.30989895210945,48.31021509813218,48.33718730684161,48.33750200635324,48.36447406797225,48.36478731919686,48.40074979810649,48.401061663459,48.44601424074326,48.44632478198191,48.56319798549864,48.56288660943352,48.60783587298094,48.60752252281713,48.6434810219678,48.64316575894723,48.65215522819557,48.65183824649076,48.66981694554338,48.66949817833918,48.71444396744182,48.71476306577041,48.73274126403935,48.73305883868527,48.75103702695672,48.75135307664015,48.76933125490996,48.76964577834932,48.78762394661183,48.78793694252376,48.81490412741714,48.81521565942507,48.83319373793891,48.83350373956375,48.8514818083227,48.85179027827522,48.86976833726734,48.87007527425664,48.87906431606792,48.8793696550314,48.88835872620171,48.88866246644724,48.89765156674501,48.89825418552105,48.90724337750481,48.90872113152014,48.91771059827646,48.91800121968602,48.90901169219008,48.91072012286782,48.84778998131479,48.84806848986825,48.83008802658933,48.83036475846249,48.82137441778648,48.82164943176118,48.81265899949063,48.81293229625756,48.80394177273698,48.80448327363795,48.79549260298206,48.79707694372664,48.80606794451243,48.80658289016873,48.81557396416523,48.81582900040822,48.82482009356158,48.82507352243153,48.83406463450137,48.8343164553072,48.86128974626713,48.86078412735573,48.86977505137433,48.86926267779565,48.87825346115596,48.87747227106325,48.88646285759618,48.88566653875672,48.89465692524254,48.89384547204703,48.90283565526194,48.90228625649294,48.9112762911458,48.91099903882765,48.91998898178755,48.92026629206985,48.92925625931979,48.92953196323036,48.93852195453266,48.93879605137693,48.94778606649343,48.94805855557647,48.95704859426856,48.95731947489509,48.96630953692365,48.96684641398339,48.97583655514964,48.97610255051212,48.9850927142136,48.98535709865671,48.99434728465263,48.99461005747956,49.00360026552868,49.00386142604222,49.01285165590282,49.01311120340544,49.02210145483532,49.02235938862906,49.03134966138562,49.0318606316207,49.04085097889307]},{"lng":[7.305697728888916,7.306169811297918,7.332820830756361,7.332353408349931,7.305697728888916],"lat":[47.7764935430336,47.76750103391795,47.76815319011816,47.77714583108035,47.7764935430336]}]],[[{"lng":[5.138626947496316,5.204336653361733,5.205159995440431,5.218300494507095,5.219121234918843,5.232259758752091,5.23634686462875,5.223219523313002,5.224856316485766,5.211733704135881,5.215011896591533,5.22812558894151,5.22894200963172,5.255165724172219,5.253541437334409,5.26665814285374,5.26584769404601,5.278966889906907,5.27815831600961,5.291280002824312,5.290473305735433,5.356096775728425,5.356892308534884,5.383139024327996,5.384720113091621,5.39783938795794,5.400201727344475,5.387089141953533,5.388666760856263,5.375558883152404,5.376349398921511,5.363244000419527,5.364036393837069,5.3247283988463,5.325527114498863,5.26003003375212,5.260839507325888,5.247743087813366,5.249365409470713,5.236273688976847,5.238711156650848,5.225626347302451,5.227253975137855,5.240334355415936,5.241145421554595,5.254223848015074,5.255840491253097,5.268914752290393,5.27293912944779,5.259875911620755,5.261487609266971,5.248429059043571,5.250043754007805,5.236989867573362,5.237798887360051,5.224747460425334,5.226368839631997,5.213322070945203,5.216569370454536,5.203531647908713,5.205157559955008,5.192124483902964,5.197006855721593,5.210026791851702,5.211647040218461,5.237678938623588,5.238484163271135,5.251498311278937,5.252301000781602,5.265313219246416,5.266913183355249,5.279921289383713,5.281515497670133,5.294519493669736,5.303238952346485,5.290258886399949,5.293427949059875,5.306399341257935,5.310342116486164,5.297381545491803,5.30290219466385,5.289956982584195,5.290746435089518,5.213093339204739,5.213895369510233,5.20095622047746,5.201760055311386,5.188823311201197,5.191239178081564,5.178309136576217,5.179922267499074,5.166996774223661,5.168612800749934,5.155691852019746,5.157310768161484,5.144394360295184,5.146016160075638,5.158928285391187,5.161351941999151,5.174257903826808,5.175062954427371,5.187967031568167,5.188769598055307,5.201671790426309,5.202471874672849,5.228272740023701,5.229068208656795,5.241966880727597,5.242759871611261,5.255656657842469,5.256447172846753,5.26934207316055,5.270130114154526,5.283023128474137,5.283808697325906,5.296699825575613,5.297482924152295,5.310372166257423,5.311152796425157,5.32404015231208,5.324818315936038,5.337703785532171,5.343900027660333,5.331031566637081,5.332581537227552,5.345445755180129,5.349304258857374,5.362158125621042,5.369063555295227,5.356228698472902,5.357763831117693,5.344933427760915,5.34723997215122,5.334416122515212,5.335186414122424,5.322364907003103,5.323136970197451,5.310317805033115,5.311091638068921,5.298274814297423,5.299050415430409,5.273421691251784,5.274201157302396,5.261389256819152,5.262170486432187,5.23655160916724,5.237336696906243,5.224529720044595,5.226889249849951,5.252490880715415,5.253272532045749,5.266071618920523,5.266850843710624,5.318041233948033,5.318811759203368,5.331607864333204,5.332375968873496,5.345170221169854,5.345935906811321,5.35872830620725,5.361017132781262,5.34823099943261,5.349759426226881,5.336977702438685,5.33774351092625,5.324964109232487,5.325731674448591,5.287401149311322,5.288174634883485,5.224305635587915,5.223521739385112,5.185197000691331,5.184406522402798,5.171630015822139,5.170837116785521,5.145280675100001,5.144483270012803,5.118923649205261,5.118121734980471,5.105340212792749,5.104535870956256,5.091752513243256,5.090945741985899,5.065375606366291,5.064564317828009,5.013418725119094,5.01259874350571,4.999810892756695,4.998988473416976,4.986198790704458,4.982070964908087,4.994871095005196,4.992396434958515,5.005203100490788,5.00190698856734,5.014722295700005,5.013899483218903,5.001082077391536,4.998605220788069,4.98578177059733,4.984953341232068,4.959303010969064,4.958470020687037,4.932816522360873,4.931978968055239,4.90632230642265,4.905480184988238,4.892650143436305,4.891805556068699,4.878973673148232,4.878126618013431,4.865292893824317,4.864443369087392,4.851607803730562,4.850755807555658,4.83791840113309,4.83706393168342,4.811385703955684,4.81052665149206,4.784845279257205,4.783981640677753,4.758297128750367,4.757428900954946,4.744584941821763,4.743714231238049,4.730868434048785,4.726498702415126,4.739355060699658,4.733236451315907,4.72036526969907,4.717730992696728,4.73060854071015,4.727099372159081,4.739985696444962,4.738233098271004,4.751123953737284,4.749374103611401,4.762269493957914,4.760522397681894,4.773422326611921,4.770805256706317,4.783711863680011,4.781097813850258,4.794011107506055,4.792270804411173,4.805188651801171,4.803451127704736,4.81637353255073,4.815506350499823,4.828431171813299,4.827565759343038,4.840492997736169,4.839629356634949,4.852559012719492,4.851697144777176,4.86462921916446,4.863769126172389,4.889638383007955,4.888782216049341,4.901719398618013,4.900865011296876,4.913804613508779,4.906973411663863,4.919930521682364,4.918223335373601,4.931185034150383,4.930333046505984,4.943297175584817,4.942446980381347,4.955413540372982,4.954565139421161,4.980503389980656,4.979658949695689,5.005602597407535,5.004762121996897,5.017736510772235,5.016058799392704,5.003080075691202,5.001396567246942,4.988413771449279,4.986724457033104,4.97373758679274,4.972042457483574,4.985033673147406,4.979104331396896,4.992111054763591,4.989570917196017,4.950531920775064,4.949677919746728,4.936663279108851,4.935806721794798,4.922790169230973,4.921931053698522,4.908912589315619,4.906326434882612,4.893301685103261,4.892436693317384,4.905463631355753,4.902008650820957,4.915044626532555,4.914182131804334,4.979377082545134,4.978525184544074,4.991567186336418,4.98986666705105,5.002913333197724,5.00121572487696,5.014267059212473,5.011724466555545,4.972551466540517,4.973405974151642,4.960351053597773,4.961207388455956,4.882896826945951,4.882027291502274,4.868974297832101,4.8681021818263,4.855047265982036,4.854172567460705,4.841115729556357,4.839360779849667,4.826299817299168,4.82189469172844,4.834966682100545,4.834086708051558,4.847161188160483,4.84628303829964,4.859360008781329,4.858483684973816,4.884642887540135,4.883770603709578,4.909935346499941,4.909067106994407,4.922152108828644,4.919551752353645,4.932643678401416,4.927446010245427,4.940551534534653,4.938820382864062,4.951930633087382,4.951066712638698,5.055976442923038,5.054283110941284,5.067402514617686,5.065712155069523,5.078836291912828,5.077148911085023,5.090277785003654,5.088593389195051,5.101727004101104,5.100886486859522,5.11402260885466,5.113183959431888,5.139461488043803,5.138626947496316],"lat":[47.10660420304542,47.10953444292694,47.10055362029978,47.10113477506224,47.0921537855308,47.09273323304686,47.04782693363122,47.04724805899311,47.0292854039613,47.02870516808846,46.99277968929043,46.99335946696871,46.98437785181667,46.98553241287926,47.00349604668744,47.00407117141505,47.01305302349732,47.01362667226241,47.02260858551974,47.0231807577013,47.03216273197594,47.03500030308687,47.02601776812235,47.02714144112743,47.00917577201104,47.00973500205256,46.98278577899119,46.9822268800922,46.96426069272472,46.96370042619723,46.9547173650257,46.95415562120888,46.94517261868472,46.94347819516131,46.93449547439425,46.93164025322655,46.92265804259645,46.92208235146718,46.90411799874082,46.90354094860027,46.87659436352469,46.87601606925239,46.8580516413926,46.85862970822284,46.84964730084515,46.85022367020236,46.83225846922389,46.83283302880044,46.78791852941804,46.78734453370105,46.76937858520048,46.76880323356017,46.7508372961702,46.75026058968096,46.74127765337972,46.74069947982981,46.72273367206905,46.72215414561065,46.68622233500388,46.68564168404051,46.66767568038442,46.66709367905808,46.61319504208123,46.61377636142037,46.59580948442145,46.59696694405277,46.58798319747022,46.58855945211174,46.57957553832409,46.58015010595209,46.56218188989066,46.56275465940336,46.54478600072702,46.54535697349171,46.4465241943952,46.44595444270785,46.41001403454086,46.41058334369357,46.36565602897256,46.36508727187265,46.30218745483653,46.30161790320801,46.29263210065329,46.28918258932937,46.28019739771734,46.27961711474196,46.27063197863821,46.27005024384035,46.2430948317218,46.24251187107541,46.22454153653895,46.22395723862322,46.20598690101147,46.20540126686857,46.18743092597043,46.18684395664115,46.16887361224445,46.16946035521404,46.14250406721072,46.14308891135612,46.13410325399906,46.13468642607381,46.12570059869117,46.12628209929098,46.11729610222947,46.11845420270271,46.10946792499193,46.11004452570919,46.1010580793582,46.10163301063499,46.09264639598887,46.09321965842017,46.08423287582354,46.08480447000415,46.07581751980117,46.07638744632568,46.0674003288601,46.06796858832288,46.05898130393791,46.05954789693322,46.05056044597168,46.05112537309349,45.97922281746558,45.97865875739985,45.96068275536413,45.96124659914785,45.91630503491599,45.91686678624189,45.83596732098543,45.83540653575268,45.81742844533577,45.816866324904,45.78989906869354,45.78933572159183,45.78034662538117,45.7797818376341,45.77079278985843,45.77022656204971,45.76123756285467,45.76066989556767,45.75168094509855,45.75054118569885,45.74155239282342,45.74098030163228,45.73199155801596,45.73084295454063,45.7218543698286,45.7212778584652,45.6943120734861,45.69546289294201,45.68647395879973,45.68704694181712,45.67805783859692,45.68033388822312,45.67134429211854,45.67190933518331,45.66291957168838,45.66348296307338,45.65449303252267,45.65505477281062,45.62808430099131,45.62752288078802,45.60954247905061,45.60897972943609,45.59998954503577,45.59942535998825,45.59043522229277,45.588733737091,45.57974386167579,45.57687776218308,45.58586709395271,45.58412860944744,45.59311755059577,45.59253486242572,45.60152363210093,45.60035340895203,45.6093418956265,45.6081652819684,45.6171534843379,45.61656275236344,45.62555078157079,45.62495839489838,45.63394625060529,45.63275662397099,45.64174419271092,45.63934597222528,45.6483330243036,45.64772949748947,45.65671637368818,45.65611118888849,45.7010440772605,45.70164983766409,45.72860918424908,45.72921374499493,45.76515915034273,45.76576262509047,45.77474893998379,45.77414535018796,45.80110358694911,45.80049810368895,45.80948394630791,45.80826810398041,45.81725365418558,45.81603138599837,45.82501664246498,45.82378794638085,45.83277290778263,45.8321561191636,45.84114090226249,45.84052244677482,45.84950705122391,45.8488869282815,45.85787135373334,45.8572495627499,45.86623380885665,45.86561034924571,45.8745944156591,45.87334260802428,45.88232637457909,45.88106812670248,45.89005159206433,45.88878690191353,45.89777006474657,45.89713527279326,45.90611825349502,45.90548178925743,45.95039517386668,45.95103224758951,46.01390930198957,46.01327137270956,46.04021741178295,46.04085570854634,46.07678341155184,46.07742064262244,46.0953843805224,46.09602029962122,46.11398404386147,46.11461864996974,46.13258240079026,46.1332156928878,46.16016124061625,46.16079333945861,46.18773872105091,46.18836962529262,46.20633316196179,46.20696274874624,46.22492629356027,46.22555456186087,46.234536367695,46.23516319540875,46.24414506384375,46.24477045037556,46.25375238127102,46.25437632602555,46.26335831924069,46.26398082162222,46.27296287701597,46.27420343247742,46.2831856697063,46.28380372183846,46.29278602071735,46.29340262833585,46.36525989873272,46.36587589578703,46.38383987784181,46.38445454664996,46.39343657110279,46.39404979163017,46.40303187798632,46.40364364963257,46.41262579774774,46.41384487379636,46.42282720172331,46.42404023993448,46.43302274673038,46.43362703010283,46.45159210887854,46.45098759065504,46.46895220869045,46.46834588515998,46.48631004182914,46.48570191162427,46.50366560629886,46.50427397319747,46.56714596451293,46.56775358799437,46.59469824364469,46.59286958300702,46.60185066659799,46.60123784475883,46.61021875294485,46.60960423660168,46.61858496902087,46.61796875756492,46.64491025909662,46.64429211047253,46.65327237871887,46.65389064814772,46.68981164837989,46.69042882405604,46.69940905614146,46.70247186918975,46.71145264548313,46.71206059287611,46.73002221858984,46.73062882502122,46.74859046900475,46.74919573341262,46.77613814524542,46.77431654165586,46.76533614948389,46.76472590671602,46.75574557944198,46.75205166406044,46.76103126716624,46.76040996391804,46.76938939009673,46.76876638486794,46.77774563375283,46.77712092593015,46.79507901325497,46.79445247931911,46.8393461193483,46.83997326864672,46.84895195504843,46.84957764477458,46.8585563993871,46.85918062892701,46.86815945160333,46.86940340549123,46.87838241825963,46.87962028099422,46.88859948289345,46.88921615950213,46.91615380416545,46.91676925967477,46.97064381930173,46.9712584156848,46.98921641470324,46.9898296656868,46.99880870590468,47.00365849894483,47.02161833473114,47.02221764682327,47.04017750788912,47.04077546683462,47.05873535338748,47.05933195810449,47.07729187035084,47.07788711975606,47.08686711499561,47.08746089046502,47.09644095090992,47.09762396058146,47.10660420304542]}]],[[{"lng":[-1.570651134625499,-1.518971054196566,-1.517025544658103,-1.504106085574265,-1.50216350570787,-1.489245527246619,-1.487305875239302,-1.474389377963358,-1.468581703761807,-1.481491933713869,-1.479555623022435,-1.492463157936612,-1.488588866798167,-1.50149162280155,-1.497616500050852,-1.484717911310396,-1.482783683178398,-1.469886570535235,-1.467955256714436,-1.455059620725795,-1.453131219413989,-1.440237060635716,-1.438311570031176,-1.425418889017781,-1.423496307319262,-1.397713300310905,-1.395795706205057,-1.382905381767449,-1.38099069251144,-1.329431724940423,-1.331338090146556,-1.318444771838374,-1.320349874776894,-1.307453876302719,-1.309357715376661,-1.296459035718281,-1.298361609329104,-1.285460247468253,-1.287361554015822,-1.274457508934182,-1.27635754681678,-1.26345081749598,-1.265349585110283,-1.252440170531913,-1.254337666273017,-1.241425565418603,-1.243321787680002,-1.230406999531032,-1.232301946704618,-1.219384470242535,-1.221278140718608,-1.208357974924798,-1.21025036709206,-1.184404060362817,-1.186293075680131,-1.069936483217851,-1.068066357753206,-1.01634539138788,-1.01448447518188,-0.9886246784929932,-0.9867687671401558,-0.9738400937321721,-0.9719870839162548,-0.9590599283321912,-0.9572098182259606,-0.9313579626807217,-0.9295128504085595,-0.9165881519768142,-0.9129045133444259,-0.8999834343014365,-0.8944702240508751,-0.8815548598712553,-0.8742233768845579,-0.8613158164294306,-0.8558317685512095,-0.8429299110480599,-0.8374592148711583,-0.8245630554690473,-0.8227431484516249,-0.8098485072024021,-0.8080314714737831,-0.7306642178867647,-0.7324687179266277,-0.6679699903624351,-0.6661759469326423,-0.6532766027733559,-0.6514854234555911,-0.6385876093617872,-0.6350117452060936,-0.6221175522619404,-0.6096408503716662,-0.6225204332390418,-0.6189583895591272,-0.6318332489722872,-0.6300512936030571,-0.6429235142554239,-0.6411402441073418,-0.6540098269656976,-0.6522252436489783,-0.6650921896800988,-0.6633062948033855,-0.676170604974048,-0.6743834001444212,-0.6615211667558935,-0.659736805076372,-0.6468760904861354,-0.6450945701583796,-0.6065153182484867,-0.6047407884788367,-0.5275797965353152,-0.525818484935038,-0.5000979007193038,-0.493076813234444,-0.5444825812761694,-0.5427209001026406,-0.5684163447362338,-0.5666512770175931,-0.5794961033456936,-0.5759640991585843,-0.5888042370225129,-0.5852711250940541,-0.5981065787072316,-0.5963390923186164,-0.609171930191275,-0.6074031364617782,-0.6202333595476822,-0.6184632600710321,-0.6954206332903553,-0.6972031037985379,-0.7356804951134772,-0.7374699120399769,-0.7631228447433513,-0.7649171498859972,-0.7905719705552411,-0.7923711662839028,-0.8051997979022373,-0.803398541618203,-0.8162245523582127,-0.8144220076288642,-0.8272453984558935,-0.8236385069338709,-0.8364572218737277,-0.8346528770398539,-0.8987277489971592,-0.9005423688485104,-0.9261724834299098,-0.9279919886192041,-0.9408082523136386,-0.9444537087696966,-0.9572735160059623,-0.9627537238176361,-0.9755791333153532,-0.9792406337073594,-0.9920695905864717,-0.9957383476240784,-1.008570853148942,-1.01040847123615,-1.02324246529884,-1.025082932001378,-1.037918414089465,-1.041605838153479,-1.054444870055708,-1.056291830510886,-1.069132349874989,-1.07468417645091,-1.087530311748363,-1.093095483481417,-1.105947239420176,-1.11152578323548,-1.124383164524739,-1.129975107407463,-1.11711151340659,-1.120839332344306,-1.107971009507345,-1.113562519231849,-1.100687386516463,-1.102550747829235,-1.115427958136753,-1.119161242337042,-1.132042025896598,-1.133911951916224,-1.159675921510693,-1.161550811865321,-1.200198601677134,-1.202080538251338,-1.253610991148897,-1.251720740284825,-1.264599798031891,-1.258927690115241,-1.246054860104448,-1.242281662109555,-1.22941239024825,-1.227529079339207,-1.214661291942406,-1.212780862108843,-1.199914559709777,-1.196160264571265,-1.183297519232718,-1.181423650807647,-1.168562391067195,-1.164821205786575,-1.177678325921725,-1.175806868495054,-1.201515219252558,-1.199640430281105,-1.263890727350889,-1.265775845249002,-1.278626208297159,-1.2805142002637,-1.293366039605513,-1.29714858648665,-1.310003967975354,-1.311898526001475,-1.324755383167818,-1.322858758298384,-1.335712956849344,-1.339511154246966,-1.352368893400874,-1.354271282458437,-1.367130495218083,-1.37094186077423,-1.383804615256658,-1.387623394216128,-1.400489691625443,-1.402402381980103,-1.415270152270479,-1.417185735426447,-1.455791664128433,-1.457714284098361,-1.496321016562147,-1.49825067536342,-1.523989623237407,-1.52592425263628,-1.551664922352014,-1.553604524634437,-1.566476020830448,-1.568418527546883,-1.594163838885153,-1.596111322999809,-1.608985136577906,-1.610935529146923,-1.636685468380563,-1.63864084285615,-1.651516966942303,-1.655434382556512,-1.668314038489678,-1.670276082765737,-1.683157197873182,-1.696929690802143,-1.68403404117577,-1.686002848269191,-1.673104501469129,-1.675072075221302,-1.66217103020447,-1.664137369029237,-1.651233624752478,-1.653198727062086,-1.627385221701473,-1.629347000760839,-1.616437238843208,-1.618397776954164,-1.605485312856861,-1.607444608426108,-1.56869726221563,-1.570651134625499],"lat":[46.62117840464156,46.62676380508985,46.61788292581991,46.6192751331156,46.61039388822854,46.61178427724296,46.60290266723528,46.60429123853349,46.5776450262772,46.57625725987514,46.5673752648996,46.56598621878725,46.54822247624772,46.54683241937494,46.52906882740354,46.53045834785406,46.52157613890441,46.52296384507051,46.51408127195291,46.51546716439741,46.50658422760501,46.50796830689067,46.49908500691616,46.50046727360569,46.49158361094121,46.49434297454471,46.48545868391967,46.4868357815612,46.47795112962655,46.48344300379616,46.49232871438234,46.49369808257525,46.50258396187652,46.50395204763021,46.51283809562194,46.51420489837519,46.52309111503257,46.52445663422381,46.53334301952172,46.53470725458894,46.54359380850205,46.5449567588829,46.55384348138561,46.55520514651732,46.56409203758384,46.56545241690324,46.5743394765075,46.57569856945103,46.58458579756674,46.58594360357042,46.59483100017103,46.59618751867055,46.60507508372927,46.60778399399005,46.61667198944615,46.62878765699538,46.61989731660355,46.62524067524389,46.61634920794678,46.61901105909647,46.61011898443591,46.61144732467217,46.60255490101236,46.60388143248996,46.59498866031652,46.59763655527708,46.58874317907268,46.59006454329763,46.57227700514098,46.57359630728052,46.54691354892649,46.54823053587001,46.51265122713183,46.51396564762918,46.48727944515863,46.48859155628183,46.46190377210763,46.46321357645058,46.45431721317038,46.45562521743432,46.44672851075115,46.45454252442152,46.46344073783128,46.46991109315641,46.46101163192994,46.46230080806538,46.45340100824345,46.45468838735096,46.43688802163765,46.43817335646877,46.37586751286095,46.37458390969134,46.35678192479797,46.35549726998747,46.34659638940099,46.34531043656847,46.33640971291879,46.33512246262692,46.32622189595021,46.3249333487613,46.31603293909348,46.31474309556943,46.30584284294613,46.30713243876944,46.29823184776127,46.29951965269241,46.29061872377051,46.29447213777306,46.28557037862888,46.29323405910179,46.28433073869019,46.28687246149108,46.25125633231876,46.24617061730063,46.23726733613442,46.23471571432786,46.22581283210681,46.22453495354348,46.20672940765891,46.20545047789024,46.18764505974592,46.18636507956898,46.1774624794941,46.17618120457909,46.16727875884688,46.16599618975193,46.1570938983984,46.14936764201352,46.15826845571056,46.15438381667991,46.16328379577737,46.16068584836735,46.16958523859507,46.16698063995526,46.17587943978821,46.17457458332816,46.16567603302923,46.16436988784281,46.1554714947555,46.15416406139877,46.13636749694601,46.13505902601617,46.12616085454576,46.11959669937811,46.12849361701635,46.12585669674068,46.13475301722728,46.13343200025511,46.15122385545221,46.14990079654805,46.17658711767501,46.17526176201607,46.19305166696635,46.19172426598092,46.20951328767388,46.20818383991248,46.21707795547938,46.21574671437183,46.22464048112198,46.2233074461094,46.24109418691612,46.23975910177735,46.24865207527107,46.24731519471819,46.2739927814624,46.27265359170918,46.29932955994439,46.29798805841279,46.32466240596359,46.32331859007145,46.34999131475198,46.3513359050437,46.369117766731,46.37046133063703,46.39713419238952,46.3984769873846,46.4073680117209,46.40602495835829,46.42380620852505,46.42246109307018,46.43135131832879,46.42865593399845,46.43754554623545,46.43349010214722,46.44237883918259,46.43694890702263,46.42806121528982,46.42670013217639,46.40003727240705,46.40139757013007,46.38362133147639,46.38497956313631,46.37609104011453,46.37744746783935,46.36855858914502,46.36991321349605,46.35213465089952,46.3534872125642,46.34459752923478,46.34594828904203,46.32816811943946,46.32681787825002,46.31792791054442,46.31522332277608,46.30633377911444,46.29954664566353,46.30843488722616,46.30707257825385,46.31596046280335,46.31459635182432,46.33237131010698,46.3310051344036,46.33989220756188,46.33852422833948,46.32963741773386,46.3282681602115,46.34604115964009,46.34466983504277,46.35355592726045,46.35218279786038,46.36995416617108,46.3685789672776,46.38634942195945,46.38497215210652,46.39385697019239,46.3924778930673,46.40136234958317,46.39721506714012,46.4060986296578,46.40193666623035,46.41081933155862,46.40803644279952,46.41691847576428,46.41412888144897,46.42301028048637,46.42161290104175,46.4304939336784,46.42769400888854,46.43657440514293,46.43517185907628,46.44405188754672,46.44124162674487,46.45012101637436,46.44871330091829,46.46647124353165,46.46506144254518,46.47393999493696,46.47252837882175,46.53467358648826,46.53608710825792,46.54496487422171,46.54637712281992,46.55525506313454,46.55666603800227,46.56554415264924,46.56695385322708,46.57583214218767,46.57864744644097,46.58752618148932,46.58893178420523,46.59781069336784,46.5992150197137,46.60809410297092,46.61229860553685,46.62117840464156]}]],[[{"lng":[-0.8640585344142477,-0.7744138065690578,-0.772622290760678,-0.7470085997554111,-0.7452219531623278,-0.7196101478429766,-0.7178283681059814,-0.6922184545079142,-0.6904415392645308,-0.6776378067304168,-0.6758637019122431,-0.6502586888678338,-0.6467209546578865,-0.6339217263346587,-0.6303911119604141,-0.6175954354301827,-0.6123113070911422,-0.5995212283136904,-0.5960063253552323,-0.608792312081392,-0.6052763186606316,-0.6180576725675208,-0.6162987575785431,-0.6290775243814669,-0.6255578613094275,-0.6383320015635395,-0.6365712554329088,-0.6493428116479733,-0.6458194936495,-0.6585864295767303,-0.6550620402592601,-0.6678243600304004,-0.6642989031493859,-0.6770566108915271,-0.673530090194573,-0.6862831900301275,-0.6721908497745057,-0.6594539696111973,-0.6559424122349484,-0.6432090382385537,-0.6397045069910059,-0.626974637867987,-0.6252255093403815,-0.6124971230913077,-0.6107507578071594,-0.5980238548981616,-0.5962802511259273,-0.5708288770798435,-0.5690900531951223,-0.543640579407235,-0.5419065330782651,-0.5291830156289689,-0.52572116832732,-0.5130011569679618,-0.5112733530104736,-0.5239913461596567,-0.522262257734041,-0.5604069941858459,-0.5586725914102412,-0.584095720766014,-0.5823580248989615,-0.5950667751725822,-0.5915895676328923,-0.6042937594154523,-0.6025542496608659,-0.6152558967463224,-0.6117750686622906,-0.624472163385558,-0.6209902677142931,-0.6082971877215103,-0.6065593513415831,-0.5557897352001077,-0.5540606590780351,-0.5413689348201084,-0.5396425967367726,-0.5269523496589111,-0.525228747899915,-0.5125399784560014,-0.5108191113074667,-0.4854440019654778,-0.4837278728794989,-0.4456672825264078,-0.4439578945540716,-0.4058986067483654,-0.4041959576311316,-0.391510489760154,-0.3898105660302054,-0.3771265826447169,-0.3686477563213864,-0.3813217247295412,-0.3796261089729791,-0.4049684882857322,-0.4032695905382922,-0.4286058936428274,-0.4269037180556391,-0.4395690917463713,-0.4378656385967376,-0.4505284953275178,-0.4471197566223968,-0.4344608897297745,-0.4259615828403281,-0.4386104892313097,-0.4369107888347393,-0.5127813825287587,-0.5144930140337844,-0.5397830176053153,-0.5414993470145202,-0.5541455515542782,-0.5558645932144923,-0.5811594045074401,-0.5828831485131614,-0.6081798326440471,-0.6099082812762294,-0.622557820977063,-0.6294868732306345,-0.6168293727597436,-0.6272329481522843,-0.6399024138880095,-0.6433801311918851,-0.6560530595558618,-0.6595377152455699,-0.6722141075125659,-0.6809486563846608,-0.7063198447790375,-0.7080729787173088,-0.7334460240371572,-0.7352039063588397,-0.7732654413286832,-0.7750300771205574,-0.8004057364544653,-0.8021751253070712,-0.8275526211062401,-0.8293267652962378,-0.8420167007735939,-0.8437935994475581,-0.881866144766997,-0.8836498064491686,-0.92172343983631,-0.9235138666466052,-0.9362059837640396,-0.9379991720071674,-0.9506927425639876,-0.9524886939491306,-0.9651837174631183,-0.9777907440669101,-0.9650816731845895,-0.9704901102557447,-0.9577744524172926,-0.9595767814146425,-0.9468585565023885,-0.9522640889207471,-0.9395392648835545,-0.9467492844789673,-0.9340158328331467,-0.9448417229063282,-0.9575873092251175,-0.9612061308069666,-0.9739552100742939,-0.9757678020112986,-1.001268334791689,-1.003085751599406,-1.028588094146037,-1.03041033811228,-1.055914484434622,-1.05774155784392,-1.070494812230193,-1.083320328800176,-1.070552865880483,-1.074220258778265,-1.061448161490407,-1.063280995027101,-1.050506295484544,-1.052337873983278,-1.039560571219047,-1.043221995562982,-1.03044004993154,-1.03226989385917,-1.019485341876731,-1.021313925736641,-1.008526766435461,-1.01035408866812,-0.9336070082395703,-0.9354228462945809,-0.8970355632153276,-0.8988460371747072,-0.873247612467089,-0.8750547632981995,-0.8622526610568737,-0.8640585344142477],"lat":[46.07773847158898,46.08688728094271,46.07798755604405,46.0805871843723,46.07168687098056,46.07427986139408,46.06537896102688,46.06796531511296,46.0590638292867,46.06035445670874,46.05145263272505,46.0540287896801,46.0362238836992,46.03750916894637,46.0197034058343,46.02098666694796,45.99427660073995,45.99555759522846,45.97774993801868,45.97646943106042,45.95866189401316,45.95738034157073,45.94847667888127,45.94719383790141,45.92938672396088,45.92810283900433,45.91919938765247,45.91791421543095,45.90010752373313,45.89882130903886,45.88101473551068,45.87972747912552,45.86192102323597,45.86063272594065,45.84282638715835,45.84153704973244,45.77030992428637,45.77159731011804,45.75378910922939,45.75507448242632,45.73726542255986,45.73854878453752,45.72964387227319,45.73092546656658,45.7220202190276,45.72330004618632,45.71439446382801,45.71694906002858,45.70804290221663,45.71059091686226,45.70168418508182,45.70295566482104,45.68514144329496,45.68641091875892,45.67750342954088,45.67623419365312,45.66732685138583,45.66351072025373,45.65460400507417,45.65205278163333,45.64314645444083,45.64186879917523,45.62405634654055,45.62277765075468,45.61387152521214,45.61259154865178,45.59477949888571,45.59349848328861,45.57568654080811,45.57696707432878,45.56806072143021,45.57316668924273,45.56425928216836,45.56553173350671,45.55662399371985,45.55789468560547,45.54898661355587,45.55025554653462,45.54134714267155,45.54387997200735,45.53497099886381,45.53875813049351,45.52984835254222,45.53362109452893,45.52471051480375,45.52596481967095,45.51705391179705,45.51830646134248,45.47374936014153,45.47249798622719,45.46358652365841,45.46107969160665,45.45216860673177,45.44965617486172,45.44074546832604,45.43948721233645,45.4305766486439,45.42931711184758,45.41149617692831,45.41275524175178,45.36820009263764,45.36694220595911,45.35803113146296,45.35045342410031,45.35936308099672,45.35682459226012,45.36573368017443,45.36446192707861,45.37337068277554,45.37082215781052,45.37973034224935,45.37717528280356,45.386082894524,45.38480285396253,45.42043139517668,45.42171239480165,45.47515380866878,45.47387136733052,45.49168393508202,45.49039949474512,45.50821120237598,45.50692476164272,45.55145116864617,45.54887131123743,45.55777582410802,45.55518940421822,45.56409333608662,45.56020158133845,45.56910468648393,45.56650209833062,45.57540461886885,45.57279546345606,45.58169739790668,45.58039029549513,45.58929188856415,45.58536072600275,45.59426148383212,45.59031590497416,45.59921582451152,45.59789734477825,45.60679692005081,45.60547667244033,45.61437590298965,45.61305388695828,45.6753440617039,45.6766678222489,45.70336291705966,45.70468590425635,45.7135843268289,45.71490604072807,45.7416014822219,45.74292242114067,45.77851600263938,45.77983641545799,45.83322542429265,45.83190351131673,45.84969858479737,45.84837464358726,45.85727178653548,45.85461881999375,45.86351536476676,45.86085578524429,45.86975173033476,45.86708553628431,45.8759808801837,45.87464523889289,45.93690818698693,45.93824560339637,45.95603466236874,45.95737105683133,45.9662656967701,45.96760081470678,45.97649561292173,45.97782945378412,45.99561927144897,45.9969520881729,46.00584710773261,46.00717864611944,46.01607382401027,46.01740408351026,46.02629941970427,46.03425030574454,46.04314706156742,46.04710255927247,46.05599997478306,46.0586298048247,46.06752762794022,46.06884049161999,46.07773847158898]}]],[[{"lng":[0.272291262843128,0.4330149081850937,0.4347183609836673,0.4749050335881797,0.4766007735032598,0.4899951355530975,0.4916877986315878,0.5050804034913533,0.5084588222394041,0.5218473547291799,0.5252181172572987,0.5118342111399633,0.516891621945036,0.5035152032413133,0.5052018044012455,0.4918282497092679,0.4935164022347746,0.4801457105295543,0.4818354125309788,0.4684675827874343,0.4701588323769886,0.45679386356993,0.4584866588617074,0.4317629988848508,0.4334596390657917,0.4067428142515623,0.408443294317374,0.3950880199017028,0.3967900372827087,0.3700857637897126,0.3717916128079879,0.3584426130447191,0.3618566123301001,0.348512761835977,0.3502209097275581,0.3368799126449004,0.3385895884858885,0.3252514437869427,0.3269626457097558,0.3136273523666988,0.3153400785056154,0.3020076354905347,0.3037218839816895,0.2903922902665855,0.2921080592479577,0.2787813138047557,0.2804986014161867,0.267174703216728,0.2688935075999024,0.2289320443748708,0.2306569256568459,0.1108236563980057,0.1143121055936122,0.1010046967042201,0.1062383641086023,0.0929383446205079,0.09642811384989625,0.08313320501782744,0.08487919318612297,0.07158712325312873,0.0733346015838378,0.04675670897766873,0.04850794093871432,0.03522211755085455,0.03697483465575461,0.01040943298343045,0.01216589561114372,-0.001113683391318162,0.0006442593719573404,-0.01263248526892696,-0.01087306419469711,-0.02414697550993435,-0.0223860779475483,-0.03565715697312146,-0.03389478474355491,-0.04716303251549948,-0.04187384602131519,-0.05513475632048555,-0.04456398789032301,-0.03131657636372183,-0.02604846677455652,-0.01280722121560713,-0.009303524433647407,0.003933803189170878,0.007429912950733648,0.02066332422259019,0.02240797716603838,0.03563971402707302,0.03738135420552171,0.09030498767017556,0.08857231270961881,0.1415139200068836,0.1432376236825004,0.169707303736342,0.1714257580604197,0.1978931845498143,0.1996063923128906,0.2128386976200317,0.2145489043957899,0.2277795225682953,0.2294867303655229,0.2427156609140802,0.2478260309663827,0.2346038212905915,0.2380114429053357,0.224794261386285,0.2264991780171949,0.2132847852680892,0.2149911828394452,0.2017795778585484,0.2034874545698608,0.1902786363553488,0.1919879904078899,0.1655764798174037,0.1672895398672305,0.1276831273249478,0.1259633781558011,0.112760124154862,0.1110373850650815,0.0978324592937773,0.09610672829121476,0.0829001312437479,0.07944191714486402,0.0662314177003637,0.06276567848642277,0.04955127505514915,0.04434020996503808,0.03111966535866205,0.02763730345681846,-0.1838856343001757,-0.185663734579666,-0.1988812798271918,-0.2024443074116447,-0.2156657410541523,-0.2299673343693663,-0.2432060873993843,-0.2467938944527982,-0.2600365479929824,-0.2636320237523367,-0.2768785793404805,-0.2804817346222389,-0.29373219379421,-0.3009570901013733,-0.2876976408262956,-0.2913103997734561,-0.2780458608014495,-0.2798511912735819,-0.2533158437355652,-0.2551174685192056,-0.2285752629688367,-0.2303731771469476,-0.2038241140927208,-0.2056183127448508,-0.1923406451777589,-0.1941333826088261,-0.1808528709072948,-0.1826441452994532,-0.1693607884129312,-0.1729412037079289,-0.1596527376779258,-0.1614418762956924,-0.1481505616199322,-0.1517266967196016,-0.1384302657523627,-0.1420050499673945,-0.1287034979653298,-0.1322769267727018,-0.1189702489868406,-0.1225423178535485,-0.1092305095292987,-0.1128012139123366,-0.09948427028947672,-0.1030536056358043,-0.0897315219484829,-0.09151510482338904,-0.07819015692177203,-0.07997225517171211,-0.06664444200010818,-0.06842505377964804,-0.05509437428242154,-0.05687349774425846,-0.04353995086581668,-0.04531758416079365,-0.03198116884559479,-0.03375731012270213,0.006262291563415764,0.004492220327825114,0.05786898015183314,0.05610727873889555,0.06945520860397369,0.06769501165734866,0.08104581256063273,0.07224448667171847,0.05888220793456666,0.05711727989624727,0.07048185715890494,0.06518923095240703,0.07856129136999257,0.07679780461761396,0.09017274923302673,0.08841077645070457,0.1151670164594098,0.1134088655685555,0.2740224869052076,0.272291262843128],"lat":[48.34511018042865,48.35919417408778,48.35028391251222,48.35376775768414,48.34485671323128,48.34601451885436,48.33710316634065,48.33825911634718,48.32043572444534,48.32158958417396,48.30376543484466,48.30261204538187,48.27587598781685,48.27472168557913,48.26580975750448,48.26465407329029,48.25574230830217,48.25458524274324,48.24567364091018,48.24451519463775,48.23560375602803,48.2344439296729,48.22553265435446,48.22320862760294,48.21429775195771,48.21196773866664,48.20305726348896,48.20189007219452,48.19297976092182,48.19064101124774,48.18173110150651,48.18055954417817,48.16273997951711,48.16156728511999,48.15265763012606,48.15148356152196,48.14257407076093,48.14139862857644,48.13248930211298,48.1313124869743,48.12240332487278,48.12122513740565,48.11231613973016,48.11113658055988,48.10222774737423,48.10104681712568,48.09213814849334,48.09095584779099,48.08204734377514,48.07849150527127,48.06958364584543,48.0588314427824,48.04101984544101,48.03981760344181,48.01310036404887,48.01189724456916,47.99408585522379,47.99288161628069,47.98397604969752,47.98277044904247,47.97386504888647,47.97144952125313,47.96254453124467,47.96133460530481,47.95242978203774,47.95000560809827,47.94110119599622,47.93988694903375,47.93098270398485,47.92976709923932,47.92086302130014,47.91964605938791,47.91074214861479,47.90952383015175,47.90062008660071,47.89940041220236,47.87268944871931,47.87146890997878,47.81804633923393,47.81926540771646,47.79255232864364,47.79376906620372,47.7759594663116,47.77717411915967,47.75936371850288,47.76057628819439,47.75167072728563,47.75288145791939,47.74397557612399,47.74880156837082,47.75770841728887,47.76250983034405,47.7536020191978,47.75599266440025,47.74708429680908,47.74946807621183,47.74055915380517,47.74174840985907,47.73283917220007,47.73402659361594,47.72511704119675,47.72630262858726,47.69957279815919,47.69838792268502,47.68056812566134,47.67938212959039,47.67047235276296,47.66928499961548,47.66037538302056,47.6591866734065,47.65027721710342,47.64908715163225,47.64017785568003,47.63779342132873,47.62888452405988,47.6252966434084,47.63420482402984,47.63300543982215,47.64191330274387,47.64071208625855,47.64961963098904,47.64841658161721,47.66623095537454,47.66502583166832,47.68283941019084,47.68163221060443,47.70835126603917,47.70714174702995,47.72495357439168,47.70537665141008,47.71427852877177,47.71304117486876,47.73084419374375,47.72960475028596,47.80081163037167,47.79956860206496,47.8173690214827,47.81612389732457,47.83392349613769,47.83267627456625,47.85047505147594,47.84922573092778,47.88482131690728,47.88607164194075,47.90386945593377,47.90511868402881,47.91401772213987,47.91651188001239,47.92541134009708,47.92789959664738,47.93679947796133,47.93928183004974,47.94818213184683,47.9494211550923,47.95832162729793,47.95955929786474,47.96845994042604,47.96969625769854,47.98749780462437,47.98873301703743,47.99763392148982,47.99886777918096,48.01666985026772,48.01790260139372,48.03570485651493,48.03693650018032,48.05473893984858,48.05596947515648,48.07377209988396,48.07500152593613,48.09280433623457,48.09403265213142,48.11183564851212,48.11306285335266,48.12196448357716,48.12319032818329,48.13209212920842,48.13331661295827,48.14221858472792,48.1434417069991,48.15234384945686,48.15356560962664,48.16246792271583,48.16368832016102,48.17259080382458,48.1762430731675,48.18514622098144,48.18999434003828,48.19889839542116,48.20010664084241,48.20901086562722,48.21021774369944,48.2547389582338,48.25353085342538,48.26243462396058,48.26364297445387,48.29035457025685,48.29156204287364,48.3004660031061,48.30167210550966,48.3105762360942,48.3129840826409,48.32188862862011,48.3362027913326,48.34511018042865]}]],[[{"lng":[-4.050951753415182,-4.037679093256417,-4.03519013541506,-3.968825710725396,-3.966348891789998,-3.926527163628194,-3.92405806797288,-3.884235720341417,-3.881774346744739,-3.828675488261827,-3.826224046385106,-3.746565053058816,-3.749003218292305,-3.722439420694313,-3.724874236616717,-3.685015930968562,-3.687445173913687,-3.607693842677664,-3.605277922424071,-3.591985488318092,-3.589572862478068,-3.576281861771118,-3.573872528384488,-3.560582961886216,-3.54376307219074,-3.55703711331705,-3.552236591432933,-3.565505422830547,-3.563104546067421,-3.616163195262752,-3.618572914563912,-3.658365289430367,-3.66078270620089,-3.780137103486797,-3.777699827989387,-3.804209905853051,-3.801769304115359,-3.828271800656287,-3.825827877716946,-3.839075733443209,-3.836630692865596,-3.863119620961621,-3.860671267288544,-3.8739123408501,-3.871462874254869,-3.884700956393882,-3.882250378518679,-3.895485470543402,-3.885685218263471,-3.872458892237363,-3.867569634823855,-3.854346893788979,-3.851906072197488,-3.838684727690797,-3.836247171380166,-3.823027224214282,-3.818159712821964,-3.80494335075804,-3.795229947577742,-3.808437570709605,-3.803582929351447,-3.79037967037114,-3.785533669014675,-3.772333986851756,-3.769914767466337,-3.743517414888571,-3.741103620401562,-3.701508275118743,-3.699102083754053,-3.659506272455632,-3.657107682916691,-3.604311129638014,-3.601922322799135,-3.549122129536268,-3.546743105895438,-3.533543314150553,-3.531167522139563,-3.517969144773583,-3.515596582479573,-3.502399620273372,-3.500030285783809,-3.486834739516668,-3.48446863091935,-3.471274501368943,-3.468911616752006,-3.455718904694402,-3.45100061903636,-3.424621631215348,-3.422268407071723,-3.395890737310225,-3.393542909967838,-3.340787191648478,-3.338449121626663,-3.312071087669367,-3.309738410341067,-3.296550443718786,-3.291892532248859,-3.278708175185274,-3.264772092102271,-3.291113923061347,-3.293438399342742,-3.346121753391314,-3.348455951579086,-3.387967082719002,-3.390308829630786,-3.42981967979922,-3.427471415778833,-3.466968933467084,-3.469323710059375,-3.482490201624303,-3.484848184622034,-3.498016086083386,-3.50037727738403,-3.513546587971343,-3.515910989472707,-3.529081708413929,-3.531449322014155,-3.544621448535628,-3.546992276133185,-3.612852275765013,-3.610470594679502,-3.689464215620069,-3.691858904020668,-3.71818827406448,-3.720588348861352,-3.746918955436429,-3.749324418729636,-3.775656254385584,-3.778067108270462,-3.804400165549064,-3.806816412116215,-3.819983937943019,-3.822403413452709,-3.835572324886708,-3.83799503122802,-3.85116532747174,-3.853591266534044,-3.866762946788411,-3.869192120461383,-3.882365183925707,-3.887231074542869,-3.900407688535821,-3.902844408907821,-3.916022404857562,-3.918462367049621,-3.931641744149884,-3.936529231507955,-3.949712159004973,-3.954608293962496,-3.967794772625196,-3.972699566475761,-3.985889597069705,-3.998181380275426,-4.011381490044425,-4.026180514616881,-4.039392900736189,-4.046813664723853,-4.060031796890538,-4.062509753504843,-4.181456352224491,-4.183955043967122,-4.23680789345601,-4.239316406848793,-4.265742314412469,-4.268256292778165,-4.281470203321633,-4.289025337971178,-4.275804887759622,-4.28084284120093,-4.267617209090999,-4.275175933722704,-4.288408120335946,-4.301039228922217,-4.314281535255525,-4.316813300181321,-4.330056973689095,-4.340204009727308,-4.287189291245814,-4.284659625473087,-4.271406080992262,-4.268879729508519,-4.255627557979476,-4.253104518864172,-4.239853721141682,-4.237333992474527,-4.210834327556729,-4.208320101720958,-4.181821554457933,-4.179312829397368,-4.139565474567618,-4.142067612833647,-4.128814669345235,-4.131315717896365,-4.118059762556136,-4.120559719756179,-4.107300751231335,-4.109799615442263,-4.096537632399659,-4.099035401981614,-4.085770403087764,-4.088267076399039,-4.048460589177892,-4.050951753415182],"lat":[48.28587352767651,48.28757826460244,48.27876761865958,48.28726573514447,48.27845326064203,48.28353202078283,48.27471840792624,48.27978183019098,48.27096708253298,48.27769468192199,48.26887846425353,48.278920098096,48.28773834216749,48.29107349364676,48.29989229945489,48.30488409107543,48.3137037938868,48.32364636618721,48.31482465457182,48.31647583674409,48.30765368149501,48.30930293610835,48.30048033781686,48.30212766546057,48.24036407887917,48.23871907716978,48.22107201491574,48.21942608526518,48.21060272115285,48.20400442372853,48.21282645821247,48.20786003827542,48.21668096148279,48.20169284328699,48.19287493817033,48.18952743773902,48.18071009389392,48.17735691517154,48.16854013315589,48.16686149988776,48.15804494244677,48.15468359030691,48.14586759537556,48.14418487753182,48.13536910728287,48.13368514163806,48.12486959605517,48.12318438319203,48.08792241620428,48.08960627650741,48.07197393435455,48.07365553558227,48.06483885673047,48.06651853722272,48.05770140805203,48.05937916838793,48.04174389728671,48.04341940220007,48.00814615846117,48.00647199542437,47.98883536459554,47.99050885759564,47.97287110401874,47.97454234674539,47.96572296597432,47.96906004077355,47.96023987971779,47.96523263535629,47.95641136330482,47.9613888928687,47.95256651331389,47.95917975737792,47.95035594367486,47.95694256411377,47.94811732207753,47.94975969420103,47.9409340130788,47.94257447531618,47.93374835568589,47.93538690861676,47.92656035105572,47.92819699525973,47.91937000034478,47.92100473640146,47.91217730470886,47.91381013319782,47.89615428755318,47.89941389837486,47.89058515980119,47.89383779768777,47.88500830002612,47.89149330966628,47.88266240775345,47.88589478095007,47.87706312486807,47.87867661763396,47.86101233599518,47.86262360426726,47.80962623231724,47.80640597161576,47.81523849546443,47.80877774616888,47.81760887350676,47.81274577110143,47.82157581989115,47.81669754310361,47.80786846639565,47.80297696331487,47.81180506534162,47.81017108432916,47.81899875037401,47.81736286615399,47.82619009564426,47.82455230764008,47.83337910000256,47.83173940763764,47.84056576229855,47.83892416499631,47.84775008138136,47.83951678865596,47.83069251337297,47.82076248763958,47.82958478409441,47.82626150205613,47.83508302362571,47.8317527732846,47.84057351823269,47.83723629818418,47.84605626477342,47.84271207361579,47.85153126010767,47.84985646644535,47.85867520523955,47.85699850109684,47.86581679161254,47.86413817641586,47.87295601807167,47.87127549124749,47.88009288346144,47.87841044443616,47.89604421424441,47.89435952640812,47.90317590327325,47.90148930165124,47.91030522717896,47.90861671119745,47.92624754340239,47.92455677498734,47.94218647172672,47.94049344927657,47.95812200879485,47.95642673070672,48.00049441628162,47.99879586222794,48.05167123427216,48.04996905679388,48.07640415896661,48.07469937520275,48.08351050267589,48.06809316864489,48.07690108941975,48.07000643865322,48.0788128603665,48.07535535579698,48.08416096670337,48.08242949599103,48.10884457804608,48.11057709040467,48.12818724869629,48.12991887357285,48.15633426787206,48.15460159987904,48.19862315519143,48.19688716055,48.20569076802744,48.20395283916666,48.23916468677586,48.24611248015528,48.2373082976922,48.23904093067704,48.23023628167255,48.23196697962614,48.22316186468297,48.22489062818369,48.21608504790397,48.21953712092161,48.21073072884592,48.21417576304301,48.2053685609536,48.21052317650266,48.21933141582753,48.2210467931929,48.2298552615416,48.23156939689385,48.24037809428717,48.24209098704354,48.25089991350207,48.25261156307936,48.26142071862342,48.26313112443801,48.27194050908777,48.27706322549756,48.28587352767651]}]],[[{"lng":[1.71691101236469,1.810803508719883,1.812261228767621,1.825674040988144,1.827128768997449,1.840539725702697,1.86513081228346,1.851759428076185,1.854644821980316,1.84127854899071,1.842722592904572,1.829359111554326,1.830804823751348,1.817444133121114,1.820338242327898,1.8069826538126,1.809878794706725,1.7965283037172,1.797977711433264,1.811325893451323,1.818551686569783,1.831888812764932,1.837648624007994,1.824320704905838,1.827201351005555,1.813878501493966,1.81676116947062,1.803443385002251,1.804886049012519,1.791571031722697,1.793015345523103,1.779703094501566,1.782594373165244,1.76928717819177,1.770734140565966,1.757429708724555,1.760326274994215,1.747026892443888,1.748476493857512,1.735179871305721,1.736631111838456,1.723337248375209,1.726242357081296,1.712953533940848,1.714407399642492,1.70112133246002,1.702576831026752,1.689293518892296,1.690750648437109,1.66419000876253,1.665651044309019,1.5992691855726,1.596323700077323,1.583044215474726,1.581568212841189,1.568286933314922,1.566807996255012,1.553524922194099,1.552043048651967,1.538758180446874,1.537273368365838,1.523986706408458,1.522498953731013,1.50921049841467,1.507719803082474,1.481139794490836,1.479643873907291,1.439770688371422,1.438267258973829,1.398391654498761,1.396880712952135,1.357002712039376,1.355484255023373,1.342190299281837,1.340668884752692,1.327373145438535,1.325848771336086,1.312551248859735,1.309495896769802,1.296194308463547,1.283927323617527,1.297247212123545,1.295713050846534,1.309035734418861,1.30750318152612,1.320828661114636,1.319297718500227,1.332625995054637,1.331096664614454,1.357759314758653,1.35623389605063,1.369568270202381,1.366519986278534,1.379859460189987,1.378336597442193,1.391678873065378,1.390157631998719,1.403502710282259,1.401983092803617,1.415330974695953,1.412294311448199,1.425647304588831,1.424130261300978,1.437486061288433,1.435970647892124,1.449329255674982,1.446301014497513,1.459664742747026,1.455124232883306,1.468495401322949,1.463955734292233,1.490713470821648,1.489203530293421,1.569502589165741,1.568005903174485,1.66172685947815,1.660245778096251,1.673638773943917,1.672159355012578,1.685555167169423,1.684077412631239,1.697476042036874,1.694523202311912,1.707926981513509,1.704976153072934,1.718385086734418,1.71691101236469],"lat":[48.32745939083186,48.33447631890719,48.32554276994115,48.32653848360638,48.3176046687853,48.31859855412452,48.16671068718617,48.16572023994285,48.14785028956278,48.14685862620422,48.1379237579076,48.13693067766931,48.12799594789715,48.12700145141714,48.10913220561293,48.10813649574366,48.09026739994057,48.08927047767704,48.08033603649012,48.08133275649943,48.03665858239258,48.03765267788582,48.00191138309306,48.00091809256531,47.98304746330778,47.98205296197242,47.96418247827556,47.96318676712142,47.95425163007731,47.95325450859389,47.94431950859173,47.94332097741065,47.92545118696061,47.92445144865746,47.91551665817235,47.91451551165635,47.89664614005317,47.89564378825148,47.88670920709545,47.88570544856285,47.87677100465141,47.87576584001688,47.85789716142393,47.85689079418589,47.84795655946536,47.84694878760337,47.8380146902709,47.83700551441243,47.82807155455863,47.82604878960706,47.81711517107517,47.81203117173573,47.82989629534651,47.82887426687489,47.83780652310978,47.83678268234812,47.84571466581022,47.84468901213155,47.85362072235567,47.85259325513292,47.86152469165328,47.86049541025927,47.86942657260957,47.86839547641695,47.87732636413031,47.87525893342209,47.8841893374483,47.88107550867579,47.89000521779568,47.8868762916554,47.89580530250768,47.89266127565602,47.90158958487694,47.90053814888389,47.90946617825422,47.90841292217387,47.91734067122164,47.91628559442667,47.9341404629999,47.9330833515268,48.00449840257992,48.00555722426214,48.01448401478812,48.01554143912676,48.02446837607485,48.02552440244,48.03445148572644,48.03550611348776,48.04443334302847,48.0465381871841,48.05546577592675,48.05651599127651,48.07437139368209,48.07542042071623,48.08434823442705,48.08539585969933,48.09432381923932,48.09537004211688,48.10429814740007,48.10534296724959,48.12319940288454,48.12424303088791,48.13317136128614,48.1342135847736,48.14314206078828,48.14418287912498,48.16204005640242,48.16307968020486,48.18986558724151,48.19090422675426,48.21769017792381,48.21976386632441,48.22869280820871,48.23487625243781,48.24380638891961,48.25094811561777,48.25987964338962,48.26089361045518,48.26982528120401,48.27083783255492,48.27976964618755,48.28078078118242,48.2986446306146,48.29965455472178,48.31751856315257,48.31852727537254,48.32745939083186]}]],[[{"lng":[-2.871821158685781,-2.792056663593403,-2.789789762434126,-2.77649531647352,-2.774231656524793,-2.760938704799456,-2.754160455005858,-2.740873463161928,-2.738618284618275,-2.751903045396787,-2.74513682874942,-2.758414166479792,-2.756158536021012,-2.76943291130443,-2.767176056243131,-2.793718147985023,-2.789198547329141,-2.802464042708531,-2.795685492314376,-2.782426657864889,-2.777917065277737,-2.764661933243146,-2.762410852332938,-2.749157204970605,-2.746909337859275,-2.733657175901974,-2.729168859366707,-2.715920399410194,-2.713679946490968,-2.7004329729742,-2.693724203728676,-2.680483144659698,-2.671560807035014,-2.658327867794397,-2.656101958330042,-2.642870505567037,-2.638426055056631,-2.611969820087404,-2.60975348338782,-2.59652649436461,-2.594313344683809,-2.581087845004208,-2.578877880391498,-2.552429144901936,-2.550224570416734,-2.523777388064235,-2.521578201369983,-2.508355746732867,-2.503964700261524,-2.490745946275369,-2.479796305023333,-2.49300404173333,-2.490814812237675,-2.504019639391312,-2.501829176551844,-2.515031095345723,-2.512839400850986,-2.539236714254554,-2.537041593681762,-2.708526114662721,-2.706303467562641,-2.719487384429246,-2.721712220057601,-2.761266218346238,-2.763498599830181,-2.776684011956875,-2.783393629318918,-2.796584885597855,-2.798825587504675,-2.904347011778825,-2.906606216365283,-2.932983658187461,-2.935248234176372,-2.948438044632157,-2.950705806800854,-2.977087602406558,-2.979360740557507,-2.992552723832325,-2.994829052415612,-3.060788850292541,-3.058501587662029,-3.071689145370543,-3.069400705821812,-3.082585339719182,-3.080295724908001,-3.093477436225598,-3.09118664780596,-3.157073187892102,-3.161677579979305,-3.174857020129981,-3.177162917386194,-3.16398129675534,-3.168591774911008,-3.142217570851869,-3.144519965690527,-3.131329562545955,-3.133630786606947,-3.120437453482495,-3.122737505110266,-3.109541240767884,-3.111840118305073,-3.098640921506474,-3.110139573683175,-3.0969286733822,-3.10613709901375,-3.092916667207614,-3.097522586041928,-3.084297008077447,-3.086599293382237,-3.073370766810866,-3.075671867544135,-3.062440391118962,-3.064740305605509,-3.051505878079392,-3.053804604642211,-3.040567224767776,-3.042864761728015,-3.029624428257648,-3.031920773934652,-3.018677485620515,-3.032463659015215,-3.019206350775127,-3.026106542505313,-3.012841835123928,-3.015141720377231,-3.001874044510735,-3.004172729795395,-2.990902084188412,-2.99319956780833,-2.979925951205278,-2.982222231462517,-2.955668305164108,-2.957961155439374,-2.931399786111442,-2.933689201357836,-2.907120388491373,-2.909406363657678,-2.869540859849789,-2.871821158685781],"lat":[48.23945521480803,48.24880553794259,48.23996302937898,48.24151551314416,48.23267258929425,48.23422316261727,48.20769284266584,48.20924088082899,48.20039692553906,48.19884919982115,48.1723176625464,48.17076927843083,48.16192554189974,48.16037587551668,48.15153234968504,48.14842885971219,48.13074275295227,48.12918924334308,48.10266025546385,48.1042128270847,48.08652569922289,48.08807605458029,48.07923202562808,48.08078047769535,48.07193603535747,48.07348258472727,48.05579277264866,48.0573371094223,48.0484917403751,48.05003417607303,48.02349652967619,48.02503644607243,47.98965025991509,47.99118735141555,47.98234024292688,47.98387543730458,47.96618030064792,47.96924469292104,47.96039635839514,47.96192586495107,47.95307712286564,47.95460473466303,47.9457555855769,47.94880543270759,47.93995557173145,47.94299845578626,47.93414788463993,47.93566663994311,47.91796458867487,47.91948114804656,47.87522275126469,47.87370770910783,47.86485603284481,47.86333970799597,47.85448823477605,47.85297062782524,47.84411935765639,47.84107999600395,47.83222923269652,47.81232290979787,47.80347602014136,47.8019339909048,47.81078057278653,47.80614406810433,47.81498962182992,47.81344064709826,47.83997576185912,47.83842427606001,47.8472687980334,47.83479745102828,47.84363937859555,47.8405050931819,47.8493462903661,47.84777646111998,47.8566172400639,47.85347220716416,47.86231225300916,47.86073704862091,47.86957667466604,47.86167534248129,47.85283729446098,47.85125259817909,47.84241476057727,47.84082879944025,47.83199117225443,47.83040394684526,47.82156653007272,47.81360828416308,47.83127983553644,47.82968281003801,47.83851810645166,47.84011545061676,47.85778635961185,47.86097758012185,47.86981351137295,47.87140706789128,47.8802432107627,47.88183550356631,47.89067185806155,47.89226288656685,47.90109945268923,47.9026892163121,47.94687204381879,47.9484618139047,47.98380744032409,47.98539689875795,48.00306971381556,48.00465822303089,48.01349479053656,48.01508203132625,48.02391881169277,48.02550478346859,48.03434177669802,48.0359264788713,48.0447636849655,48.04634711694708,48.05518453590769,48.05676669710799,48.0656043289364,48.0671852187654,48.12021071688238,48.12179192395212,48.14830421553997,48.149884785676,48.15872232567104,48.1603016215953,48.16913937553297,48.1707173966519,48.17955536453257,48.18113211025212,48.18997029207595,48.19311963744241,48.20195835070555,48.20510195325586,48.21394119735277,48.21707905384113,48.22591882816447,48.23061459502574,48.23945521480803]}]],[[{"lng":[-0.09365514296152488,0.0187409841305475,0.02033174362838696,0.04531006265581246,0.04689630311684392,0.0718726660640672,0.07345438974935016,0.08594135390671923,0.08752049138193174,0.1000060005049147,0.1015825533932544,0.1140666071010354,0.115640577025188,0.128123174938055,0.1296945635201812,0.1421757052595304,0.1437445141212647,0.1562241993095772,0.1577904300720356,0.1702686583328973,0.1718323126166725,0.2092640268872099,0.1983452621018402,0.2108369340793114,0.2092764434060098,0.2217705151915004,0.2202113072816222,0.2577021256402225,0.2592555332381891,0.2717514716358631,0.2733022990016833,0.2857967691147978,0.2873450178782881,0.2998380193364501,0.3029287193877356,0.3154183200069324,0.3200437565377769,0.332528027901859,0.3417500342437025,0.3292773253473644,0.3308140146563935,0.343284799177426,0.3478852679991394,0.3603507420849639,0.3618810360077255,0.3868095121371398,0.3883353278917437,0.4007983287352006,0.4023215898127201,0.4272451141114912,0.4287639014046624,0.4412244236643044,0.4427406599924976,0.4551997147828533,0.4567134017609203,0.4691709887272386,0.4706821279694957,0.4831382467581068,0.4861548068013863,0.4986075387480428,0.5061284129872631,0.4936852610794809,0.4966930720188868,0.4842541947433024,0.4857590769475159,0.4733225598096796,0.476334274323271,0.463902026329215,0.4654088567796827,0.4405495248487689,0.4420595468042785,0.4296324623395743,0.4311437656041622,0.4187190373378618,0.420231620462623,0.4078092476066151,0.4108363441336622,0.3984182294135585,0.3999327409693003,0.3751016676836052,0.3766193557857995,0.3145590794329683,0.3130318884942415,0.3006192919579838,0.299089568655947,0.2866755263032886,0.285143269046879,0.2603127494427485,0.2587760555234671,0.2463595794604204,0.2448203479340455,0.2324024279620562,0.2308606572363352,0.2060223892468716,0.2044761754967132,0.1796359422715568,0.1780852832603933,0.1532430899391836,0.1516879834330188,0.1392656777138575,0.1377080242358836,0.1252842789296795,0.122163228660768,0.1097361401590971,0.1081727406436375,0.09574421283041712,0.09261165921207046,0.08017978679351975,0.07075508348105473,0.0583122299761442,0.05043081749049417,0.0379788737911637,0.03639871406920924,0.02394532791336665,0.02236259753202457,0.009907769299720691,0.008322466651942589,-0.004133803275683989,-0.005721679797453819,-0.01817939103816722,-0.01976984304199814,-0.0446876716963036,-0.04628261702277178,-0.05874273320401182,-0.06034025769262892,-0.08526289074832452,-0.0868649128613586,-0.1117894648120606,-0.1133959867771069,-0.1383224523522927,-0.1399334763942431,-0.1523979044142517,-0.1540115154374267,-0.1664773786575215,-0.1680935782719671,-0.1805608762983271,-0.1870400739990618,-0.1745650972136277,-0.1761846590102192,-0.1637072758059096,-0.1653255885234081,-0.1403655235821516,-0.1419806617019361,-0.09204703517082026,-0.09365514296152488],"lat":[44.6109511766499,44.62182259902175,44.61289768376725,44.61529668432975,44.60637123535228,44.60876382164591,44.59983784033508,44.60103167393175,44.5921053802391,44.59329750165915,44.58437089599943,44.58556130576947,44.57663438855707,44.57782308720357,44.56889585885234,44.57008284690172,44.5611553078252,44.56234058580375,44.55341273641493,44.55459630484891,44.54566814556043,44.54920924648015,44.61170895282371,44.612887846214,44.62181622120751,44.62299383611458,44.63192233473534,44.63544685668619,44.62651771126585,44.62768934616116,44.61875989363005,44.61992981857978,44.61100005934984,44.61216827488255,44.5943080518897,44.59547434461581,44.56868267888288,44.56984683674947,44.51625974175346,44.5150968622583,44.50616557025863,44.50732823701057,44.48053316965576,44.48169370759962,44.47276162186918,44.4750778005818,44.46614519936403,44.46730084083225,44.45836793639064,44.46067432486275,44.45174090706232,44.45289165476596,44.44395793490421,44.44510698198962,44.43617296047138,44.43732030746396,44.42838598469366,44.4295316321188,44.41166229322433,44.41280603282026,44.36813003771005,44.36698734071337,44.34911671683811,44.34797294843957,44.33903770693446,44.33789265939864,44.32002231705911,44.3188761995813,44.30994109866757,44.30764482141232,44.29871004591862,44.29755988700327,44.28862522812593,44.28747379265644,44.2785392504404,44.2773865389324,44.25951759496309,44.25836381763158,44.24942941579747,44.24711782709418,44.23818375196802,44.23237986095786,44.24131288201385,44.24014744112188,44.24908015676093,44.24791302017571,44.2568454299949,44.25450628030066,44.26343817126187,44.26226615746216,44.27119774144744,44.27002403022436,44.27895530682929,44.27660300397434,44.28553375885336,44.28317508960423,44.2921053213944,44.28974028420707,44.29866999154433,44.29748503059415,44.30641442787894,44.30522776639557,44.3230858453867,44.32189726664221,44.33082594788365,44.32963566721527,44.34749231229307,44.3463001121785,44.39986647164463,44.39867148005798,44.44330642091133,44.4421088501218,44.45103533598496,44.44983605766592,44.45876222997026,44.45756124359902,44.4664871019318,44.46528440698559,44.47420995093368,44.47300554688961,44.48193077603938,44.4795170592288,44.48844175250324,44.48723243904489,44.4961568163382,44.49373327802344,44.50265711728856,44.50022717638938,44.50915047624112,44.50671413122253,44.51563689027461,44.51441625991644,44.52333870025866,44.52211635646834,44.53103847768325,44.52981441993771,44.56550105267212,44.56672600670468,44.575647650166,44.5768713368249,44.58579310898087,44.58823645438298,44.59715857891733,44.60202825456301,44.6109511766499]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},["1. bassin de Pau","2. bassin de Mulhouse","3. bassin de Chalon-sur-Saône","4. bassin de Luçon","5. bassin de Saintes","6. bassin de Le Lude","7. bassin de Quimperlé","8. bassin de Meung-sur-Loire","9. bassin de Pontivy","10. bassin de Marmande"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]}],"limits":{"lat":[43.0723670909662,49.04160507815724],"lng":[-4.340204009727308,8.224921966160341]}},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-clusters-carto-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4&nbsp;–&nbsp; Les 10 bassins de production retenus
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="extraction-des-températures-à-chaque-point" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="extraction-des-températures-à-chaque-point"><span class="header-section-number">4.4</span> Extraction des températures à chaque point</h2>
<p>Pour chaque bassin de production, on va rechercher un point représentatif et récupérer les données de température journalières pour tous ces points.</p>
<p>Le package <a href="https://r-spatial.github.io/stars/">{stars}</a> est bien adapté à la manipulation des données spatio-temporelles.</p>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># préparations de points pour l'extraction des températures. </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>points <span class="ot">&lt;-</span> cluster_liss <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(noms, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_point_on_surface</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:4326"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># données de température sous forme de pile de rasters</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>era5 <span class="ot">&lt;-</span> <span class="fu">dir_ls</span>(here<span class="sc">::</span><span class="fu">here</span>(rep_era5), <span class="at">recurse =</span> <span class="cn">TRUE</span>, <span class="at">glob =</span> <span class="st">"*.nc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_stars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">temp_moy_k =</span> <span class="dv">1</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># extraction</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>temp_points <span class="ot">&lt;-</span> era5 <span class="sc">%&gt;%</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_extract</span>(points) <span class="sc">%&gt;%</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_moy_c =</span> temp_moy_k <span class="sc">-</span> <span class="fl">273.15</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="fu">as_date</span>(time)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(points, ., <span class="at">by =</span> <span class="st">"geometry"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div id="tbl-climat" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-climat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tableau&nbsp;4.1&nbsp;–&nbsp; Températures moyennes journalières (extrait)
</figcaption>
<div aria-describedby="tbl-climat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="iwtzqcdaup" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#iwtzqcdaup table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#iwtzqcdaup thead, #iwtzqcdaup tbody, #iwtzqcdaup tfoot, #iwtzqcdaup tr, #iwtzqcdaup td, #iwtzqcdaup th {
  border-style: none;
}

#iwtzqcdaup p {
  margin: 0;
  padding: 0;
}

#iwtzqcdaup .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#iwtzqcdaup .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#iwtzqcdaup .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#iwtzqcdaup .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#iwtzqcdaup .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iwtzqcdaup .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iwtzqcdaup .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iwtzqcdaup .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#iwtzqcdaup .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#iwtzqcdaup .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#iwtzqcdaup .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#iwtzqcdaup .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#iwtzqcdaup .gt_spanner_row {
  border-bottom-style: hidden;
}

#iwtzqcdaup .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#iwtzqcdaup .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#iwtzqcdaup .gt_from_md > :first-child {
  margin-top: 0;
}

#iwtzqcdaup .gt_from_md > :last-child {
  margin-bottom: 0;
}

#iwtzqcdaup .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#iwtzqcdaup .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#iwtzqcdaup .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#iwtzqcdaup .gt_row_group_first td {
  border-top-width: 2px;
}

#iwtzqcdaup .gt_row_group_first th {
  border-top-width: 2px;
}

#iwtzqcdaup .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iwtzqcdaup .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#iwtzqcdaup .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#iwtzqcdaup .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iwtzqcdaup .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iwtzqcdaup .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#iwtzqcdaup .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#iwtzqcdaup .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#iwtzqcdaup .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iwtzqcdaup .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iwtzqcdaup .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iwtzqcdaup .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iwtzqcdaup .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iwtzqcdaup .gt_left {
  text-align: left;
}

#iwtzqcdaup .gt_center {
  text-align: center;
}

#iwtzqcdaup .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#iwtzqcdaup .gt_font_normal {
  font-weight: normal;
}

#iwtzqcdaup .gt_font_bold {
  font-weight: bold;
}

#iwtzqcdaup .gt_font_italic {
  font-style: italic;
}

#iwtzqcdaup .gt_super {
  font-size: 65%;
}

#iwtzqcdaup .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#iwtzqcdaup .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#iwtzqcdaup .gt_indent_1 {
  text-indent: 5px;
}

#iwtzqcdaup .gt_indent_2 {
  text-indent: 10px;
}

#iwtzqcdaup .gt_indent_3 {
  text-indent: 15px;
}

#iwtzqcdaup .gt_indent_4 {
  text-indent: 20px;
}

#iwtzqcdaup .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">date</th>
<th id="bassin de production" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">bassin de production</th>
<th id="température moy. (°C)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">température moy. (°C)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-01-01</td>
<td class="gt_row gt_left" headers="nom"><p>Pau</p></td>
<td class="gt_row gt_right" headers="temp_moy_c">4,5916992</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1979-01-02</td>
<td class="gt_row gt_left" headers="nom"><p>Pau</p></td>
<td class="gt_row gt_right" headers="temp_moy_c">-0,9852356</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-01-03</td>
<td class="gt_row gt_left" headers="nom"><p>Pau</p></td>
<td class="gt_row gt_right" headers="temp_moy_c">0,9097839</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1979-01-04</td>
<td class="gt_row gt_left" headers="nom"><p>Pau</p></td>
<td class="gt_row gt_right" headers="temp_moy_c">8,4750000</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-01-05</td>
<td class="gt_row gt_left" headers="nom"><p>Pau</p></td>
<td class="gt_row gt_right" headers="temp_moy_c">5,8669678</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1979-01-06</td>
<td class="gt_row gt_left" headers="nom"><p>Pau</p></td>
<td class="gt_row gt_right" headers="temp_moy_c">5,0254761</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">...</td>
<td class="gt_row gt_left" headers="nom"><p><em>etc.</em></p></td>
<td class="gt_row gt_right" headers="temp_moy_c">...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="calcul-des-degrés-jour-et-des-dates-de-récolte" class="level2 page-columns page-full" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="calcul-des-degrés-jour-et-des-dates-de-récolte"><span class="header-section-number">4.5</span> Calcul des degrés jour et des dates de récolte</h2>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># base de calcul pour maïs : 6 °C</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="dv">6</span> <span class="co"># °C</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># besoin total à récolte pour un maïs grain de précocité moyenne : 1700 DJ</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>besoin <span class="ot">&lt;-</span> <span class="dv">1700</span> <span class="co"># DJ</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[DJ_{n} = \sum_{j=1}^{n}{\frac{T_{max, j} - T_{min, j}}{2} - T_{base}}\]</span></p>
<p>Le maïs a une température de base de 6&nbsp;°C et il lui faut 1700&nbsp;DJ (variable selon la précocité de la variété) pour être récolté pour le grain<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Les températures supérieures à 30&nbsp;°C stoppent le développement végétatif. Le semis commence fin mars et est réalisé à 50&nbsp;% mi-avril<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<div class="no-row-height column-margin column-container"><p><sup>3</sup>&nbsp;<a href="https://blog.spotifarm.fr/tour-de-plaine-spotifarm/somme-de-temperature-pourquoi-suivre-levolution-des-degres-jours"><em>Spotifarm</em></a></p><p><sup>4</sup>&nbsp;<a href="https://cereobs.franceagrimer.fr/cereobs-sp/#/publications">Céré’Obs. <em>FranceAgrimer</em></a> &gt; Rapport Céré’Obs</p></div><p>On considère que la température moyenne journalière ERA5 correspond bien à <span class="math inline">\(\frac{T_{max} - T_{min}}{2}\)</span>.</p>
<p>NB&nbsp;: la date n’est pas un bon indicateur pour suivre précisémment une évolution journalière à cause des années bissextiles. Par exemple le 15&nbsp;avril ne correspondra pas toujours au même nombre de jours dans l’avancement de la saison de végétation&nbsp;:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">yday</span>(<span class="fu">ymd</span>(<span class="st">"2020-04-15"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 106</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">yday</span>(<span class="fu">ymd</span>(<span class="st">"2023-04-15"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 105</code></pre>
</div>
</div>
<p>Cela peut-être impactant si on recherche des tendances qui sont de l’ordre de grandeur du jour. On utilisera donc le jour de l’année (<em>day of year</em> ou <em>doy</em>).</p>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>recolte <span class="ot">&lt;-</span> temp_points <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, nom, temp_moy_c) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nom, <span class="at">annee =</span> <span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dj =</span> <span class="fu">case_when</span>(<span class="fu">yday</span>(date) <span class="sc">&lt;</span> <span class="dv">105</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                        temp_moy_c <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                        temp_moy_c <span class="sc">&lt;</span> base <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                        <span class="cn">TRUE</span> <span class="sc">~</span> temp_moy_c <span class="sc">-</span> base),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">sdj =</span> <span class="fu">cumsum</span>(dj),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">doy =</span> <span class="fu">yday</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sdj <span class="sc">&gt;</span> besoin) <span class="sc">%&gt;%</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, annee, doy, nom)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div id="tbl-resultats" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-resultats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tableau&nbsp;4.2&nbsp;–&nbsp; Dates de récolte potentielles (extrait)
</figcaption>
<div aria-describedby="tbl-resultats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="nxfpcxjcji" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#nxfpcxjcji table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#nxfpcxjcji thead, #nxfpcxjcji tbody, #nxfpcxjcji tfoot, #nxfpcxjcji tr, #nxfpcxjcji td, #nxfpcxjcji th {
  border-style: none;
}

#nxfpcxjcji p {
  margin: 0;
  padding: 0;
}

#nxfpcxjcji .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nxfpcxjcji .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#nxfpcxjcji .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nxfpcxjcji .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nxfpcxjcji .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nxfpcxjcji .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nxfpcxjcji .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nxfpcxjcji .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nxfpcxjcji .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nxfpcxjcji .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nxfpcxjcji .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nxfpcxjcji .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nxfpcxjcji .gt_spanner_row {
  border-bottom-style: hidden;
}

#nxfpcxjcji .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#nxfpcxjcji .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nxfpcxjcji .gt_from_md > :first-child {
  margin-top: 0;
}

#nxfpcxjcji .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nxfpcxjcji .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nxfpcxjcji .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nxfpcxjcji .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nxfpcxjcji .gt_row_group_first td {
  border-top-width: 2px;
}

#nxfpcxjcji .gt_row_group_first th {
  border-top-width: 2px;
}

#nxfpcxjcji .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nxfpcxjcji .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nxfpcxjcji .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nxfpcxjcji .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nxfpcxjcji .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nxfpcxjcji .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nxfpcxjcji .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#nxfpcxjcji .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nxfpcxjcji .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nxfpcxjcji .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nxfpcxjcji .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nxfpcxjcji .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nxfpcxjcji .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nxfpcxjcji .gt_left {
  text-align: left;
}

#nxfpcxjcji .gt_center {
  text-align: center;
}

#nxfpcxjcji .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nxfpcxjcji .gt_font_normal {
  font-weight: normal;
}

#nxfpcxjcji .gt_font_bold {
  font-weight: bold;
}

#nxfpcxjcji .gt_font_italic {
  font-style: italic;
}

#nxfpcxjcji .gt_super {
  font-size: 65%;
}

#nxfpcxjcji .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#nxfpcxjcji .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nxfpcxjcji .gt_indent_1 {
  text-indent: 5px;
}

#nxfpcxjcji .gt_indent_2 {
  text-indent: 10px;
}

#nxfpcxjcji .gt_indent_3 {
  text-indent: 15px;
}

#nxfpcxjcji .gt_indent_4 {
  text-indent: 20px;
}

#nxfpcxjcji .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">date</th>
<th id="année" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">année</th>
<th id="jour (doy)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">jour (doy)</th>
<th id="bassin de production" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">bassin de production</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-09-26</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">269</td>
<td class="gt_row gt_left" headers="nom"><p>Chalon-sur-Saône</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1980-10-04</td>
<td class="gt_row gt_right" headers="annee">1980</td>
<td class="gt_row gt_right" headers="doy">278</td>
<td class="gt_row gt_left" headers="nom"><p>Chalon-sur-Saône</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-10-30</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">303</td>
<td class="gt_row gt_left" headers="nom"><p>Le Lude</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1980-11-16</td>
<td class="gt_row gt_right" headers="annee">1980</td>
<td class="gt_row gt_right" headers="doy">321</td>
<td class="gt_row gt_left" headers="nom"><p>Le Lude</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-09-24</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">267</td>
<td class="gt_row gt_left" headers="nom"><p>Luçon</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1980-09-28</td>
<td class="gt_row gt_right" headers="annee">1980</td>
<td class="gt_row gt_right" headers="doy">272</td>
<td class="gt_row gt_left" headers="nom"><p>Luçon</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-09-13</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">256</td>
<td class="gt_row gt_left" headers="nom"><p>Marmande</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1980-09-19</td>
<td class="gt_row gt_right" headers="annee">1980</td>
<td class="gt_row gt_right" headers="doy">263</td>
<td class="gt_row gt_left" headers="nom"><p>Marmande</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-10-29</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">302</td>
<td class="gt_row gt_left" headers="nom"><p>Meung-sur-Loire</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1980-11-18</td>
<td class="gt_row gt_right" headers="annee">1980</td>
<td class="gt_row gt_right" headers="doy">323</td>
<td class="gt_row gt_left" headers="nom"><p>Meung-sur-Loire</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-10-08</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">281</td>
<td class="gt_row gt_left" headers="nom"><p>Mulhouse</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1981-10-09</td>
<td class="gt_row gt_right" headers="annee">1981</td>
<td class="gt_row gt_right" headers="doy">282</td>
<td class="gt_row gt_left" headers="nom"><p>Mulhouse</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-09-18</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">261</td>
<td class="gt_row gt_left" headers="nom"><p>Pau</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1980-09-25</td>
<td class="gt_row gt_right" headers="annee">1980</td>
<td class="gt_row gt_right" headers="doy">269</td>
<td class="gt_row gt_left" headers="nom"><p>Pau</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-12-05</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">339</td>
<td class="gt_row gt_left" headers="nom"><p>Pontivy</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1981-11-20</td>
<td class="gt_row gt_right" headers="annee">1981</td>
<td class="gt_row gt_right" headers="doy">324</td>
<td class="gt_row gt_left" headers="nom"><p>Pontivy</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-12-08</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">342</td>
<td class="gt_row gt_left" headers="nom"><p>Quimperlé</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1981-11-19</td>
<td class="gt_row gt_right" headers="annee">1981</td>
<td class="gt_row gt_right" headers="doy">323</td>
<td class="gt_row gt_left" headers="nom"><p>Quimperlé</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">1979-09-21</td>
<td class="gt_row gt_right" headers="annee">1979</td>
<td class="gt_row gt_right" headers="doy">264</td>
<td class="gt_row gt_left" headers="nom"><p>Saintes</p></td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">1980-09-26</td>
<td class="gt_row gt_right" headers="annee">1980</td>
<td class="gt_row gt_right" headers="doy">270</td>
<td class="gt_row gt_left" headers="nom"><p>Saintes</p></td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">...</td>
<td class="gt_row gt_right" headers="annee">...</td>
<td class="gt_row gt_right" headers="doy">...</td>
<td class="gt_row gt_left" headers="nom"><p><em>etc.</em></p></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="tendances" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="tendances"><span class="header-section-number">4.6</span> Tendances</h2>
<section id="visualisation-des-tendances" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="visualisation-des-tendances"><span class="header-section-number">4.6.1</span> Visualisation des tendances</h3>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mod_interactions <span class="ot">&lt;-</span> recolte <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(doy <span class="sc">~</span> annee <span class="sc">*</span> nom, <span class="at">data =</span> .)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># préparation des étiquettes pour la visualisation avec affichage direct (sans </span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># légende)</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>etiquettes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">nom =</span> <span class="fu">unique</span>(recolte<span class="sc">$</span>nom),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">annee =</span> <span class="fu">max</span>(recolte<span class="sc">$</span>annee) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">doy =</span> <span class="fu">predict</span>(mod_interactions, <span class="at">newdata =</span> .)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_virtuelle =</span> <span class="fu">as_date</span>(<span class="fu">parse_date_time</span>(<span class="fu">glue</span>(<span class="st">"2020-{str_pad(round(doy, 0), 3, 'left', '0')}"</span>), </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">orders =</span> <span class="st">"yj"</span>)))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>recolte <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_virtuelle =</span> <span class="fu">as_date</span>(<span class="fu">parse_date_time</span>(<span class="fu">glue</span>(<span class="st">"2020-{str_pad(doy, 3, 'left', '0')}"</span>), </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">orders =</span> <span class="st">"yj"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(annee, date_virtuelle, <span class="at">color =</span> nom)) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> glm) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> etiquettes, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_wrap</span>(nom, <span class="dv">10</span>, <span class="at">whitespace_only =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nudge_x =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">direction =</span> <span class="st">"y"</span>, <span class="at">lineheight =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_date</span>(<span class="at">date_breaks =</span> <span class="st">"months"</span>, <span class="at">date_labels =</span> <span class="st">"%b"</span>) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fu">min</span>(recolte<span class="sc">$</span>annee) <span class="sc">-</span> .<span class="dv">5</span>, <span class="fu">max</span>(recolte<span class="sc">$</span>annee) <span class="sc">+</span> <span class="dv">5</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"2020-11-15"</span>)),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Date de récolte potentielle"</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Maïs grain, par bassin de production"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"année"</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"jour"</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">glue</span>(<span class="st">"d'après données agroclimatiques ERA5</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="st">                       pour une précocité moyenne ({besoin} DJ, base {base} °C)"</span>)) <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-date-recolte" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-date-recolte-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="app3_files/figure-html/fig-date-recolte-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-date-recolte-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.5&nbsp;–&nbsp; Évolution de la date de récolte potentielle du maïs grain
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="paramètres-des-tendances" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="paramètres-des-tendances"><span class="header-section-number">4.6.2</span> Paramètres des tendances</h3>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mod_simple <span class="ot">&lt;-</span> recolte <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(doy <span class="sc">~</span> annee <span class="sc">+</span> nom, <span class="at">data =</span> .)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>evol <span class="ot">&lt;-</span> <span class="fu">round</span>(mod_simple<span class="sc">$</span>coefficients[[<span class="st">"annee"</span>]], <span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ic95 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">confint</span>(mod_simple)[<span class="dv">2</span>, ], <span class="dv">1</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">with</span>(<span class="fu">summary</span>(mod_simple), <span class="dv">1</span> <span class="sc">-</span> deviance <span class="sc">/</span> null.deviance), <span class="dv">2</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les bayesiens</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># library(rstanarm)</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># library(bayestestR)</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># mod_bayes &lt;- recolte %&gt;%</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   stan_glm(doy ~ annee + nom, data = .)</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># describe_posterior(mod_bayes, ci = .95, rope_range = c(-.05, 0.5))</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Au cours des quatre dernières décennies, la date de récolte potentielle moyenne du maïs grain dans les principaux bassins de production français à évolué d’environ -0,7&nbsp;jour par an (IC<sub>95&nbsp;%</sub>&nbsp;[-0,8&nbsp;;&nbsp;-0,6], <em>r</em><sup>2</sup> = 0,75).</p>
<div class="cell">
<details class="code-fold">
<summary>voir le code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_gtsummary_theme</span>(<span class="fu">list</span>(<span class="st">"pkgwide-str:ci.sep"</span> <span class="ot">=</span> <span class="st">"&nbsp;–&nbsp;"</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_gtsummary_language</span>(<span class="st">"fr"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>mod_simple <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">label =</span> <span class="fu">list</span>(annee <span class="sc">~</span> <span class="st">"année"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                              nom <span class="sc">~</span> <span class="st">"bassin de production"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_source_note</span>(<span class="at">source_note =</span> <span class="fu">glue</span>(<span class="st">"Maïs grain France </span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="st">                                      {min(recolte$annee)}-{max(recolte$annee)} </span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="st">                                      d'après données agroclimatiques ERA5 pour </span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="st">                                      une précocité moyenne ({besoin} DJ, base</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="st">                                      {base} °C)"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-tendance" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tendance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tableau&nbsp;4.3&nbsp;–&nbsp; Évolution de la date de récolte&nbsp;: environ -0,7&nbsp;jour par an
</figcaption>
<div aria-describedby="tbl-tendance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="yxxnzphwyh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#yxxnzphwyh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#yxxnzphwyh thead, #yxxnzphwyh tbody, #yxxnzphwyh tfoot, #yxxnzphwyh tr, #yxxnzphwyh td, #yxxnzphwyh th {
  border-style: none;
}

#yxxnzphwyh p {
  margin: 0;
  padding: 0;
}

#yxxnzphwyh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yxxnzphwyh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#yxxnzphwyh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yxxnzphwyh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yxxnzphwyh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yxxnzphwyh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yxxnzphwyh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yxxnzphwyh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yxxnzphwyh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yxxnzphwyh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yxxnzphwyh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yxxnzphwyh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yxxnzphwyh .gt_spanner_row {
  border-bottom-style: hidden;
}

#yxxnzphwyh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#yxxnzphwyh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yxxnzphwyh .gt_from_md > :first-child {
  margin-top: 0;
}

#yxxnzphwyh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yxxnzphwyh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yxxnzphwyh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#yxxnzphwyh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#yxxnzphwyh .gt_row_group_first td {
  border-top-width: 2px;
}

#yxxnzphwyh .gt_row_group_first th {
  border-top-width: 2px;
}

#yxxnzphwyh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxxnzphwyh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#yxxnzphwyh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#yxxnzphwyh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yxxnzphwyh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxxnzphwyh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yxxnzphwyh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#yxxnzphwyh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yxxnzphwyh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yxxnzphwyh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yxxnzphwyh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxxnzphwyh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yxxnzphwyh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxxnzphwyh .gt_left {
  text-align: left;
}

#yxxnzphwyh .gt_center {
  text-align: center;
}

#yxxnzphwyh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yxxnzphwyh .gt_font_normal {
  font-weight: normal;
}

#yxxnzphwyh .gt_font_bold {
  font-weight: bold;
}

#yxxnzphwyh .gt_font_italic {
  font-style: italic;
}

#yxxnzphwyh .gt_super {
  font-size: 65%;
}

#yxxnzphwyh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#yxxnzphwyh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#yxxnzphwyh .gt_indent_1 {
  text-indent: 5px;
}

#yxxnzphwyh .gt_indent_2 {
  text-indent: 10px;
}

#yxxnzphwyh .gt_indent_3 {
  text-indent: 15px;
}

#yxxnzphwyh .gt_indent_4 {
  text-indent: 20px;
}

#yxxnzphwyh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Caractéristique</strong>"><strong>Caractéristique</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>Beta</strong>"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% IC</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% IC</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-valeur</strong>"><strong>p-valeur</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">année</td>
<td headers="estimate" class="gt_row gt_center">-0,67</td>
<td headers="ci" class="gt_row gt_center">-0,76&nbsp;–&nbsp;-0,58</td>
<td headers="p.value" class="gt_row gt_center">&lt;0,001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">bassin de production</td>
<td headers="estimate" class="gt_row gt_center"><br></td>
<td headers="ci" class="gt_row gt_center"><br></td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Chalon-sur-Saône</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Le Lude</td>
<td headers="estimate" class="gt_row gt_center">21</td>
<td headers="ci" class="gt_row gt_center">16&nbsp;–&nbsp;26</td>
<td headers="p.value" class="gt_row gt_center">&lt;0,001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Luçon</td>
<td headers="estimate" class="gt_row gt_center">1,1</td>
<td headers="ci" class="gt_row gt_center">-3,9&nbsp;–&nbsp;6,1</td>
<td headers="p.value" class="gt_row gt_center">0,7</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Marmande</td>
<td headers="estimate" class="gt_row gt_center">-9,2</td>
<td headers="ci" class="gt_row gt_center">-14&nbsp;–&nbsp;-4,2</td>
<td headers="p.value" class="gt_row gt_center">&lt;0,001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Meung-sur-Loire</td>
<td headers="estimate" class="gt_row gt_center">20</td>
<td headers="ci" class="gt_row gt_center">15&nbsp;–&nbsp;25</td>
<td headers="p.value" class="gt_row gt_center">&lt;0,001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Mulhouse</td>
<td headers="estimate" class="gt_row gt_center">8,7</td>
<td headers="ci" class="gt_row gt_center">3,6&nbsp;–&nbsp;14</td>
<td headers="p.value" class="gt_row gt_center">&lt;0,001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Pau</td>
<td headers="estimate" class="gt_row gt_center">-3,6</td>
<td headers="ci" class="gt_row gt_center">-8,6&nbsp;–&nbsp;1,4</td>
<td headers="p.value" class="gt_row gt_center">0,2</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Pontivy</td>
<td headers="estimate" class="gt_row gt_center">46</td>
<td headers="ci" class="gt_row gt_center">41&nbsp;–&nbsp;51</td>
<td headers="p.value" class="gt_row gt_center">&lt;0,001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Quimperlé</td>
<td headers="estimate" class="gt_row gt_center">48</td>
<td headers="ci" class="gt_row gt_center">43&nbsp;–&nbsp;54</td>
<td headers="p.value" class="gt_row gt_center">&lt;0,001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Saintes</td>
<td headers="estimate" class="gt_row gt_center">-0,11</td>
<td headers="ci" class="gt_row gt_center">-5,1&nbsp;–&nbsp;4,9</td>
<td headers="p.value" class="gt_row gt_center">&gt;0,9</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="4">Maïs grain France 
1979-2022 
d'après données agroclimatiques ERA5 pour 
une précocité moyenne (1700 DJ, base
6 °C)</td>
    </tr>
  </tfoot>
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> IC = intervalle de confiance</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="validation" class="level3" data-number="4.6.3">
<h3 data-number="4.6.3" class="anchored" data-anchor-id="validation"><span class="header-section-number">4.6.3</span> Validation</h3>
<p>Des données d’observation ponctuelles permettent de confronter notre modèle à la réalité<span class="citation" data-cites="torreChangementClimatiqueObservations2004"> (<a href="references.html#ref-torreChangementClimatiqueObservations2004" role="doc-biblioref">de La Torre et Benoît, 2004</a>)</span>&nbsp;:</p>
<p>À Toulouse (proche du bassin de Pau) sur 1977-2003, la “<em>date de semis passe de début mai à début avril en 20&nbsp;ans</em>”. […] “<em>Cet écart au semis ne se retrouve pas à la récolte (très variable entre la mi-septembre et la mi-octobre), d’une part parce que le choix des semences a glissé vers des variétes un peu plus tardives (…) et/ou d’autre part, parce que le grain récolté est plus sec («&nbsp;pour tenir compte de l’augmentation du coût de séchage&nbsp;»)</em>”. […] “<em>Le cycle de culture a augmenté d’une dizaine de jours depuis 1977&nbsp;; il est d’environ 160&nbsp;jours</em>”.</p>
<p>Ainsi, même si on voit que la variété utilisée a probablement un impact important et que des changements de techniques culturales ont eu lieu, une précocité de semis d’un mois combinée à 10&nbsp;jours de culture de plus représente, pour cet exemple, une date de récolte de -0,8&nbsp;jour par an, ce qui n’est pas très éloigné de notre estimation globale.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="1" role="list" style="display: none">
<div id="ref-torreChangementClimatiqueObservations2004" class="csl-entry" role="listitem">
De La Torre C., Benoît M. <em><span>Changement climatique et observations à long-terme en Unités Expérimentales : évolution des pratiques agricoles et des réponses physiologiques des couverts végétaux. Etude de faisabilité</span></em>. <span>Mirecourt</span> : <span>INRA-SAD</span>, 2004.
</div>
<div id="ref-loonisManuelAnalyseSpatiale2018" class="csl-entry" role="listitem">
Loonis V., De Bellefon M.-P. <em><span>Manuel d’analyse spatiale. Théorie et mise en œuvre pratique avec R</span></em>. <span>Montrouge</span> : <span>INSEE - Eurostat</span>, 2018. (<span>Insee Méthodes</span>, 131) ISBN&nbsp;: 978-2-11-139684-5.
</div>
</div>
</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./app2.html" class="pagination-link  aria-label=" &lt;span="" et="" prévisions="" climatiques&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Cultures et prévisions climatiques</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Code source</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb23" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Évolution de la date théorique de récolte"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="an">pagetitle:</span><span class="co"> "ERA5"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Agronomie et données climatiques rétrospectives avec ERA5"</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span><span class="co"> ["productions végétales", "agronomie", "climat", "ERA5", "France"]</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">    dev: "ragg_png"</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">    out.width: 100%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>Les organismes vivants, dont les plantes, ont besoin d'une certaine quantité de chaleur pour se développer. </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>La notion de *degrés jours* a été introduite par les biologistes pour quantifier ce besoin physiologique. </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>Il s'exprime par la somme des différences entre la température moyenne journalière et une température de base<span class="ot">[^1]</span>.</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span><span class="co">[</span><span class="ot">Degré jour de croissance</span><span class="co">](https://fr.wikipedia.org/wiki/Degr%C3%A9_jour_de_croissance)</span> sur *Wikipedia*</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>*Peut-on voir comment a évolué la date de récolte théorique d'une culture au cours des 40&nbsp;dernières années*, compte tenu des changements climatiques en cours&nbsp;?</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>Des données anciennes existent pour certaines cultures, par exemple pour la vigne et <span class="co">[</span><span class="ot">les dates de vendanges</span><span class="co">](https://fr.wikipedia.org/wiki/Vendange#%C3%89chelles_d%C3%A9cennales)</span>, mais pour la plupart il n'y a pas de jeu de données rétrospectif consolidé. Nous allons essayer de combler cette lacune...</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>::: {#fig-vendanges}</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">Delorme, CC BY-SA 4.0, via [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:%C3%89volution_des_dates_de_vendanges_en_France_(1892-2014).svg)</span><span class="co">](img/evol_dates_vendanges.png)</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>Évolution des dates de vendanges en France (1892-2014)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Proposition</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Votre mission si vous l'acceptez..."}</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>**Estimer les tendances de la date potentielle de récolte du maïs grain dans les différents bassins de productions français depuis 1980.**</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="fu">### Compétences mises en œuvre</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Utiliser le **langage R**.</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Manipuler des **données géographiques**&nbsp;: vecteurs et rasters avec les packages {sf}, {terra}, {stars}.</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Requêter en **SQL sur PostgreSQL/PostGIS** avec {RPostgres} et {sf}.</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Utiliser le **lissage spatial** pour synthétiser les données géographiques avec {btb}.</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Créer une **carte web interactive** avec {leaflet}.</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimer et visualiser des **tendances**&nbsp;: modèle linéaire simple et {ggplot2}.</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="fu">### Données utilisées</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Le <span class="co">[</span><span class="ot">RPG</span><span class="co">](https://geoservices.ign.fr/rpg)</span> recense les parcelles déclarées à la PAC (Politique agricole commune) par les agricuteurs&nbsp;: données graphiques et leur culture principale.</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>    Les données&nbsp;2021 (environ 10&nbsp;millions de parcelles) sont disponibles dans une base <span class="co">[</span><span class="ot">PostgreSQL</span><span class="co">](https://www.postgresql.org/)</span>/<span class="co">[</span><span class="ot">PostGIS</span><span class="co">](http://postgis.net/)</span>.</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">ERA5 agrometeorological indicators</span><span class="co">](https://cds.climate.copernicus.eu/cdsapp#!/dataset/sis-agrometeorological-indicators)</span> est un jeu de données issu d'un projet de réanalyse météorologique qui vise à uniformiser et corriger les données historiques (<span class="co">[</span><span class="ot">ERA5</span><span class="co">](https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-land)</span>).</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>    Il fournit des paramètres agro-météorologiques de surface quotidiens sur les quarante dernières années à une résolution spatiale de 0,1&nbsp;° (soit environ 8×11&nbsp;km en France métropolitaine).</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>    Les données de température moyenne journalière 1979-2022 (87&nbsp;Go à l'origine) ont été préchargées sur Minio et limitées à l'emprise de la métropole, représentant au final 16&nbsp;000&nbsp;fichiers de 76&nbsp;ko&nbsp;=&nbsp;1,1&nbsp;Go).</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>    Elles sont au format <span class="co">[</span><span class="ot">NetCDF</span><span class="co">](https://fr.wikipedia.org/wiki/NetCDF)</span>. </span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>    Un package R existe pour importer et requêter ce jeu de données particulier&nbsp;: <span class="co">[</span><span class="ot">{ag5Tools}</span><span class="co">](https://github.com/AgrDataSci/ag5Tools)</span>. </span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>    Les données peuvent aussi être traitées avec les packages de manipulation de rasters tels que <span class="co">[</span><span class="ot">{terra}</span><span class="co">](https://rspatial.org/spatial/index.html)</span> (ou {raster}) et <span class="co">[</span><span class="ot">{stars}</span><span class="co">](https://r-spatial.github.io/stars/)</span>.</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Admin Express</span><span class="co">](https://geoservices.ign.fr/adminexpress)</span> est le référentiel des limites administratives de l'IGN.</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>    Des tables simplifiées des communes et des régions 2023 ont été intégrées dans la base PostgreSQL/PostGIS.</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scénario</span></span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Définir les principaux bassins de production du maïs grain à partir du RPG&nbsp;;</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>extraire les températures journalières sur un point central de chaque bassin&nbsp;;</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>calculer les dates de récolte théoriques pour chaque bassin et chaque année&nbsp;;</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>estimer les tendances par bassin.</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a><span class="fu">## Préparation</span></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>Le pas-à-pas détaillé est décrit sur <span class="co">[</span><span class="ot">la page de démarrage</span><span class="co">](app0.html)</span>:</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Si ce n'est pas déjà fait, il faut avoir préalablement copié les données depuis le stockage MinIO. Pour cela commencez par exécuter la commande "MC client" de cette page dans votre Terminal, puis les commandes suivantes :</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a><span class="in">mc cp minio/projet-funathon/2023/sujet2/diffusion/era5.zip ~/work/funathon_sujet2/data/era5.zip</span></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a><span class="in">unzip ~/work/funathon_sujet2/data/era5.zip -d ~/work/funathon_sujet2/data/</span></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a><span class="in">rm ~/work/funathon_sujet2/data/era5.zip</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>A noter qu'avec ces commandes on copie dans un projet qui se trouve dans un répertoire <span class="in">`funathon_sujet2`</span>, si votre projet se trouve dans un répertoire <span class="in">`funathon2023_sujet2`</span> (ce qui est probablement le cas si vous avez cloné le dépôt Github plutôt que Gitlab), il faut modifier ces commandes légèrement en fonction de ça;</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pour se connecter à la base PostgreSQL, il faudra avoir défini les bonnes variables d'environnements par exemple en ajoutant <span class="in">`PASS_POSTGRESQL = "xxxx"`</span>, etc. dans le fichier *\~/.Renviron*&nbsp;: <span class="in">`file.edit("~/.Renviron")`</span> et en ayant relancé la session (ctrl+maj+F10).</span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)     <span class="co"># manipulation de rasters</span></span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)     <span class="co"># manipulation de rasters</span></span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># manipulation des données</span></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)      <span class="co"># interpolation de chaine de caractères</span></span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs)        <span class="co"># gestion du système de fichier</span></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgres) <span class="co"># connexion PostgreSQL</span></span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)        <span class="co"># manipulation de données spatiales vecteur</span></span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)   <span class="co"># carto web</span></span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)        <span class="co"># mise en forme tableaux</span></span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary) <span class="co"># tableaux de modèles stat</span></span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)   <span class="co"># étiquettage graphiques</span></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a><span class="co"># D'autres packages sont à installer et seront appelés directement avec leur</span></span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a><span class="co"># namespace : btb, raster, fasterize, rlang, memoise</span></span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a><span class="co"># localisation des données dans le stockage "local"</span></span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>rep_era5 <span class="ot">&lt;-</span> <span class="st">"data/era5"</span></span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a><span class="co"># pour avoir les noms de dates en français</span></span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">Sys.setlocale</span>(<span class="st">"LC_ALL"</span>, <span class="st">"fr_FR.UTF-8"</span>))</span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">OutDec =</span> <span class="st">","</span>,</span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a>        <span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Connexion à la base PostgreSQL</span></span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a>cnx <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">Postgres</span>(),</span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a>                 <span class="at">user =</span> <span class="fu">Sys.getenv</span>(<span class="st">"USER_POSTGRESQL"</span>),</span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a>                 <span class="at">password =</span> <span class="fu">Sys.getenv</span>(<span class="st">"PASS_POSTGRESQL"</span>),</span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a>                 <span class="at">host =</span> <span class="fu">Sys.getenv</span>(<span class="st">"HOST_POSTGRESQL"</span>),</span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dbname =</span> <span class="st">"defaultdb"</span>,</span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a>                 <span class="at">port =</span> <span class="dv">5432</span>,</span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a>                 <span class="at">check_interrupts =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a>Vous pouvez vous contenter de la description succinte du scénario ci-dessus pour vous lancer ou poursuivre la lecture pour être plus guidé.</span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a>Vous pouvez aussi bien sûr afficher le code si vous êtes bloqués, si vous voulez des pistes de démarrage ou si vous souhaitez comparer nos approches.</span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a><span class="fu">## Définition des bassins de production du maïs grain</span></span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: donnee-generales-mais</span></span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a>surf_mais <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(cnx, <span class="st">"</span></span>
<span id="cb23-132"><a href="#cb23-132" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb23-133"><a href="#cb23-133" aria-hidden="true" tabindex="-1"></a><span class="st">    code_cultu,</span></span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a><span class="st">    SUM(surf_parc) AS surf_ha</span></span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM rpg.parcelles</span></span>
<span id="cb23-136"><a href="#cb23-136" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE code_cultu IN ('MIS', 'MIE', 'MID')</span></span>
<span id="cb23-137"><a href="#cb23-137" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY code_cultu"</span>)</span>
<span id="cb23-138"><a href="#cb23-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-139"><a href="#cb23-139" aria-hidden="true" tabindex="-1"></a>surf_tot_pac <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(cnx, <span class="st">"</span></span>
<span id="cb23-140"><a href="#cb23-140" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb23-141"><a href="#cb23-141" aria-hidden="true" tabindex="-1"></a><span class="st">    SUM(surf_parc) AS surf_ha</span></span>
<span id="cb23-142"><a href="#cb23-142" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM rpg.parcelles"</span>)</span>
<span id="cb23-143"><a href="#cb23-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-144"><a href="#cb23-144" aria-hidden="true" tabindex="-1"></a>surf <span class="ot">&lt;-</span> <span class="cf">function</span>(code){</span>
<span id="cb23-145"><a href="#cb23-145" aria-hidden="true" tabindex="-1"></a>  surf_mais <span class="sc">%&gt;%</span> </span>
<span id="cb23-146"><a href="#cb23-146" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(code_cultu <span class="sc">==</span> code) <span class="sc">%&gt;%</span> </span>
<span id="cb23-147"><a href="#cb23-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(surf_ha)</span>
<span id="cb23-148"><a href="#cb23-148" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-149"><a href="#cb23-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-150"><a href="#cb23-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-151"><a href="#cb23-151" aria-hidden="true" tabindex="-1"></a>Le maïs grain (code culture&nbsp;: <span class="in">`MIS`</span>) représente, avec une surface de <span class="in">`r round(surf("MIS") / 1e6, 2)`</span>·10^6^&nbsp;ha, la moitié du maïs cultivé<span class="ot">[^2]</span> en France en 2021, soit environ <span class="in">`r round(surf("MIS") / surf_tot_pac$surf_ha * 100)`</span>&nbsp;% des surfaces déclarées à la PAC. </span>
<span id="cb23-152"><a href="#cb23-152" aria-hidden="true" tabindex="-1"></a>Il est utilisé pour l'alimentation animale (essentiellement) et humaine, la transformation en amidon, les agrocarburants...</span>
<span id="cb23-153"><a href="#cb23-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-154"><a href="#cb23-154" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>Les autres cultures étant le maïs ensilage (<span class="in">`MIE`</span>, <span class="in">`r round(surf("MIE") / 1e6, 2)`</span>·10^6^&nbsp;ha, broyé et fermenté) destiné à nourrir le bétail et le maïs doux (<span class="in">`MID`</span>, environ <span class="in">`r format(round(surf("MID"), -3), big.mark = " ")`</span>&nbsp;ha) pour l'alimentation humaine.</span>
<span id="cb23-155"><a href="#cb23-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-156"><a href="#cb23-156" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;rarr;</span> Pouvez-vous confirmer ces chiffres ? La table <span class="in">`rpg.parcelles`</span> liste chaque parcelle avec son <span class="in">`code_cultu`</span> et sa <span class="in">`surf_parc`</span> en hectare.</span>
<span id="cb23-157"><a href="#cb23-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-158"><a href="#cb23-158" aria-hidden="true" tabindex="-1"></a>Pour déterminer les aires principales de culture on peut, par exemple, extraire les principales zones où la densité de culture du maïs grain est la plus forte. Cela peut se faire par commune, par clustering ou avec un lissage<span class="co">[</span><span class="ot">voir chapitre 8 @loonisManuelAnalyseSpatiale2018</span><span class="co">]</span>.</span>
<span id="cb23-159"><a href="#cb23-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-160"><a href="#cb23-160" aria-hidden="true" tabindex="-1"></a>On présente ici un exemple avec un lissage filtré mais vous êtes libre d'utiliser une autre méthode pour déterminer ces aires principales, l'objectif étant d'obtenir une dizaine de points représentatifs sur le territoire à partir desquels nous extrairons les données de température.</span>
<span id="cb23-161"><a href="#cb23-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-162"><a href="#cb23-162" aria-hidden="true" tabindex="-1"></a><span class="fu">### Récupération des données</span></span>
<span id="cb23-163"><a href="#cb23-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-164"><a href="#cb23-164" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La table <span class="in">`rpg.parcelles`</span> contient les polygones des parcelles&nbsp;; le lissage attend un point par parcelle. </span>
<span id="cb23-165"><a href="#cb23-165" aria-hidden="true" tabindex="-1"></a>  Il faut donc récupérer une table de points.</span>
<span id="cb23-166"><a href="#cb23-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La table <span class="in">`adminexpress.region`</span> contient les polygones des régions. Le lissage nécessitera le contour de la France (métropolitaine) pour "fermer" la zone d'étude.</span>
<span id="cb23-167"><a href="#cb23-167" aria-hidden="true" tabindex="-1"></a>  Il faudra donc fusionner les régions.</span>
<span id="cb23-168"><a href="#cb23-168" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>La table <span class="in">`adminexpress.commune`</span> contient les polygones des limites de communes et pourra nous permettre de nommer nos zones en identifiant la commune la plus peuplée de la zone.</span>
<span id="cb23-169"><a href="#cb23-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-170"><a href="#cb23-170" aria-hidden="true" tabindex="-1"></a>NB&nbsp;: pour le lissage, il est recommandé d'utiliser une projection dite "équivalente" (conservant les surfaces), par exemple en France la <span class="co">[</span><span class="ot">LAEA</span><span class="co">](https://fr.wikipedia.org/wiki/Projection_azimutale_%C3%A9quivalente_de_Lambert)</span> Europe, connue sous le code <span class="co">[</span><span class="ot">EPSG:3035</span><span class="co">](https://epsg.io/3035)</span>.</span>
<span id="cb23-171"><a href="#cb23-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-174"><a href="#cb23-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-175"><a href="#cb23-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lissage-donnees</span></span>
<span id="cb23-176"><a href="#cb23-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb23-177"><a href="#cb23-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-178"><a href="#cb23-178" aria-hidden="true" tabindex="-1"></a><span class="co"># contour de la métropole (pour limiter le lissage à l'intérieur des frontières)</span></span>
<span id="cb23-179"><a href="#cb23-179" aria-hidden="true" tabindex="-1"></a>fr <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(cnx, <span class="at">query =</span> <span class="st">"</span></span>
<span id="cb23-180"><a href="#cb23-180" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb23-181"><a href="#cb23-181" aria-hidden="true" tabindex="-1"></a><span class="st">    st_union(st_transform(geom, 3035)) as geom</span></span>
<span id="cb23-182"><a href="#cb23-182" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM adminexpress.region</span></span>
<span id="cb23-183"><a href="#cb23-183" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE insee_reg &gt; '06'"</span>)</span>
<span id="cb23-184"><a href="#cb23-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-185"><a href="#cb23-185" aria-hidden="true" tabindex="-1"></a><span class="co"># communes (pour donner ultérieurement un nom à nos bassins de production)</span></span>
<span id="cb23-186"><a href="#cb23-186" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(cnx, <span class="at">query =</span> <span class="st">"</span></span>
<span id="cb23-187"><a href="#cb23-187" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb23-188"><a href="#cb23-188" aria-hidden="true" tabindex="-1"></a><span class="st">    nom,</span></span>
<span id="cb23-189"><a href="#cb23-189" aria-hidden="true" tabindex="-1"></a><span class="st">    insee_dep,</span></span>
<span id="cb23-190"><a href="#cb23-190" aria-hidden="true" tabindex="-1"></a><span class="st">    population,</span></span>
<span id="cb23-191"><a href="#cb23-191" aria-hidden="true" tabindex="-1"></a><span class="st">    st_transform(geom, 3035) as geom</span></span>
<span id="cb23-192"><a href="#cb23-192" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM adminexpress.commune</span></span>
<span id="cb23-193"><a href="#cb23-193" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE insee_reg &gt; '06'"</span>)</span>
<span id="cb23-194"><a href="#cb23-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-195"><a href="#cb23-195" aria-hidden="true" tabindex="-1"></a><span class="co"># un point par parcelle de maïs avec sa surface qui servira de poids au lissage</span></span>
<span id="cb23-196"><a href="#cb23-196" aria-hidden="true" tabindex="-1"></a>mais <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(cnx, <span class="at">query =</span> <span class="st">"</span></span>
<span id="cb23-197"><a href="#cb23-197" aria-hidden="true" tabindex="-1"></a><span class="st">  SELECT </span></span>
<span id="cb23-198"><a href="#cb23-198" aria-hidden="true" tabindex="-1"></a><span class="st">    st_transform(st_pointonsurface(geom), 3035) as geom,</span></span>
<span id="cb23-199"><a href="#cb23-199" aria-hidden="true" tabindex="-1"></a><span class="st">    surf_parc</span></span>
<span id="cb23-200"><a href="#cb23-200" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM rpg.parcelles</span></span>
<span id="cb23-201"><a href="#cb23-201" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE code_cultu = 'MIS'"</span>)</span>
<span id="cb23-202"><a href="#cb23-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-203"><a href="#cb23-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-204"><a href="#cb23-204" aria-hidden="true" tabindex="-1"></a><span class="fu">### Lissage</span></span>
<span id="cb23-205"><a href="#cb23-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-208"><a href="#cb23-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-209"><a href="#cb23-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lissage-params</span></span>
<span id="cb23-210"><a href="#cb23-210" aria-hidden="true" tabindex="-1"></a>seuil_lissage  <span class="ot">&lt;-</span> <span class="dv">8</span>     <span class="co"># seuil de densité à prendre en compte (ha/km²)</span></span>
<span id="cb23-211"><a href="#cb23-211" aria-hidden="true" tabindex="-1"></a>nb_bassins     <span class="ot">&lt;-</span> <span class="dv">10</span>    <span class="co"># combien de bassins on conserve</span></span>
<span id="cb23-212"><a href="#cb23-212" aria-hidden="true" tabindex="-1"></a>bande_passante <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co"># "étalement" du lissage en m</span></span>
<span id="cb23-213"><a href="#cb23-213" aria-hidden="true" tabindex="-1"></a>pixel          <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># taille du pixel en sortie en m</span></span>
<span id="cb23-214"><a href="#cb23-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-215"><a href="#cb23-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-216"><a href="#cb23-216" aria-hidden="true" tabindex="-1"></a>Pour un rendu à la fois synthétique et esthétique on peut faire un lissage à <span class="in">`r bande_passante / 1000`</span> km de "bande passante" avec un pixel de <span class="in">`r pixel / 1000`</span> km.</span>
<span id="cb23-217"><a href="#cb23-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-218"><a href="#cb23-218" aria-hidden="true" tabindex="-1"></a>La fonction <span class="co">[</span><span class="ot">`btb::btb_smooth()`</span><span class="co">](https://cran.r-project.org/package=btb)</span> attend une table (data.frame) de coordonnées et contenant la variable à lisser, une valeur de bande passante (dans la projection utilisée, donc en mètres dans notre cas)&nbsp;; on peut optionnellement fournir une grille régulière (data.frame) pour faciliter les comparaisons de jeux de données (en s'assurant qu'ils ont les mêmes emprises et résolutions) et border la zone d'étude.</span>
<span id="cb23-219"><a href="#cb23-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-220"><a href="#cb23-220" aria-hidden="true" tabindex="-1"></a>En retour nous obtiendrons un data.frame&nbsp;; il peut être plus intéressant de rasteriser le résultat.</span>
<span id="cb23-221"><a href="#cb23-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-224"><a href="#cb23-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-225"><a href="#cb23-225" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lissage-fonctions</span></span>
<span id="cb23-226"><a href="#cb23-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-227"><a href="#cb23-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Lissage : fonctions simplifiant la création de rasters lissés à partir de </span></span>
<span id="cb23-228"><a href="#cb23-228" aria-hidden="true" tabindex="-1"></a><span class="co"># points avec {btb}</span></span>
<span id="cb23-229"><a href="#cb23-229" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb23-230"><a href="#cb23-230" aria-hidden="true" tabindex="-1"></a><span class="co"># michael.delorme - 2021-08-26</span></span>
<span id="cb23-231"><a href="#cb23-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-232"><a href="#cb23-232" aria-hidden="true" tabindex="-1"></a><span class="co"># utils -------------------------------------------------------------------</span></span>
<span id="cb23-233"><a href="#cb23-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-234"><a href="#cb23-234" aria-hidden="true" tabindex="-1"></a><span class="co">#' rounding</span></span>
<span id="cb23-235"><a href="#cb23-235" aria-hidden="true" tabindex="-1"></a><span class="co">#' from plyr</span></span>
<span id="cb23-236"><a href="#cb23-236" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb23-237"><a href="#cb23-237" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x</span></span>
<span id="cb23-238"><a href="#cb23-238" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param accuracy</span></span>
<span id="cb23-239"><a href="#cb23-239" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param f</span></span>
<span id="cb23-240"><a href="#cb23-240" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb23-241"><a href="#cb23-241" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return</span></span>
<span id="cb23-242"><a href="#cb23-242" aria-hidden="true" tabindex="-1"></a>round_any <span class="ot">&lt;-</span> <span class="cf">function</span>(x, accuracy, <span class="at">f =</span> round) {</span>
<span id="cb23-243"><a href="#cb23-243" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-244"><a href="#cb23-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">f</span>(x <span class="sc">/</span> accuracy) <span class="sc">*</span> accuracy</span>
<span id="cb23-245"><a href="#cb23-245" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-246"><a href="#cb23-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-247"><a href="#cb23-247" aria-hidden="true" tabindex="-1"></a><span class="co">#' Generate a grid of coordinates from a spatial layer</span></span>
<span id="cb23-248"><a href="#cb23-248" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb23-249"><a href="#cb23-249" aria-hidden="true" tabindex="-1"></a><span class="co">#' Memoised to get a faster result when used multiple times on the same extent</span></span>
<span id="cb23-250"><a href="#cb23-250" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb23-251"><a href="#cb23-251" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param zone sf object (polygons) : spatial extent</span></span>
<span id="cb23-252"><a href="#cb23-252" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param margin number : buffer of bounding box</span></span>
<span id="cb23-253"><a href="#cb23-253" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param resolution number : distance between nodes</span></span>
<span id="cb23-254"><a href="#cb23-254" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb23-255"><a href="#cb23-255" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return dataframe of coordinates (x, y)</span></span>
<span id="cb23-256"><a href="#cb23-256" aria-hidden="true" tabindex="-1"></a>generate_grid <span class="ot">&lt;-</span> memoise<span class="sc">::</span><span class="fu">memoise</span>(<span class="cf">function</span>(zone, margin, resolution) {</span>
<span id="cb23-257"><a href="#cb23-257" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-258"><a href="#cb23-258" aria-hidden="true" tabindex="-1"></a>  zone_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(zone)</span>
<span id="cb23-259"><a href="#cb23-259" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-260"><a href="#cb23-260" aria-hidden="true" tabindex="-1"></a>  zone <span class="sc">%&gt;%</span></span>
<span id="cb23-261"><a href="#cb23-261" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_make_grid</span>(<span class="at">cellsize =</span> resolution,</span>
<span id="cb23-262"><a href="#cb23-262" aria-hidden="true" tabindex="-1"></a>                     <span class="at">offset =</span> <span class="fu">c</span>(<span class="fu">round_any</span>(zone_bbox[<span class="dv">1</span>] <span class="sc">-</span> margin, resolution, floor),</span>
<span id="cb23-263"><a href="#cb23-263" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">round_any</span>(zone_bbox[<span class="dv">2</span>] <span class="sc">-</span> margin, resolution, floor)),</span>
<span id="cb23-264"><a href="#cb23-264" aria-hidden="true" tabindex="-1"></a>                     <span class="at">what =</span> <span class="st">"centers"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-265"><a href="#cb23-265" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-266"><a href="#cb23-266" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_join</span>(zone, <span class="at">join =</span> st_intersects, <span class="at">left =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-267"><a href="#cb23-267" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-268"><a href="#cb23-268" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-269"><a href="#cb23-269" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y)</span>
<span id="cb23-270"><a href="#cb23-270" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb23-271"><a href="#cb23-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-272"><a href="#cb23-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-273"><a href="#cb23-273" aria-hidden="true" tabindex="-1"></a><span class="co"># main function -----------------------------------------------------------</span></span>
<span id="cb23-274"><a href="#cb23-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-275"><a href="#cb23-275" aria-hidden="true" tabindex="-1"></a><span class="co">#' Kernel weighted smoothing with arbitrary bounding area</span></span>
<span id="cb23-276"><a href="#cb23-276" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb23-277"><a href="#cb23-277" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param df sf object (points) : features to smooth</span></span>
<span id="cb23-278"><a href="#cb23-278" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param field expression : weight field in df (unquoted) ; the values must not have NAs</span></span>
<span id="cb23-279"><a href="#cb23-279" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param bandwidth numeric : kernel bandwidth (output map units)</span></span>
<span id="cb23-280"><a href="#cb23-280" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param resolution numeric : output grid resolution (output map units)</span></span>
<span id="cb23-281"><a href="#cb23-281" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param zone sf objet (polygons) : study zone boundary. If null will use df extent</span></span>
<span id="cb23-282"><a href="#cb23-282" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param out_crs integer : EPSG code projection for output raster (should be an equal-area projection)</span></span>
<span id="cb23-283"><a href="#cb23-283" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param ... other arguments passed to btb::kernelSmoothing</span></span>
<span id="cb23-284"><a href="#cb23-284" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb23-285"><a href="#cb23-285" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return a raster object</span></span>
<span id="cb23-286"><a href="#cb23-286" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb23-287"><a href="#cb23-287" aria-hidden="true" tabindex="-1"></a><span class="co">#' @import btb, raster, fasterize, dplyr, sf, rlang, memoise</span></span>
<span id="cb23-288"><a href="#cb23-288" aria-hidden="true" tabindex="-1"></a>lissage <span class="ot">&lt;-</span> <span class="cf">function</span>(df, field, bandwidth, resolution, <span class="at">zone =</span> <span class="cn">NULL</span>, <span class="at">out_crs =</span> <span class="dv">3035</span>, ...) {</span>
<span id="cb23-289"><a href="#cb23-289" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-290"><a href="#cb23-290" aria-hidden="true" tabindex="-1"></a>  field_name <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">as_name</span>(rlang<span class="sc">::</span><span class="fu">enquo</span>(field))</span>
<span id="cb23-291"><a href="#cb23-291" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-292"><a href="#cb23-292" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"sf"</span> <span class="sc">%in%</span> <span class="fu">class</span>(df)</span>
<span id="cb23-293"><a href="#cb23-293" aria-hidden="true" tabindex="-1"></a>      <span class="sc">|</span> sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(df, <span class="cn">FALSE</span>) <span class="sc">!=</span> <span class="st">"POINT"</span>) {</span>
<span id="cb23-294"><a href="#cb23-294" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"« df » should be a point sf object."</span>)</span>
<span id="cb23-295"><a href="#cb23-295" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-296"><a href="#cb23-296" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-297"><a href="#cb23-297" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(bandwidth)) <span class="fu">stop</span>(<span class="st">"bandwidth sould be numeric."</span>)</span>
<span id="cb23-298"><a href="#cb23-298" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(resolution)) <span class="fu">stop</span>(<span class="st">"resolution sould be numeric."</span>)</span>
<span id="cb23-299"><a href="#cb23-299" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-300"><a href="#cb23-300" aria-hidden="true" tabindex="-1"></a>  nb_na <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(dplyr<span class="sc">::</span><span class="fu">pull</span>(df, {{field}})))</span>
<span id="cb23-301"><a href="#cb23-301" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (nb_na <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb23-302"><a href="#cb23-302" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"removing"</span>, nb_na, <span class="st">"NA"</span>,</span>
<span id="cb23-303"><a href="#cb23-303" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">paste0</span>(<span class="st">"value"</span>, <span class="fu">ifelse</span>(nb_na <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="st">"s"</span>, <span class="st">""</span>)),</span>
<span id="cb23-304"><a href="#cb23-304" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"in «"</span>, field_name, <span class="st">"»..."</span>))</span>
<span id="cb23-305"><a href="#cb23-305" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>(df, {{field}}) <span class="sc">%&gt;%</span></span>
<span id="cb23-306"><a href="#cb23-306" aria-hidden="true" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb23-307"><a href="#cb23-307" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-308"><a href="#cb23-308" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-309"><a href="#cb23-309" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check projections</span></span>
<span id="cb23-310"><a href="#cb23-310" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(df))) {</span>
<span id="cb23-311"><a href="#cb23-311" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"missing projection in sf object « df »."</span>)</span>
<span id="cb23-312"><a href="#cb23-312" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-313"><a href="#cb23-313" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-314"><a href="#cb23-314" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sf<span class="sc">::</span><span class="fu">st_crs</span>(df)<span class="sc">$</span>epsg <span class="sc">!=</span> out_crs) {</span>
<span id="cb23-315"><a href="#cb23-315" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"reprojecting data..."</span>)</span>
<span id="cb23-316"><a href="#cb23-316" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(df, out_crs)</span>
<span id="cb23-317"><a href="#cb23-317" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-318"><a href="#cb23-318" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-319"><a href="#cb23-319" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(zone)) {</span>
<span id="cb23-320"><a href="#cb23-320" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"sf"</span> <span class="sc">%in%</span> <span class="fu">class</span>(zone)</span>
<span id="cb23-321"><a href="#cb23-321" aria-hidden="true" tabindex="-1"></a>        <span class="sc">|!</span>sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(zone, <span class="cn">FALSE</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"POLYGON"</span>, <span class="st">"MULTIPOLYGON"</span>)) {</span>
<span id="cb23-322"><a href="#cb23-322" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"« zone » should be a polygon/multiploygon sf object."</span>)</span>
<span id="cb23-323"><a href="#cb23-323" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-324"><a href="#cb23-324" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-325"><a href="#cb23-325" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check projections</span></span>
<span id="cb23-326"><a href="#cb23-326" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(zone))) {</span>
<span id="cb23-327"><a href="#cb23-327" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"missing projection in sf object « zone »."</span>)</span>
<span id="cb23-328"><a href="#cb23-328" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-329"><a href="#cb23-329" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-330"><a href="#cb23-330" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sf<span class="sc">::</span><span class="fu">st_crs</span>(zone)<span class="sc">$</span>epsg <span class="sc">!=</span> out_crs) {</span>
<span id="cb23-331"><a href="#cb23-331" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"reprojecting study zone..."</span>)</span>
<span id="cb23-332"><a href="#cb23-332" aria-hidden="true" tabindex="-1"></a>      zone <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(zone, out_crs)</span>
<span id="cb23-333"><a href="#cb23-333" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-334"><a href="#cb23-334" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-335"><a href="#cb23-335" aria-hidden="true" tabindex="-1"></a>    <span class="co"># grid generation</span></span>
<span id="cb23-336"><a href="#cb23-336" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (memoise<span class="sc">::</span><span class="fu">has_cache</span>(generate_grid)(zone, bandwidth, resolution)) {</span>
<span id="cb23-337"><a href="#cb23-337" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"retrieving reference grid from cache..."</span>)</span>
<span id="cb23-338"><a href="#cb23-338" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb23-339"><a href="#cb23-339" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"generating reference grid..."</span>)</span>
<span id="cb23-340"><a href="#cb23-340" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-341"><a href="#cb23-341" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-342"><a href="#cb23-342" aria-hidden="true" tabindex="-1"></a>    zone_xy <span class="ot">&lt;-</span> <span class="fu">generate_grid</span>(zone, bandwidth, resolution)</span>
<span id="cb23-343"><a href="#cb23-343" aria-hidden="true" tabindex="-1"></a>    zone_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(zone)</span>
<span id="cb23-344"><a href="#cb23-344" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-345"><a href="#cb23-345" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb23-346"><a href="#cb23-346" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"using default reference grid..."</span>)</span>
<span id="cb23-347"><a href="#cb23-347" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-348"><a href="#cb23-348" aria-hidden="true" tabindex="-1"></a>    zone_xy <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb23-349"><a href="#cb23-349" aria-hidden="true" tabindex="-1"></a>    zone_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(df)</span>
<span id="cb23-350"><a href="#cb23-350" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-351"><a href="#cb23-351" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-352"><a href="#cb23-352" aria-hidden="true" tabindex="-1"></a>  <span class="co"># kernel</span></span>
<span id="cb23-353"><a href="#cb23-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">"computing kernel on « "</span>, field_name, <span class="st">" »..."</span>))</span>
<span id="cb23-354"><a href="#cb23-354" aria-hidden="true" tabindex="-1"></a>  kernel <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb23-355"><a href="#cb23-355" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(., sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.) <span class="sc">%&gt;%</span> <span class="co"># si pas de données renvoie vecteur non nommé</span></span>
<span id="cb23-356"><a href="#cb23-356" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span>     <span class="co"># donc on le modifie</span></span>
<span id="cb23-357"><a href="#cb23-357" aria-hidden="true" tabindex="-1"></a>                <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb23-358"><a href="#cb23-358" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-359"><a href="#cb23-359" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(x, y, {{ field }}) <span class="sc">%&gt;%</span></span>
<span id="cb23-360"><a href="#cb23-360" aria-hidden="true" tabindex="-1"></a>    btb<span class="sc">::</span><span class="fu">btb_smooth</span>(<span class="at">sEPSG =</span> out_crs,</span>
<span id="cb23-361"><a href="#cb23-361" aria-hidden="true" tabindex="-1"></a>                    <span class="at">iCellSize =</span> resolution,</span>
<span id="cb23-362"><a href="#cb23-362" aria-hidden="true" tabindex="-1"></a>                    <span class="at">iBandwidth =</span> bandwidth,</span>
<span id="cb23-363"><a href="#cb23-363" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dfCentroids =</span> zone_xy, ...)</span>
<span id="cb23-364"><a href="#cb23-364" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-365"><a href="#cb23-365" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rasterization</span></span>
<span id="cb23-366"><a href="#cb23-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">rasterizing..."</span>)</span>
<span id="cb23-367"><a href="#cb23-367" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">raster</span>(<span class="at">xmn =</span> <span class="fu">round_any</span>(zone_bbox[<span class="dv">1</span>] <span class="sc">-</span> bandwidth, resolution, floor),</span>
<span id="cb23-368"><a href="#cb23-368" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymn =</span> <span class="fu">round_any</span>(zone_bbox[<span class="dv">2</span>] <span class="sc">-</span> bandwidth, resolution, floor),</span>
<span id="cb23-369"><a href="#cb23-369" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xmx =</span> <span class="fu">round_any</span>(zone_bbox[<span class="dv">3</span>] <span class="sc">+</span> bandwidth, resolution, ceiling),</span>
<span id="cb23-370"><a href="#cb23-370" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymx =</span> <span class="fu">round_any</span>(zone_bbox[<span class="dv">4</span>] <span class="sc">+</span> bandwidth, resolution, ceiling),</span>
<span id="cb23-371"><a href="#cb23-371" aria-hidden="true" tabindex="-1"></a>                 <span class="at">resolution =</span> resolution,</span>
<span id="cb23-372"><a href="#cb23-372" aria-hidden="true" tabindex="-1"></a>                 <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(out_crs)<span class="sc">$</span>input</span>
<span id="cb23-373"><a href="#cb23-373" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb23-374"><a href="#cb23-374" aria-hidden="true" tabindex="-1"></a>    fasterize<span class="sc">::</span><span class="fu">fasterize</span>(kernel, ., <span class="at">field =</span> field_name)</span>
<span id="cb23-375"><a href="#cb23-375" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-376"><a href="#cb23-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-377"><a href="#cb23-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-378"><a href="#cb23-378" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span></span>
<span id="cb23-379"><a href="#cb23-379" aria-hidden="true" tabindex="-1"></a><span class="co">NB : le lissage ne peut pas être mis en cache par Quarto car les objets </span></span>
<span id="cb23-380"><a href="#cb23-380" aria-hidden="true" tabindex="-1"></a><span class="co">{terra} ne sont pas cachables.</span></span>
<span id="cb23-381"><a href="#cb23-381" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span>
<span id="cb23-384"><a href="#cb23-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-385"><a href="#cb23-385" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: lissage-traitement</span></span>
<span id="cb23-386"><a href="#cb23-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-387"><a href="#cb23-387" aria-hidden="true" tabindex="-1"></a>mais_liss <span class="ot">&lt;-</span> mais <span class="sc">%&gt;%</span> </span>
<span id="cb23-388"><a href="#cb23-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lissage</span>(surf_parc, <span class="at">bandwidth =</span> bande_passante, <span class="at">resolution =</span> pixel, <span class="at">zone =</span> fr) <span class="sc">%&gt;%</span> </span>
<span id="cb23-389"><a href="#cb23-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rast</span>()</span>
<span id="cb23-390"><a href="#cb23-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-391"><a href="#cb23-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-394"><a href="#cb23-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-395"><a href="#cb23-395" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lissage-carte</span></span>
<span id="cb23-396"><a href="#cb23-396" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Lissage</span></span>
<span id="cb23-397"><a href="#cb23-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-398"><a href="#cb23-398" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mais_liss, <span class="at">main =</span> <span class="st">"Densité de culture de maïs grain 2021 (ha/km²)"</span>)</span>
<span id="cb23-399"><a href="#cb23-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-400"><a href="#cb23-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-401"><a href="#cb23-401" aria-hidden="true" tabindex="-1"></a>On peut garder par exemple les densités supérieures à <span class="in">`r seuil_lissage`</span>&nbsp;ha/km² et on conservera les <span class="in">`r nb_bassins`</span>&nbsp;plus grandes zones, que nous nommerons avec le nom de la plus grande ville de la zone.</span>
<span id="cb23-402"><a href="#cb23-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-405"><a href="#cb23-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-406"><a href="#cb23-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lissage-carte-filtree</span></span>
<span id="cb23-407"><a href="#cb23-407" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Lissage filtré</span></span>
<span id="cb23-408"><a href="#cb23-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-409"><a href="#cb23-409" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mais_liss <span class="sc">&gt;</span> seuil_lissage, <span class="at">main =</span> <span class="fu">glue</span>(<span class="st">"Zones de culture de maïs grain 2021 (&gt; {seuil_lissage} ha/km²)"</span>))</span>
<span id="cb23-410"><a href="#cb23-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-411"><a href="#cb23-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-412"><a href="#cb23-412" aria-hidden="true" tabindex="-1"></a>Suggestions&nbsp;: </span>
<span id="cb23-413"><a href="#cb23-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-414"><a href="#cb23-414" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>filtrer le raster&nbsp;;</span>
<span id="cb23-415"><a href="#cb23-415" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>vectoriser le raster en polygones&nbsp;;</span>
<span id="cb23-416"><a href="#cb23-416" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>calculer les surfaces&nbsp;;</span>
<span id="cb23-417"><a href="#cb23-417" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>conserver les plus grands polygones&nbsp;;</span>
<span id="cb23-418"><a href="#cb23-418" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>faire une jointure spatiale avec les points des communes&nbsp;;</span>
<span id="cb23-419"><a href="#cb23-419" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>déterminer la plus grande commune de chaque polygone et le nommer.</span>
<span id="cb23-420"><a href="#cb23-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-421"><a href="#cb23-421" aria-hidden="true" tabindex="-1"></a>NB&nbsp;: Le centroïde d'un polygone tarabiscoté peut se trouver en dehors du polygone&nbsp;; on utilise <span class="in">`st_point_on_surface()`</span> plutôt que <span class="in">`st_centroid()`</span> pour garantir qu'il est bien dans le polygone.</span>
<span id="cb23-422"><a href="#cb23-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-425"><a href="#cb23-425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-426"><a href="#cb23-426" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clusters</span></span>
<span id="cb23-427"><a href="#cb23-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-428"><a href="#cb23-428" aria-hidden="true" tabindex="-1"></a><span class="co"># vectorisation et conservation des nb_bassins + grandes zones</span></span>
<span id="cb23-429"><a href="#cb23-429" aria-hidden="true" tabindex="-1"></a>cluster_liss <span class="ot">&lt;-</span> (mais_liss <span class="sc">&gt;</span> seuil_lissage) <span class="sc">%&gt;%</span> </span>
<span id="cb23-430"><a href="#cb23-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.polygons</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-431"><a href="#cb23-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-432"><a href="#cb23-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(layer <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-433"><a href="#cb23-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-434"><a href="#cb23-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">surf =</span> <span class="fu">st_area</span>(geometry)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-435"><a href="#cb23-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(surf, <span class="at">n =</span> nb_bassins) <span class="sc">%&gt;%</span> </span>
<span id="cb23-436"><a href="#cb23-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>())</span>
<span id="cb23-437"><a href="#cb23-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-438"><a href="#cb23-438" aria-hidden="true" tabindex="-1"></a><span class="co"># nommage des clusters avec le nom de la plus grosse ville de la zone</span></span>
<span id="cb23-439"><a href="#cb23-439" aria-hidden="true" tabindex="-1"></a>noms <span class="ot">&lt;-</span> cluster_liss <span class="sc">%&gt;%</span> </span>
<span id="cb23-440"><a href="#cb23-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(<span class="fu">st_point_on_surface</span>(com), <span class="at">left =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-441"><a href="#cb23-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-442"><a href="#cb23-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb23-443"><a href="#cb23-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(population, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-444"><a href="#cb23-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, nom, insee_dep)</span>
<span id="cb23-445"><a href="#cb23-445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-446"><a href="#cb23-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-447"><a href="#cb23-447" aria-hidden="true" tabindex="-1"></a>La couche résultante peut-être affichée sur une carte interactive avec <span class="co">[</span><span class="ot">{leaflet}</span><span class="co">](https://rstudio.github.io/leaflet/)</span>.</span>
<span id="cb23-448"><a href="#cb23-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-451"><a href="#cb23-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-452"><a href="#cb23-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-clusters-carto</span></span>
<span id="cb23-453"><a href="#cb23-453" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: !expr 'glue("Les {nb_bassins} bassins de production retenus")'</span></span>
<span id="cb23-454"><a href="#cb23-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-455"><a href="#cb23-455" aria-hidden="true" tabindex="-1"></a>cluster_liss <span class="sc">%&gt;%</span> </span>
<span id="cb23-456"><a href="#cb23-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(noms, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-457"><a href="#cb23-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:4326"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-458"><a href="#cb23-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-459"><a href="#cb23-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolygons</span>(<span class="at">popup =</span> <span class="sc">~</span> <span class="fu">glue</span>(<span class="st">"{id}. bassin de {nom}"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-460"><a href="#cb23-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>()</span>
<span id="cb23-461"><a href="#cb23-461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-462"><a href="#cb23-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-463"><a href="#cb23-463" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extraction des températures à chaque point</span></span>
<span id="cb23-464"><a href="#cb23-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-465"><a href="#cb23-465" aria-hidden="true" tabindex="-1"></a>Pour chaque bassin de production, on va rechercher un point représentatif et récupérer les données de température journalières pour tous ces points.</span>
<span id="cb23-466"><a href="#cb23-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-467"><a href="#cb23-467" aria-hidden="true" tabindex="-1"></a>Le package <span class="co">[</span><span class="ot">{stars}</span><span class="co">](https://r-spatial.github.io/stars/)</span> est bien adapté à la manipulation des données spatio-temporelles.</span>
<span id="cb23-468"><a href="#cb23-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-471"><a href="#cb23-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-472"><a href="#cb23-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: donnees-climat</span></span>
<span id="cb23-473"><a href="#cb23-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb23-474"><a href="#cb23-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb23-475"><a href="#cb23-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-476"><a href="#cb23-476" aria-hidden="true" tabindex="-1"></a><span class="co"># préparations de points pour l'extraction des températures. </span></span>
<span id="cb23-477"><a href="#cb23-477" aria-hidden="true" tabindex="-1"></a>points <span class="ot">&lt;-</span> cluster_liss <span class="sc">%&gt;%</span> </span>
<span id="cb23-478"><a href="#cb23-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(noms, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-479"><a href="#cb23-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_point_on_surface</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-480"><a href="#cb23-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="st">"EPSG:4326"</span>)</span>
<span id="cb23-481"><a href="#cb23-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-482"><a href="#cb23-482" aria-hidden="true" tabindex="-1"></a><span class="co"># données de température sous forme de pile de rasters</span></span>
<span id="cb23-483"><a href="#cb23-483" aria-hidden="true" tabindex="-1"></a>era5 <span class="ot">&lt;-</span> <span class="fu">dir_ls</span>(here<span class="sc">::</span><span class="fu">here</span>(rep_era5), <span class="at">recurse =</span> <span class="cn">TRUE</span>, <span class="at">glob =</span> <span class="st">"*.nc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-484"><a href="#cb23-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_stars</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-485"><a href="#cb23-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">temp_moy_k =</span> <span class="dv">1</span>)</span>
<span id="cb23-486"><a href="#cb23-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-487"><a href="#cb23-487" aria-hidden="true" tabindex="-1"></a><span class="co"># extraction</span></span>
<span id="cb23-488"><a href="#cb23-488" aria-hidden="true" tabindex="-1"></a>temp_points <span class="ot">&lt;-</span> era5 <span class="sc">%&gt;%</span> </span>
<span id="cb23-489"><a href="#cb23-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_extract</span>(points) <span class="sc">%&gt;%</span></span>
<span id="cb23-490"><a href="#cb23-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-491"><a href="#cb23-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_moy_c =</span> temp_moy_k <span class="sc">-</span> <span class="fl">273.15</span>,</span>
<span id="cb23-492"><a href="#cb23-492" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> <span class="fu">as_date</span>(time)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-493"><a href="#cb23-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(points, ., <span class="at">by =</span> <span class="st">"geometry"</span>)</span>
<span id="cb23-494"><a href="#cb23-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-495"><a href="#cb23-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-498"><a href="#cb23-498" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-499"><a href="#cb23-499" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-climat</span></span>
<span id="cb23-500"><a href="#cb23-500" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb23-501"><a href="#cb23-501" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Températures moyennes journalières (extrait)</span></span>
<span id="cb23-502"><a href="#cb23-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-503"><a href="#cb23-503" aria-hidden="true" tabindex="-1"></a>temp_points <span class="sc">%&gt;%</span> </span>
<span id="cb23-504"><a href="#cb23-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-505"><a href="#cb23-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, nom, temp_moy_c) <span class="sc">%&gt;%</span> </span>
<span id="cb23-506"><a href="#cb23-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-507"><a href="#cb23-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">nom =</span> <span class="st">"*etc.*"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-508"><a href="#cb23-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-509"><a href="#cb23-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(date <span class="sc">~</span> <span class="st">"date"</span>,</span>
<span id="cb23-510"><a href="#cb23-510" aria-hidden="true" tabindex="-1"></a>             temp_moy_c   <span class="sc">~</span> <span class="st">"température moy. (°C)"</span>,</span>
<span id="cb23-511"><a href="#cb23-511" aria-hidden="true" tabindex="-1"></a>             nom   <span class="sc">~</span> <span class="st">"bassin de production"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-512"><a href="#cb23-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>(<span class="at">missing_text =</span> <span class="st">"..."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-513"><a href="#cb23-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_markdown</span>(nom)</span>
<span id="cb23-514"><a href="#cb23-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-515"><a href="#cb23-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-516"><a href="#cb23-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-517"><a href="#cb23-517" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calcul des degrés jour et des dates de récolte</span></span>
<span id="cb23-518"><a href="#cb23-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-521"><a href="#cb23-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-522"><a href="#cb23-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: params-degres-jours</span></span>
<span id="cb23-523"><a href="#cb23-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-524"><a href="#cb23-524" aria-hidden="true" tabindex="-1"></a><span class="co"># base de calcul pour maïs : 6 °C</span></span>
<span id="cb23-525"><a href="#cb23-525" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="dv">6</span> <span class="co"># °C</span></span>
<span id="cb23-526"><a href="#cb23-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-527"><a href="#cb23-527" aria-hidden="true" tabindex="-1"></a><span class="co"># besoin total à récolte pour un maïs grain de précocité moyenne : 1700 DJ</span></span>
<span id="cb23-528"><a href="#cb23-528" aria-hidden="true" tabindex="-1"></a>besoin <span class="ot">&lt;-</span> <span class="dv">1700</span> <span class="co"># DJ</span></span>
<span id="cb23-529"><a href="#cb23-529" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-530"><a href="#cb23-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-531"><a href="#cb23-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-532"><a href="#cb23-532" aria-hidden="true" tabindex="-1"></a>$$DJ_{n} = \sum_{j=1}^{n}{\frac{T_{max, j} - T_{min, j}}{2} - T_{base}}$$</span>
<span id="cb23-533"><a href="#cb23-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-534"><a href="#cb23-534" aria-hidden="true" tabindex="-1"></a>Le maïs a une température de base de <span class="in">`r base`</span>&nbsp;°C et il lui faut <span class="in">`r besoin`</span>&nbsp;DJ (variable selon la précocité de la variété) pour être récolté pour le grain<span class="ot">[^3]</span>. Les températures supérieures à 30&nbsp;°C stoppent le développement végétatif. Le semis commence fin mars et est réalisé à 50&nbsp;% mi-avril<span class="ot">[^4]</span>.</span>
<span id="cb23-535"><a href="#cb23-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-536"><a href="#cb23-536" aria-hidden="true" tabindex="-1"></a><span class="ot">[^3]: </span><span class="co">[</span><span class="ot">*Spotifarm*</span><span class="co">](https://blog.spotifarm.fr/tour-de-plaine-spotifarm/somme-de-temperature-pourquoi-suivre-levolution-des-degres-jours)</span></span>
<span id="cb23-537"><a href="#cb23-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-538"><a href="#cb23-538" aria-hidden="true" tabindex="-1"></a><span class="ot">[^4]: </span><span class="co">[</span><span class="ot">Céré'Obs. *FranceAgrimer*</span><span class="co">](https://cereobs.franceagrimer.fr/cereobs-sp/#/publications)</span> &gt; Rapport Céré'Obs</span>
<span id="cb23-539"><a href="#cb23-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-540"><a href="#cb23-540" aria-hidden="true" tabindex="-1"></a>On considère que la température moyenne journalière ERA5 correspond bien à $\frac{T_{max} - T_{min}}{2}$.</span>
<span id="cb23-541"><a href="#cb23-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-542"><a href="#cb23-542" aria-hidden="true" tabindex="-1"></a>NB&nbsp;: la date n'est pas un bon indicateur pour suivre précisémment une évolution journalière à cause des années bissextiles. Par exemple le 15&nbsp;avril ne correspondra pas toujours au même nombre de jours dans l'avancement de la saison de végétation&nbsp;:</span>
<span id="cb23-543"><a href="#cb23-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-546"><a href="#cb23-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-547"><a href="#cb23-547" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: exemple-doy</span></span>
<span id="cb23-548"><a href="#cb23-548" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb23-549"><a href="#cb23-549" aria-hidden="true" tabindex="-1"></a><span class="fu">yday</span>(<span class="fu">ymd</span>(<span class="st">"2020-04-15"</span>))</span>
<span id="cb23-550"><a href="#cb23-550" aria-hidden="true" tabindex="-1"></a><span class="fu">yday</span>(<span class="fu">ymd</span>(<span class="st">"2023-04-15"</span>))</span>
<span id="cb23-551"><a href="#cb23-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-552"><a href="#cb23-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-553"><a href="#cb23-553" aria-hidden="true" tabindex="-1"></a>Cela peut-être impactant si on recherche des tendances qui sont de l'ordre de grandeur du jour. On utilisera donc le jour de l'année (*day of year* ou *doy*).</span>
<span id="cb23-554"><a href="#cb23-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-557"><a href="#cb23-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-558"><a href="#cb23-558" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calcul-degres-jours</span></span>
<span id="cb23-559"><a href="#cb23-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-560"><a href="#cb23-560" aria-hidden="true" tabindex="-1"></a>recolte <span class="ot">&lt;-</span> temp_points <span class="sc">%&gt;%</span> </span>
<span id="cb23-561"><a href="#cb23-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, nom, temp_moy_c) <span class="sc">%&gt;%</span> </span>
<span id="cb23-562"><a href="#cb23-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nom, <span class="at">annee =</span> <span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-563"><a href="#cb23-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dj =</span> <span class="fu">case_when</span>(<span class="fu">yday</span>(date) <span class="sc">&lt;</span> <span class="dv">105</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb23-564"><a href="#cb23-564" aria-hidden="true" tabindex="-1"></a>                        temp_moy_c <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb23-565"><a href="#cb23-565" aria-hidden="true" tabindex="-1"></a>                        temp_moy_c <span class="sc">&lt;</span> base <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb23-566"><a href="#cb23-566" aria-hidden="true" tabindex="-1"></a>                        <span class="cn">TRUE</span> <span class="sc">~</span> temp_moy_c <span class="sc">-</span> base),</span>
<span id="cb23-567"><a href="#cb23-567" aria-hidden="true" tabindex="-1"></a>         <span class="at">sdj =</span> <span class="fu">cumsum</span>(dj),</span>
<span id="cb23-568"><a href="#cb23-568" aria-hidden="true" tabindex="-1"></a>         <span class="at">doy =</span> <span class="fu">yday</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb23-569"><a href="#cb23-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sdj <span class="sc">&gt;</span> besoin) <span class="sc">%&gt;%</span> </span>
<span id="cb23-570"><a href="#cb23-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb23-571"><a href="#cb23-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-572"><a href="#cb23-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, annee, doy, nom)</span>
<span id="cb23-573"><a href="#cb23-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-574"><a href="#cb23-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-577"><a href="#cb23-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-578"><a href="#cb23-578" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-resultats</span></span>
<span id="cb23-579"><a href="#cb23-579" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb23-580"><a href="#cb23-580" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: Dates de récolte potentielles (extrait)</span></span>
<span id="cb23-581"><a href="#cb23-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-582"><a href="#cb23-582" aria-hidden="true" tabindex="-1"></a>recolte <span class="sc">%&gt;%</span> </span>
<span id="cb23-583"><a href="#cb23-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-584"><a href="#cb23-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(nom, annee) <span class="sc">%&gt;%</span> </span>
<span id="cb23-585"><a href="#cb23-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nom) <span class="sc">%&gt;%</span></span>
<span id="cb23-586"><a href="#cb23-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-587"><a href="#cb23-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-588"><a href="#cb23-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">nom =</span> <span class="st">"*etc.*"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-589"><a href="#cb23-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-590"><a href="#cb23-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(annee <span class="sc">~</span> <span class="st">"année"</span>,</span>
<span id="cb23-591"><a href="#cb23-591" aria-hidden="true" tabindex="-1"></a>             doy   <span class="sc">~</span> <span class="st">"jour (doy)"</span>,</span>
<span id="cb23-592"><a href="#cb23-592" aria-hidden="true" tabindex="-1"></a>             nom   <span class="sc">~</span> <span class="st">"bassin de production"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-593"><a href="#cb23-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_missing</span>(<span class="at">missing_text =</span> <span class="st">"..."</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-594"><a href="#cb23-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_markdown</span>(nom)</span>
<span id="cb23-595"><a href="#cb23-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-596"><a href="#cb23-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-597"><a href="#cb23-597" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tendances</span></span>
<span id="cb23-598"><a href="#cb23-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-599"><a href="#cb23-599" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualisation des tendances</span></span>
<span id="cb23-600"><a href="#cb23-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-603"><a href="#cb23-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-604"><a href="#cb23-604" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tendance-avec-interaction</span></span>
<span id="cb23-605"><a href="#cb23-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-606"><a href="#cb23-606" aria-hidden="true" tabindex="-1"></a>mod_interactions <span class="ot">&lt;-</span> recolte <span class="sc">%&gt;%</span> </span>
<span id="cb23-607"><a href="#cb23-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(doy <span class="sc">~</span> annee <span class="sc">*</span> nom, <span class="at">data =</span> .)</span>
<span id="cb23-608"><a href="#cb23-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-609"><a href="#cb23-609" aria-hidden="true" tabindex="-1"></a><span class="co"># préparation des étiquettes pour la visualisation avec affichage direct (sans </span></span>
<span id="cb23-610"><a href="#cb23-610" aria-hidden="true" tabindex="-1"></a><span class="co"># légende)</span></span>
<span id="cb23-611"><a href="#cb23-611" aria-hidden="true" tabindex="-1"></a>etiquettes <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">nom =</span> <span class="fu">unique</span>(recolte<span class="sc">$</span>nom),</span>
<span id="cb23-612"><a href="#cb23-612" aria-hidden="true" tabindex="-1"></a>                     <span class="at">annee =</span> <span class="fu">max</span>(recolte<span class="sc">$</span>annee) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-613"><a href="#cb23-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">doy =</span> <span class="fu">predict</span>(mod_interactions, <span class="at">newdata =</span> .)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-614"><a href="#cb23-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_virtuelle =</span> <span class="fu">as_date</span>(<span class="fu">parse_date_time</span>(<span class="fu">glue</span>(<span class="st">"2020-{str_pad(round(doy, 0), 3, 'left', '0')}"</span>), </span>
<span id="cb23-615"><a href="#cb23-615" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">orders =</span> <span class="st">"yj"</span>)))</span>
<span id="cb23-616"><a href="#cb23-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-617"><a href="#cb23-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-620"><a href="#cb23-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-621"><a href="#cb23-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-date-recolte</span></span>
<span id="cb23-622"><a href="#cb23-622" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Évolution de la date de récolte potentielle du maïs grain</span></span>
<span id="cb23-623"><a href="#cb23-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 7</span></span>
<span id="cb23-624"><a href="#cb23-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-625"><a href="#cb23-625" aria-hidden="true" tabindex="-1"></a>recolte <span class="sc">%&gt;%</span> </span>
<span id="cb23-626"><a href="#cb23-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_virtuelle =</span> <span class="fu">as_date</span>(<span class="fu">parse_date_time</span>(<span class="fu">glue</span>(<span class="st">"2020-{str_pad(doy, 3, 'left', '0')}"</span>), </span>
<span id="cb23-627"><a href="#cb23-627" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">orders =</span> <span class="st">"yj"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb23-628"><a href="#cb23-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(annee, date_virtuelle, <span class="at">color =</span> nom)) <span class="sc">+</span></span>
<span id="cb23-629"><a href="#cb23-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-630"><a href="#cb23-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> glm) <span class="sc">+</span></span>
<span id="cb23-631"><a href="#cb23-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> etiquettes, </span>
<span id="cb23-632"><a href="#cb23-632" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_wrap</span>(nom, <span class="dv">10</span>, <span class="at">whitespace_only =</span> <span class="cn">FALSE</span>)),</span>
<span id="cb23-633"><a href="#cb23-633" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nudge_x =</span> <span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">direction =</span> <span class="st">"y"</span>, <span class="at">lineheight =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb23-634"><a href="#cb23-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_date</span>(<span class="at">date_breaks =</span> <span class="st">"months"</span>, <span class="at">date_labels =</span> <span class="st">"%b"</span>) <span class="sc">+</span></span>
<span id="cb23-635"><a href="#cb23-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fu">min</span>(recolte<span class="sc">$</span>annee) <span class="sc">-</span> .<span class="dv">5</span>, <span class="fu">max</span>(recolte<span class="sc">$</span>annee) <span class="sc">+</span> <span class="dv">5</span>),</span>
<span id="cb23-636"><a href="#cb23-636" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"2020-11-15"</span>)),</span>
<span id="cb23-637"><a href="#cb23-637" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb23-638"><a href="#cb23-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Date de récolte potentielle"</span>,</span>
<span id="cb23-639"><a href="#cb23-639" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Maïs grain, par bassin de production"</span>,</span>
<span id="cb23-640"><a href="#cb23-640" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"année"</span>,</span>
<span id="cb23-641"><a href="#cb23-641" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"jour"</span>,</span>
<span id="cb23-642"><a href="#cb23-642" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">glue</span>(<span class="st">"d'après données agroclimatiques ERA5</span></span>
<span id="cb23-643"><a href="#cb23-643" aria-hidden="true" tabindex="-1"></a><span class="st">                       pour une précocité moyenne ({besoin} DJ, base {base} °C)"</span>)) <span class="sc">+</span></span>
<span id="cb23-644"><a href="#cb23-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb23-645"><a href="#cb23-645" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span>
<span id="cb23-646"><a href="#cb23-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-647"><a href="#cb23-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-648"><a href="#cb23-648" aria-hidden="true" tabindex="-1"></a><span class="fu">### Paramètres des tendances</span></span>
<span id="cb23-649"><a href="#cb23-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-652"><a href="#cb23-652" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-653"><a href="#cb23-653" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tendance-simple</span></span>
<span id="cb23-654"><a href="#cb23-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-655"><a href="#cb23-655" aria-hidden="true" tabindex="-1"></a>mod_simple <span class="ot">&lt;-</span> recolte <span class="sc">%&gt;%</span> </span>
<span id="cb23-656"><a href="#cb23-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(doy <span class="sc">~</span> annee <span class="sc">+</span> nom, <span class="at">data =</span> .)</span>
<span id="cb23-657"><a href="#cb23-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-658"><a href="#cb23-658" aria-hidden="true" tabindex="-1"></a>evol <span class="ot">&lt;-</span> <span class="fu">round</span>(mod_simple<span class="sc">$</span>coefficients[[<span class="st">"annee"</span>]], <span class="dv">1</span>)</span>
<span id="cb23-659"><a href="#cb23-659" aria-hidden="true" tabindex="-1"></a>ic95 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">confint</span>(mod_simple)[<span class="dv">2</span>, ], <span class="dv">1</span>)</span>
<span id="cb23-660"><a href="#cb23-660" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">with</span>(<span class="fu">summary</span>(mod_simple), <span class="dv">1</span> <span class="sc">-</span> deviance <span class="sc">/</span> null.deviance), <span class="dv">2</span>)</span>
<span id="cb23-661"><a href="#cb23-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-662"><a href="#cb23-662" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les bayesiens</span></span>
<span id="cb23-663"><a href="#cb23-663" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb23-664"><a href="#cb23-664" aria-hidden="true" tabindex="-1"></a><span class="co"># library(rstanarm)</span></span>
<span id="cb23-665"><a href="#cb23-665" aria-hidden="true" tabindex="-1"></a><span class="co"># library(bayestestR)</span></span>
<span id="cb23-666"><a href="#cb23-666" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb23-667"><a href="#cb23-667" aria-hidden="true" tabindex="-1"></a><span class="co"># mod_bayes &lt;- recolte %&gt;%</span></span>
<span id="cb23-668"><a href="#cb23-668" aria-hidden="true" tabindex="-1"></a><span class="co">#   stan_glm(doy ~ annee + nom, data = .)</span></span>
<span id="cb23-669"><a href="#cb23-669" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-670"><a href="#cb23-670" aria-hidden="true" tabindex="-1"></a><span class="co"># describe_posterior(mod_bayes, ci = .95, rope_range = c(-.05, 0.5))</span></span>
<span id="cb23-671"><a href="#cb23-671" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-672"><a href="#cb23-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-673"><a href="#cb23-673" aria-hidden="true" tabindex="-1"></a>Au cours des quatre dernières décennies, la date de récolte potentielle moyenne du maïs grain dans les principaux bassins de production français à évolué d'environ <span class="in">`r evol`</span>&nbsp;jour par an (IC~95&nbsp;%~&nbsp;<span class="sc">\[</span><span class="in">`r ic95[1]`</span>&nbsp;;&nbsp;<span class="in">`r ic95[2]`</span><span class="sc">\]</span>, *r*^2^ = <span class="in">`r r2`</span>).</span>
<span id="cb23-674"><a href="#cb23-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-677"><a href="#cb23-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb23-678"><a href="#cb23-678" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-tendance</span></span>
<span id="cb23-679"><a href="#cb23-679" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: !expr "glue('Évolution de la date de récolte&nbsp;: environ {evol}&nbsp;jour par an')"</span></span>
<span id="cb23-680"><a href="#cb23-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-681"><a href="#cb23-681" aria-hidden="true" tabindex="-1"></a><span class="fu">set_gtsummary_theme</span>(<span class="fu">list</span>(<span class="st">"pkgwide-str:ci.sep"</span> <span class="ot">=</span> <span class="st">"&nbsp;–&nbsp;"</span>))</span>
<span id="cb23-682"><a href="#cb23-682" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_gtsummary_language</span>(<span class="st">"fr"</span>)</span>
<span id="cb23-683"><a href="#cb23-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-684"><a href="#cb23-684" aria-hidden="true" tabindex="-1"></a>mod_simple <span class="sc">%&gt;%</span> </span>
<span id="cb23-685"><a href="#cb23-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">label =</span> <span class="fu">list</span>(annee <span class="sc">~</span> <span class="st">"année"</span>,</span>
<span id="cb23-686"><a href="#cb23-686" aria-hidden="true" tabindex="-1"></a>                              nom <span class="sc">~</span> <span class="st">"bassin de production"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-687"><a href="#cb23-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-688"><a href="#cb23-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_source_note</span>(<span class="at">source_note =</span> <span class="fu">glue</span>(<span class="st">"Maïs grain France </span></span>
<span id="cb23-689"><a href="#cb23-689" aria-hidden="true" tabindex="-1"></a><span class="st">                                      {min(recolte$annee)}-{max(recolte$annee)} </span></span>
<span id="cb23-690"><a href="#cb23-690" aria-hidden="true" tabindex="-1"></a><span class="st">                                      d'après données agroclimatiques ERA5 pour </span></span>
<span id="cb23-691"><a href="#cb23-691" aria-hidden="true" tabindex="-1"></a><span class="st">                                      une précocité moyenne ({besoin} DJ, base</span></span>
<span id="cb23-692"><a href="#cb23-692" aria-hidden="true" tabindex="-1"></a><span class="st">                                      {base} °C)"</span>))</span>
<span id="cb23-693"><a href="#cb23-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb23-694"><a href="#cb23-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-695"><a href="#cb23-695" aria-hidden="true" tabindex="-1"></a><span class="fu">### Validation</span></span>
<span id="cb23-696"><a href="#cb23-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-697"><a href="#cb23-697" aria-hidden="true" tabindex="-1"></a>Des données d'observation ponctuelles permettent de confronter notre modèle à la réalité<span class="co">[</span><span class="ot">@torreChangementClimatiqueObservations2004</span><span class="co">]</span>&nbsp;:</span>
<span id="cb23-698"><a href="#cb23-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-699"><a href="#cb23-699" aria-hidden="true" tabindex="-1"></a>À Toulouse (proche du bassin de Pau) sur 1977-2003, la "*date de semis passe de début mai à début avril en 20&nbsp;ans*". [...] "*Cet écart au semis ne se retrouve pas à la récolte (très variable entre la mi-septembre et la mi-octobre), d'une part parce que le choix des semences a glissé vers des variétes un peu plus tardives (...) et/ou d'autre part, parce que le grain récolté est plus sec («&nbsp;pour tenir compte de l'augmentation du coût de séchage&nbsp;»)*". [...] "*Le cycle de culture a augmenté d'une dizaine de jours depuis 1977&nbsp;; il est d'environ 160&nbsp;jours*".</span>
<span id="cb23-700"><a href="#cb23-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-701"><a href="#cb23-701" aria-hidden="true" tabindex="-1"></a>Ainsi, même si on voit que la variété utilisée a probablement un impact important et que des changements de techniques culturales ont eu lieu, une précocité de semis d'un mois combinée à 10&nbsp;jours de culture de plus représente, pour cet exemple, une date de récolte de <span class="in">`r round((-30 + 10) / (2003 - 1977), 1)`</span>&nbsp;jour par an, ce qui n'est pas très éloigné de notre estimation globale.</span>
</code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>